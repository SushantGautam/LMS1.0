{% load static %}
{% load i18n %}
{% load crispy_forms_tags %}


<div>
    <form method="post" id="ajaxchapterinfoform">
        {% csrf_token %}
        <div class="row">
            <div class="col-lg-4">
                <!--{{ form.Chapter_No|as_crispy_field }}-->
                <div class="form-group">
                    <label for="id_Chapter_No" class="font-weight-bold">{% trans "Chapter No" %}. *</label>
                    <input type="number" class="form-control" name="Chapter_No" id="id_Chapter_No"
                        placeholder="Enter Chapter Number" required>
                </div>
            </div>
            <div class="col-lg-8">
                <div class="form-group">
                    <label for="id_Chapter_Name" class="font-weight-bold">{% trans "Chapter Name" %} *</label>
                    <input type="text" class="form-control" name="Chapter_Name" id="id_Chapter_Name"
                        placeholder="Enter Chapter Name" required>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label for="id_Summary" class="font-weight-bold">{% trans "Summary" %}</label>
            <textarea name="Summary" id="id_Summary" class="form-control" rows="10"></textarea><span
                class="ma-form-highlight"></span><span class="ma-form-bar"></span>
        </div>
        <!-- <div class="row">
            <div class="col-lg-6">
                <div class="form-group">
                    <label for="Start_Date" class="font-weight-bold">{% trans "Start Date" %}</label>
                    <input name="Start_Date" type="date" class="form-control" id="id_Start_Date">
                </div>
            </div>
            <div class="col-lg-6">
                <div class="form-group">
                    <label for="End_Date" class="font-weight-bold">{% trans "End Date" %}</label>
                    <input name="End_Date" type="date" class="form-control" id="id_End_Date">
                </div>
            </div>
        </div> -->
        <div class="row">
            <div class="col-lg-6">
                <div class="form-group">
                    <label for="id_mustreadtime" class="font-weight-bold">
                        {% trans "Running Time" %} ({% trans "in minutes" %})</label>
                    <input type="number" class="form-control" name="mustreadtime" id="id_mustreadtime" min="0"
                        max="5000" placeholder="Enter Running Time for Chapter">
                </div>
            </div>
            <div class="col-lg-6 text-center row">
                <div class="col-6">
                    <div class="form-group">
                        <label for="id_Use_Flag" class="font-weight-bold">{% trans "Publish" %}</label>
                        <br>
                        <input type="checkbox" name="Use_Flag" id="id_Use_Flag" class="checkboxinput">
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-group">
                        <label for="id_is_commentable" class="font-weight-bold">{% trans "Comment" %}</label>
                        <br>
                        <input type="checkbox" id="id_is_commentable" class="checkboxinput" name="is_commentable"
                            checked>
                    </div>
                </div>
            </div>
        </div>
        <input type="hidden" name="Register_Agent" id="id_Register_Agent" value="{{ request.user }}"
            class="select form-control">
        <div class="text-center mt-3">
            <button class="btn btn-primary" type="submit">{% trans "Submit" %}</button>
        </div>
    </form>
</div>

<script>

    $("#ajaxchapterinfoform").submit(function (e) {

        e.preventDefault(); // avoid to execute the actual submit of the form.
        $.ajax({
            url: "{% url 'chapterinfo_create_ajax' %}",  // URL to your view that serves new info
            data: {
                "csrfmiddlewaretoken": '{{ csrf_token }}',
                "Chapter_No": $('#id_Chapter_No').val(),
                "Chapter_Name": $('#id_Chapter_Name').val(),
                "Summary": $('#id_Summary').val(),
                "mustreadtime": $('#id_mustreadtime').val() * 60,
                "Use_Flag": $('#id_Use_Flag').is(":checked"),
                "Register_Agent": $('#id_Register_Agent').val(),
                "Course_Code": $('#id_Course_Code').val(),
                //"Start_Date": $('#id_Start_Date').val() != '' ? new Date($('#id_Start_Date').val()).toISOString() : '',
                //"End_Date": $('#id_End_Date').val() != '' ? new Date($('#id_End_Date').val()).toISOString() : '',
                "is_commentable": $('#id_is_commentable').is(":checked"),
            },
            // get the form data
            type: $(this).attr('method'), // GET or POST
            success: function (response) {
                console.log('Success')
                location.reload()
            },
            error: function (err) {
                console.log(err)
                $('.form-errors').empty()
                if (err.hasOwnProperty('responseJSON')) {
                    console.log('Error in posting chapter create form', err.responseJSON.errors.__all__[0])
                    $('.form-errors').append(err.responseJSON.errors.__all__[0]).css('display', 'block')
                } else {
                    console.log('Error in posting chapter create form')
                }
            }
        });
    });

</script>