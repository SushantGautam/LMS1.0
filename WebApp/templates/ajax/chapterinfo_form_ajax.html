{% load static %}
{% load crispy_forms_tags %}

<form method="post" id="ajaxchapterinfoform">
    {% csrf_token %}

    <div class="alert alert-danger form-errors" style="display: none">
    </div>
    <div class="col-md-3 col-sm-12 col-xs-12 text-center">
        {{ form.Chapter_No|as_crispy_field }}<br>
    </div>
    <div class="col-md-9 col-sm-12 col-xs-12 text-center">
        {{ form.Chapter_Name|as_crispy_field }}<br>
    </div>
    <div class="col-md-12 col-sm-12 col-xs-12 text-center">
        <div id="div_id_Summary" class="form-group">
            <label for="id_Summary" class="control-label ">
                Summary
            </label>
            <div class="controls ">
                <textarea name="Summary" rows="3" class="textarea form-control" id="id_Summary"
                          cols="40">{{ object.Summary }}</textarea>
            </div>
        </div>
        <br>
    </div>
    {#    <div class="col-md-6 col-sm-12 col-xs-12">#}
    {#        {{ form.Start_Date|as_crispy_field }}<br>#}
    {#    </div>#}
    {#    <div class="col-md-6 col-sm-12 col-xs-12">#}
    {#        {{ form.End_Date|as_crispy_field }}<br>#}
    {#    </div>#}
    <div class="col-md-12 col-sm-12 col-xs-12">
        {{ form.mustreadtime|as_crispy_field }}<br>
    </div>
    <div class="col-md-12 col-sm-12 col-xs-12" id="div_use_flag">
        <label for="id_Use_Flag" class="control-label ">Publish</label>
        <input type="checkbox" id="id_Use_Flag" class="js-switch" name="Use_Flag" checked>
    </div>
    <div class="col-md-12 col-sm-12 col-xs-12" id="div_is_commentable">
        <label for="id_is_commentable" class="control-label ">Comment</label>
        <input type="checkbox" id="id_is_commentable" class="js-switch" name="is_commentable" checked>
    </div>

    <div class="col-md-12 col-sm-12 col-xs-12">
        <input type="hidden" name="Register_Agent" id="id_Register_Agent" value="{{ request.user.username }}"
               class="select form-control">
    </div>

    <div class="col-md-12 text-center" style="margin:2em auto;">
        <button class="btn btn-success" type="submit">Submit</button>
    </div>

</form>

<script src="{% static 'vendorsx/switchery/dist/switchery.min.js' %}"></script>
<script>
    {#$('#id_Start_Date').datetimepicker();#}
    {#$('#id_End_Date').datetimepicker();#}
    $("#ajaxchapterinfoform").submit(function (e) {

        e.preventDefault(); // avoid to execute the actual submit of the form.
        $.ajax({
            url: "{% url 'chapterinfo_create_ajax' %}",  // URL to your view that serves new info
            data: {
                "csrfmiddlewaretoken": '{{ csrf_token }}',
                "Chapter_No": $('#id_Chapter_No').val(),
                "Chapter_Name": $('#id_Chapter_Name').val(),
                "Summary": $('#id_Summary').val(),
                "mustreadtime": $('#id_mustreadtime').val() * 60,
                "Use_Flag": $('#id_Use_Flag').is(":checked"),
                "Register_Agent": $('#id_Register_Agent').val(),
                "Course_Code": $('#id_Course_Code').val(),
                {#"Start_Date": $('#id_Start_Date').val() != '' ? new Date($('#id_Start_Date').val()).toISOString() : '',#}
                {#"End_Date": $('#id_End_Date').val() != '' ? new Date($('#id_End_Date').val()).toISOString() : '',#}
                "is_commentable": $('#id_is_commentable').is(":checked"),
            },
            // get the form data
            type: $(this).attr('method'), // GET or POST
            success: function (response) {
                console.log('Success')
                location.reload()
            },
            error: function (err) {
                console.log(err)
                $('.form-errors').empty()
                if (err.hasOwnProperty('responseJSON')) {
                    console.log('Error in posting chapter create form', err.responseJSON.errors.__all__[0])
                    $('.form-errors').append(err.responseJSON.errors.__all__[0]).css('display', 'block')
                } else {
                    console.log('Error in posting chapter create form')
                }
            }
        });
    });
</script>