{% load static %}

<small>Choose meaningful name and View Details on Students Group List <b><a
            href="{% url 'groupmapping_list' %}">here</a></b></small><br><br>

<form method="post" id="ajaxgroupform">
    {% csrf_token %}
    <div class="alert alert-danger form-errors" style="display: none">
    </div>
    <div class="form-group">
        <label for="id_GroupMapping_Name">Group Mapping Name *</label>
        <input type="text" class="form-control" name="GroupMapping_Name" maxlength="250" id="id_GroupMapping_Name"
            required>
    </div>
    <div class="mt-4">
        {{ form.Students }}
    </div>
    <div class="d-inline-block col-12 text-center">
        *You can select multiple students by holding <code> ctrl</code> key on Windows and <code> CommandâŒ˜</code> key on
        MAC.
    </div>
    <input type="hidden" id="id_Use_Flag" name="Use_Flag" value="True">
    <input type="hidden" name="Register_Agent" id="id_Register_Agent" value="{{ request.user.username }}"
        class="select form-control">
    <input type="hidden" name="Center_Code" id="id_Center_Code" value="{{ request.user.Center_Code.id }}"
        class="select form-control">
    <div class="d-inline-block col-12 submitButton text-center pt-3">
        <button class="btn btn-primary" type="submit" id="submit_ajax">Submit</button>
        <button type="button" class="btn btn-secondary close-btn" data-dismiss="modal" id="close-btn">Close</button>
    </div>
</form>
<!-- <script type="text/javascript" src="{% static 'build/js/SelectFilter2.js' %}"></script> -->

<script src="{% static 'build/js/CustomSelectFilter2.js' %}"></script>
<script>
    $(document).ready(function () {
        $('#id_Students').select2({
            placeholder: 'Select Students'
        });
    })

    $("#ajaxgroupform").submit(function (e) {
        e.preventDefault(); // avoid to execute the actual submit of the form.
        $('#id_Students_to option').prop('selected', true);
        $.ajax({
            url: "{% url 'group_create_ajax' %}",  // URL to your view that serves new info
            data: $(this).serialize(), // get the form data
            type: $(this).attr('method'), // GET or POST
            success: function (response) {
                var id_GroupMapping_Name = $('#id_GroupMapping_Name').val();
                $(".close-btn").click();
                $('#id_Groups').append(`
                    <option value="` + response.pk + `" selected>` + id_GroupMapping_Name + `</option>
                `);
            },
            error: function (err) {
                console.log('Error in posting chapter create form', err.responseJSON)
                if ('__all__' in err.responseJSON) {
                    $('.form-errors').empty().append(err.responseJSON.__all__[0]).css('display', 'block')
                } else {
                    $('.form-errors').empty().append(err.responseJSON.Students[0]).css('display', 'block')
                }
            }
        });
    });
</script>