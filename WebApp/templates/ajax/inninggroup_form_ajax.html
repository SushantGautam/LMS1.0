{% load static %}
{% load crispy_forms_tags %}

<small>Choose meaningful name and View Details on Assigned Courses Name List <b><a
            href="{% url 'inninggroup_list' %}">here</a></b></small>
<br><br>

<form method="post" id="ajaxgroupforms">
    {% csrf_token %}
    <div class="form-group">
        <label for="id_Course_Code">Select Course</label>
        <select class="select2" id="id_Course_Code" name="Course_Code">
            {% for x, y in form.fields.Course_Code.choices %}
            <option value="{{ x }}" {% if form.initial.Course_Code == x %}selected{% endif %}>
                {{ y }}
            </option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label for="id_Teacher_Code">Select Teachers</label>
        <select class="select2" id="id_Teacher_Code" name="Teacher_Code" multiple>
            {% for x, y in form.fields.Teacher_Code.choices %}
            <option value="{{ x }}" {% if form.initial.Teacher_Code == x %}selected{% endif %}>
                {{ y }}
            </option>
            {% endfor %}
        </select>
    </div>
    <!-- <div class="col-md-12 col-sm-12 col-xs-12">
        *You can select multiple teachers by holding <code> ctrl</code> key on Windows and <code> CommandâŒ˜</code> key on
        MAC.
    </div> -->
    <input type="hidden" id="id_Use_Flag" name="Use_Flag" value="True">
    <input type="hidden" name="Center_Code" id="id_Center_Code" value="{{ request.user.Center_Code.id }}"
        class="select form-control">
    <input type="hidden" name="Register_Agent" id="id_Register_Agent" value="{{ request.user.username }}"
        class="select form-control">
    <div class="submitButton text-center pt-3">
        <button class="btn btn-primary" type="submit">Submit</button>
        <button type="button" class="btn btn-secondary close-btn" data-dismiss="modal" id="close-btn">Close</button>
    </div>
</form>

<script>
    $(document).ready(function () {
        $('#id_Teacher_Code').select2({
            placeholder: 'Select Teacher'
        });
        $('#id_Course_Code').select2({
            placeholder: 'Select Course'
        });
    })

    var selectedOption;
    $("#id_Course_Code").change(function () {
        selectedOption = $(this).children("option:selected").text();
    });
    $("#ajaxgroupforms").submit(function (e) {
        e.preventDefault(); // avoid to execute the actual submit of the form.
        $('#id_Teacher_Code_to option').prop('selected', true);
        $.ajax({
            url: "{% url 'inninggroup_create_ajax' %}",  // URL to your view that serves new info
            data: $(this).serialize(), // get the form data
            type: $(this).attr('method'), // GET or POST
            success: function (response) {
                var id_Course_Code = $('#id_Course_Code').val();
                $(".close-btn").click();

                $('#id_Course_Group_to').append(`
                    <option value="` + response.pk + `" title="` + selectedOption + `" selected>` + selectedOption + `</option>
                `);
                SelectBox.add_to_cache("id_Course_Group_to", { value: String(response.pk), text: selectedOption, displayed: 1 });
            },
            error: function () {
                console.log('Error in posting group create form')
            }
        });
    });


</script>