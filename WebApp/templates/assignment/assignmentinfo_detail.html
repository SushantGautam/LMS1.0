{% load static %}
{% load i18n %}
{% load model_template_relation %}




<div class="modal fade" id="add_question_modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-primary font-weight-bold" id="add_question_modal_title">
                    {% trans "Add Question" %}
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i class="ti-close"></i>
                </button>
            </div>
            <div class="modal-body" id="add_question_modal_body">
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editAssignmentModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-primary font-weight-bold" id="editAssignmentModal_title">
                    {% trans "Edit Assignment" %}
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i class="ti-close"></i>
                </button>
            </div>
            <div class="modal-body" id="editAssignmentModal_body">
                <form method="post" id="ajaxassignmentinfoform">
                    {% csrf_token %}
                    <div class="alert alert-danger form-errors" style="display: none">
                    </div>
                    <div class="form-group">
                        <label for="id_Assignment_Topic_edit" class="control-label">
                            {% trans "Assignment Topic" %} <span class="asteriskField">*</span>
                        </label>
                        <input type="text" name="Assignment_Topic" maxlength="500" class="form-control"
                            id="id_Assignment_Topic_edit" value="{{ object.Assignment_Topic }}" required>
                    </div>

                    <div class="row">
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label for="id_Assignment_Start_edit" class="control-label">
                                    {% trans "Assignment Start" %} *
                                </label>
                                <input type="text" name="Assignment_Start_edit" class="form-control"
                                    id="id_Assignment_Start_edit" value="{{ object.Assignment_Start|date:'c' }}" min=""
                                    max="9999-12-31">
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label for="id_Assignment_Deadline_edit" class="control-label">
                                    {% trans "Assignment Deadline" %} *
                                </label>
                                <input type="text" name="Assignment_Deadline_edit" class="form-control"
                                    id="id_Assignment_Deadline_edit" value="{{ object.Assignment_Deadline|date:'c' }}"
                                    min="{{ datetime|date:'Y-m-d' }}" max="9999-12-31" required>
                            </div>
                        </div>
                    </div>
                    <div class="form-group text-center">
                        <label for="id_Use_Flag">{% trans "Publish" %}</label><br>
                        <input type="checkbox" id="id_Use_Flag" class="js-switch" name="Use_Flag"
                            {% if object.Use_Flag == False %} &nbsp; {% elif object.Use_Flag == True %} checked
                            {% endif %}>
                    </div>

                    <div class="result text-center"></div>
                    <div class="form-group">
                        <input type="hidden" name="Register_Agent" id="id_Register_Agent" value="{{ request.user.id }}"
                            class="select form-control">
                        <input type="hidden" name="Course_Code" id="id_Course_Code" value="{{ object.Course_Code.id }}"
                            class="select form-control">
                        <input type="hidden" name="Chapter_Code" id="id_Chapter_Code"
                            value="{{ object.Chapter_Code.id }}" class="select form-control">
                        <input type="hidden" name="today_date" id="id_today_date" value="{{ datetime|date:'Y-m-d' }}"
                            class="select form-control">
                    </div>
                    <div class="submitButton text-center col-md-12">
                        <button class="btn btn-primary" type="submit">{% trans "Submit" %}</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class=" col-md-8 col-sm-12 col-xs-12 ">
        <div class="page-header">
            <div class="page-title">
                <h4 class="d-flex align-items-center">{% trans "Assignment Information" %}
                </h4>
            </div>
            <h5>{{ object.Assignment_Topic }}</h5>
        </div>

        <div class="my-5">
            <div class="d-flex justify-content-between">
                <h4 class="text-primary mb-4">{% trans "List of Questions" %}</h4>
                <div>
                    {% if not "students" in request.get_full_path %}
                    <button type="button" class="btn btn-info" data-toggle="modal" data-target="#add_question_modal"
                        id="add-newquestion-btn">
                        {% trans "Add Question" %}
                    </button>
                    {% endif %}
                </div>
            </div>
            {% for questions in Questions %}
            <div class="accordion mb-4" id="questionList{{ question.pk }}">
                <div class="card shadow-none border">
                    <div class="card-header justify-content-between" id="headingOne">
                        <div class="d-flex align-items-center">
                            <figure class="avatar avatar-sm">
                                <span class="avatar-title rounded-circle"> {{ forloop.counter }}</span>
                            </figure>
                            <h5 class="text-secondary m-0 pl-3 cursor-pointer">
                                {{ questions.Question_Title }}
                            </h5>
                        </div>
                        <div class="row d-flex align-items-center">
                            {% if '/students' in request.path %}
                            <button class="btn btn-sm btn-outline-primary answerButton mx-2" type="button"
                                id="{{ questions.pk }}">{% trans "ANSWER" %} <i class="fa fa-arrow-right"></i>
                            </button>
                            {% endif %}
                            {% if '/students' not in request.path %}
                            <div class="modal fade" id="editQuestionModal{{ question.pk }}" tabindex="-1" role="dialog"
                                aria-labelledby="editQuestionLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header text-center">
                                            <h5 class="modal-title text-primary font-weight-bold"
                                                id="editQuestionModal_title">{% trans "Edit Question" %}
                                            </h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <i class="ti-close"></i>
                                            </button>

                                        </div>
                                        <div class="modal-body modal-auto" id="edit_question_modal_body">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-info btn-floating editquestion-btn mx-2" data-toggle="modal"
                                data-target="#editQuestionModal{{ question.pk }}" id="editquestion-btn{{ question.pk }}"
                                data-questionpk="{{ question.pk }}">
                                <i class="fa fa-pencil"></i>
                            </button>
                            {% if '/teachers' in request.path %}
                            <button id="{{ question.pk }}"
                                class="btn btn-sm btn-danger btn-floating confirm-delete mx-2">
                                <i class="fa fa-trash"></i>
                            </button>
                            <form method="post"
                                action="{% url 'teacher_questioninfo_delete' assignment=object.pk pk=question.pk %}"
                                id="deleteQuestion{{ question.pk }}">
                                {% csrf_token %}
                                <input type="hidden" value="{{ question.pk }}" name="question_id">
                                <input type="hidden" value="{{ object.pk }}" name="assignment_id">
                                <input type="hidden" value="{{ object.Course_Code.id }}" name="course_id">
                                <input type="hidden" value="{{ object.Chapter_Code.id }}" name="chapter_id">
                            </form>
                            {% else %}
                            <button id="{{ question.pk }}"
                                class="btn btn-sm btn-danger btn-floating confirm-delete mx-2">
                                <i class="fa fa-trash"></i>
                            </button>
                            <form method="post"
                                action="{% url 'webapp_questioninfo_delete' assignment=object.pk pk=question.pk %}"
                                id="deleteQuestion{{ question.pk }}">
                                {% csrf_token %}
                                <input type="hidden" value="{{ question.pk }}" name="question_id">
                                <input type="hidden" value="{{ object.pk }}" name="assignment_id">
                                <input type="hidden" value="{{ object.Course_Code.id }}" name="course_id">
                                <input type="hidden" value="{{ object.Chapter_Code.id }}" name="chapter_id">
                            </form>
                            {% endif %}
                            {% endif %}
                        </div>
                        <a data-toggle="collapse" data-target="#question{{ question.pk }}" aria-expanded="true"
                            aria-controls="collapseOne" href="javascript:void(0)">
                            <figure class="avatar avatar-sm">
                                <span class="avatar-title rounded-circle">
                                    <i class="fa fa-chevron-down"></i>
                                </span>
                            </figure>
                        </a>
                    </div>
                    <div id="question{{ question.pk }}" class="collapse show" aria-labelledby="headingOne"
                        data-parent="#questionList{{ question.pk }}">
                        <div class="p-3">
                            {% if  question.Question_Score %}
                            <p>{% trans "Question Score" %} : {{ question.Question_Score }}</p>
                            {% endif %}
                            {% if  question.Question_Description %}
                            <p>{% trans "Question Description" %} : {{ question.Question_Description | safe }}</p>
                            {% endif %}
                            {% if question.Answer_Type %}
                            <p>{% trans "Answer Type" %} : {% if question.Answer_Type == 'S' %}
                                {% trans "Short Answer" %}
                                {% else %}
                                {% trans "File Upload" %}
                                {% endif %}
                            </p>
                            {% endif %}
                            {% if  question.Question_Media_File %}
                            <p>{% trans "Question Media" %} : </p>
                            <p>
                                {% if question.extension == '.jpg' or question.extension == '.png' %}
                                <img class="card-img-top" width="400px" src="{{ question.Question_Media_File.url }}">
                                {% else %}
                                <a href="{{ question.Question_Media_File.url }}" target="_blank"><b
                                        style="color:#017a9b">
                                        {% trans "Click to view attatched file" %}</b></a>
                                {% endif %}
                            </p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>


                {%comment%}
                <div class="x_panel" id="answerContent{{ question.pk }}" style="display: none">
                    <div class="x_content">
                        {% for answer in Answers %}
                        {% if question.id == answer.Question_Code.id %}

                        {% if answer.Assignment_Answer != '' %}

                               {# <p>{{ answer.Assignment_Answer }}</p> #}

                                <div class="short_answer">
                                    <p class="short_answer_p"
                                       style="margin: 0;color:#000000;">{{ answer.Assignment_Answer|safe }}
                                    </p>
                                </div>
                                {% now "Y-m-d H:i" as todays_date %}

                                {# {% if object.Assignment_Deadline|date:"Y-m-d H:i" >= todays_date and object.Assignment_Start|date:"Y-m-d H:i" <= todays_date %} #}
                                {% if object.active %}
                                    <button class="btn btn-info editanswer"
                                            data-Student_Code="{{ request.user.id }}"
                                            data-Question_Code="{{ questions.id }}"
                                            data-Answer_Code="{{ answer.pk }}"
                                            value="{{ answer.pk }}"
                                            style="float: right;" title="Edit Answer"><i class="fa fa-edit"
                                                                                        aria-hidden="true"></i>
                                    </button>
                                    <button class="btn btn-danger deleteanswer" value="{{ answer.pk }}"
                                            style="float: right" title="Delete Answer"><i
                                            class="fa fa-trash"
                                            aria-hidden="true"></i>
                                    </button>
                                {% endif %}
                                <div class="assignment_update_form" style="display: none;">
                                    <form class="form_{{ questions.id }}">
                                        <div class="form-group">
                                            {{ form.Assignment_Answer }}
                                            <input type="hidden" value="{{ request.user.id }}"
                                                   name="Student_Code"
                                                   id="id_Student_Code{{ questions.id }}">
                                            <input type="hidden" value="{{ questions.id }}"
                                                   name="Question_Code"
                                                   id="id_Question_Code{{ questions.id }}">
                                        </div>
                                        <div class="form-group text-center">
                                            <button class="btn btn-sm btn-primary cancelBtn" type="button"
                                                    id="cancelButton{{ questions.pk }}">
                                                {% trans 'Cancel' %}
                                            </button>
                                            <button class="btn btn-sm btn-primary resetBtn" type="reset">
                                                {% trans 'Reset' %}
                                            </button>

                                            <button type="button"
                                                    class="btn btn-sm btn-success submitAnswer"
                                                    id="answer{{ questions.id }}"
                                                    data-id="{{ questions.id }}"
                                                    data-url="{% url 'assignanswerinfo_create_ajax' %}?editanswer={{ answer.pk }}">
                                                {% trans 'Submit' %}
                                            </button>
                                        </div>
                                    </form>
                                </div>


                        {% else %}
                        <p style="margin: 0;color:#000000;">{% trans 'File has been Submitted' %}</p>
                        {# <p>{% trans "File has been Submitted" %}</p> #}
                            <a href="{{ answer.Assignment_File.url }}" target="_blank"><b style="color:#017a9b">
                                    {% trans "Click to view Submitted file" %}</b></a>
                            <button class="btn btn-danger deleteanswer" value="{{ answer.pk }}" style="float: right"
                                title="Delete Answer"><i class="fa fa-trash" aria-hidden="true"></i>
                            </button>
                        {% endif %}
                        {% endif %}
                        {% endfor %}





                        {% for answer in notAnswered %}

                        {% if  questions.id == answer %}

                          <form class="form_{{ questions.id }}">
                                            {% if questions.Answer_Type == 'S' %}
                                                <div class="form-group">
                                                    {{ form.Assignment_Answer }}
                                                    <!-- <textarea type="hidden" name="Assignment_Answer"
                                                     id="id_Assignment_Answer{{ questions.id }}"
                                                     required></textarea> -->
                                                    <input type="hidden" value="{{ request.user.id }}"
                                                           name="Student_Code"
                                                           id="id_Student_Code{{ questions.id }}">
                                                    <input type="hidden" value="{{ questions.id }}" name="Question_Code"
                                                           id="id_Question_Code{{ questions.id }}">

                                                </div>

                                                <div class="form-group text-center">
                                                    {% now "Y-m-d H:i" as todays_date %}
                                                    {# {% if object.Assignment_Deadline|date:"Y-m-d H:i" >= todays_date and object.Assignment_Start|date:"Y-m-d H:i" <= todays_date %} #}
                                                    {# {% isAssignmentActive object as isanswerable %}#}
                                                    {% if object.active %}
                                                        <!-- <button class="btn btn-primary" type="button" id="cancelButton{{ questions.pk }}">
                                                Cancel
                                            </button> -->
                                                        <button class="btn btn-sm btn-primary" type="reset">{% trans 'Reset' %}
                                                        </button>

                                                        <button type="button"
                                                                class="btn btn-sm btn-success submitAnswer"
                                                                id="answer{{ questions.id }}"
                                                                data-id="{{ questions.id }}"
                                                                data-url="{% url 'assignanswerinfo_create_ajax' %}">
                                                            {% trans 'Submit' %}
                                                        </button>
                                                    {% else %}
                                                        <p class="text-danger">{% trans 'Submission is prohibited. Please check assignment start and end date' %}</p>
                                                    {% endif %}
                                                </div>

                                            {% elif questions.Answer_Type == 'F' %}

                                                <div class="form-group">
                                                    <label for="id_Assignment_File{{ questions.id }}" class="">
                                                        <span style="font-size: 10px; color: #721c24">
                                                            {% trans 'Assignment File' %} ({% trans 'Max' %}: 10 MB) </span>
                                                    </label>

                                                    <input type="file" name="Assignment_File"
                                                           id="id_Assignment_File{{ questions.id }}"
                                                           required/>
                                                    <input type="hidden" value="{{ request.user.id }}"
                                                           name="Student_Code"
                                                           id="id_Student_Code{{ questions.id }}">
                                                    <input type="hidden" value="{{ questions.id }}" name="Question_Code"
                                                           id="id_Question_Code{{ questions.id }}">
                                                </div>
                                                <div class="form-group text-center">
                                                    {% now "Y-m-d H:i" as todays_date %}
                                                    {# {% if object.Assignment_Deadline|date:"Y-m-d H:i" >= todays_date and object.Assignment_Start|date:"Y-m-d H:i" <= todays_date %} #}
                                                    {#  {% isAssignmentActive object as isanswerable %} #}
                                                    {% if object.active %}
                                                        <button class="btn btn-sm btn-primary" type="reset"
                                                                id="cancelButton{{ questions.pk }}">
                                                            {% trans 'Cancel' %}
                                                        </button>

                                                        <button type="button"
                                                                class="btn btn-sm btn-success submitAnswer"
                                                                id="answer{{ questions.id }}"
                                                                data-id="{{ questions.id }}"
                                                                data-url="{% url 'assignanswerinfo_create_ajax' %}">
                                                            {% trans 'Submit' %}
                                                        </button>
                                                    {% else %}
                                                        <p class="text-danger">{% trans 'Submission is prohibited. Please check assignment start and end date' %}</p>
                                                    {% endif %}
                                                </div>
                                            {% endif %}
                                        </form>



                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {%endcomment%}



             <div class="x_panel" id="answerContent{{ questions.pk }}" style="display: none">
                            <div class="x_content">
                                {% for answer in Answers %}
                                    {% if questions.id == answer.Question_Code.id %}
                                        {% if answer.Assignment_Answer != '' %}
                                            <div class="short_answer">
                                                <p class="short_answer_p"
                                                   style="margin: 0;color:#000000;">{{ answer.Assignment_Answer|safe }}</p>
                                            </div>
                                            {% now "Y-m-d H:i" as todays_date %}
                                            {% if object.active %}
                                                <button class="btn btn-info editanswer"
                                                        data-Student_Code="{{ request.user.id }}"
                                                        data-Question_Code="{{ questions.id }}"
                                                        data-Answer_Code="{{ answer.pk }}"
                                                        value="{{ answer.pk }}"
                                                        style="float: right; position:relative; bottom:60px; left:5px;" title="Edit Answer"><i class="fa fa-edit"
                                                                                                    aria-hidden="true"></i>
                                                </button>
                                                <button class="btn btn-danger deleteanswer" value="{{ answer.pk }}"
                                                        style="float: right; position:relative; bottom:60px;" title="Delete Answer"><i
                                                        class="fa fa-trash"
                                                        aria-hidden="true"></i>
                                                </button>
                                            {% endif %}
                                            <div class="assignment_update_form" style="display: none;">
                                                <form class="form_{{ questions.id }}">
                                                    <div class="form-group">
                                                        {{ form.Assignment_Answer }}
                                                        <input type="hidden" value="{{ request.user.id }}"
                                                               name="Student_Code"
                                                               id="id_Student_Code{{ questions.id }}">
                                                        <input type="hidden" value="{{ questions.id }}"
                                                               name="Question_Code"
                                                               id="id_Question_Code{{ questions.id }}">
                                                    </div>
                                                    <div class="form-group text-center">
                                                        <button class="btn btn-sm btn-primary cancelBtn" type="button"
                                                                id="cancelButton{{ questions.pk }}">
                                                            {% trans 'Cancel' %}
                                                        </button>
                                                        <button class="btn btn-sm btn-primary resetBtn" type="reset">
                                                            {% trans 'Reset' %}
                                                        </button>

                                                        <button type="button"
                                                                class="btn btn-sm btn-success submitAnswer"
                                                                id="answer{{ questions.id }}"
                                                                data-id="{{ questions.id }}"
                                                                data-url="{% url 'assignanswerinfo_create_ajax' %}?editanswer={{ answer.pk }}">
                                                            {% trans 'Submit' %}
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        {% else %}
                                            <p style="margin: 0;color:#000000;">{% trans 'File has been Submitted' %}</p>

                                            <a href="{{ answer.Assignment_File.url }}" target="_blank"><b
                                                    style="color:#017a9b">{% trans 'Click to view Submitted file' %}</b></a>
                                            {% if object.active %}
                                                <button class="btn btn-danger deleteanswer" value="{{ answer.pk }}"
                                                        style="float: right" title="Delete Answer"><i
                                                        class="fa fa-trash"
                                                        aria-hidden="true"></i>
                                                </button>
                                            {% endif %}
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}

                                {% for answer in notAnswered %}
                                    {% if  questions.id == answer %}
                                        <form class="form_{{ questions.id }}">
                                            {% if questions.Answer_Type == 'S' %}
                                                <div class="form-group">
                                                    {{ form.Assignment_Answer }}
                                                    <!-- <textarea type="hidden" name="Assignment_Answer"
                                                     id="id_Assignment_Answer{{ questions.id }}"
                                                     required></textarea> -->
                                                    <input type="hidden" value="{{ request.user.id }}"
                                                           name="Student_Code"
                                                           id="id_Student_Code{{ questions.id }}">
                                                    <input type="hidden" value="{{ questions.id }}" name="Question_Code"
                                                           id="id_Question_Code{{ questions.id }}">

                                                </div>

                                                <div class="form-group text-center">
                                                    {% now "Y-m-d H:i" as todays_date %}
                                                    {# {% if object.Assignment_Deadline|date:"Y-m-d H:i" >= todays_date and object.Assignment_Start|date:"Y-m-d H:i" <= todays_date %} #}
                                                    {# {% isAssignmentActive object as isanswerable %}#}
                                                    {% if object.active %}
                                                        <!-- <button class="btn btn-primary" type="button" id="cancelButton{{ questions.pk }}">
                                                Cancel
                                            </button> -->
                                                        <button class="btn btn-sm btn-primary" type="reset">{% trans 'Reset' %}
                                                        </button>

                                                        <button type="button"
                                                                class="btn btn-sm btn-success submitAnswer"
                                                                id="answer{{ questions.id }}"
                                                                data-id="{{ questions.id }}"
                                                                data-url="{% url 'assignanswerinfo_create_ajax' %}">
                                                            {% trans 'Submit' %}
                                                        </button>
                                                    {% else %}
                                                        <p class="text-danger">{% trans 'Submission is prohibited. Please check assignment start and end date' %}</p>
                                                    {% endif %}
                                                </div>

                                            {% elif questions.Answer_Type == 'F' %}

                                                <div class="form-group">
                                                    <label for="id_Assignment_File{{ questions.id }}" class="">
                                                        <span style="font-size: 10px; color: #721c24">
                                                            {% trans 'Assignment File' %} ({% trans 'Max' %}: 10 MB) </span>
                                                    </label>

                                                    <input type="file" name="Assignment_File"
                                                           id="id_Assignment_File{{ questions.id }}"
                                                           required/>
                                                    <input type="hidden" value="{{ request.user.id }}"
                                                           name="Student_Code"
                                                           id="id_Student_Code{{ questions.id }}">
                                                    <input type="hidden" value="{{ questions.id }}" name="Question_Code"
                                                           id="id_Question_Code{{ questions.id }}">
                                                </div>
                                                <div class="form-group text-center">
                                                    {% now "Y-m-d H:i" as todays_date %}
                                                    {# {% if object.Assignment_Deadline|date:"Y-m-d H:i" >= todays_date and object.Assignment_Start|date:"Y-m-d H:i" <= todays_date %} #}
                                                    {#  {% isAssignmentActive object as isanswerable %} #}
                                                    {% if object.active %}
                                                        <button class="btn btn-sm btn-primary" type="reset"
                                                                id="cancelButton{{ questions.pk }}">
                                                            {% trans 'Cancel' %}
                                                        </button>

                                                        <button type="button"
                                                                class="btn btn-sm btn-success submitAnswer"
                                                                id="answer{{ questions.id }}"
                                                                data-id="{{ questions.id }}"
                                                                data-url="{% url 'assignanswerinfo_create_ajax' %}">
                                                            {% trans 'Submit' %}
                                                        </button>
                                                    {% else %}
                                                        <p class="text-danger">{% trans 'Submission is prohibited. Please check assignment start and end date' %}</p>
                                                    {% endif %}
                                                </div>
                                            {% endif %}
                                        </form>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>


            {% endfor %}
        </div>
    </div>
    <div class="col-md-4 col-sm-12 col-xs-12">
        <div class="card">
            <div class="px-4 pt-4">
                <p class="text-primary mb-3">{% trans "Assignment" %} : {{ object.Assignment_Topic }}</p>


                <p>
                   {# {% trans "Assignment Start Date" %} : {{ object.Assignment_Start|date:'d M, Y h:i A' }} #}
                </p>
                <p>
                  {#  {% trans "Assignment End Date" %} : {{ object.Assignment_Deadline|date:'d M, Y h:i A' }} #}
                </p>


                <p>
                    {% trans "Course Name" %} : {{ object.Course_Code }}
                </p>
                <p>
                    {% trans "Chapter Name" %} : {{ object.Chapter_Code }}
                </p>
                <p>
                    {% trans "Status" %} :{% if object.Use_Flag is True %}
                    <span class="badge badge-success">{% trans "Published" %}</span>
                    {% elif object.Use_Flag is False %}
                    <span class="badge badge-danger">{% trans "Not Published" %}</span>
                    {% endif %}

                    {% now "Y-m-d H:i" as todays_datewithtime %}
                    {% if object.Assignment_Start and todays_datewithtime < object.Assignment_Start|date:"Y-m-d H:i" %}
                    <span class="badge badge-info">{% trans "Upcoming" %}</span>
                    {% elif object.Assignment_Deadline and todays_datewithtime > object.Assignment_Deadline|date:"Y-m-d H:i" %}
                    <span class="badge badge-danger">{% trans "Expired" %}</span>
                    {% else %}
                    <span class="badge badge-success">{% trans "Active" %}</span>
                    {% endif %}
                </p>

                <p>
                    {% trans "Register Agent" %} : {{ object.Register_Agent }}
                </p>
            </div>


                    <table class="table">
                        {% if assigned_session %}
                            <tr>
                                <th class="custom-table-width">{% trans 'Session' %}</th>
                                <th class="date-width">{% trans 'Start Date' %}</th>
                                <th class="date-width">{% trans 'End Date' %}</th>
                                <th>{% trans 'Assignment Status' %}</th>
                               {% if '/students' not in request.path %}
                                    <th>{% trans 'Action' %}</th>
                                {% endif %}
                            </tr>
                        {% endif %}
                    {% for sessions in assigned_session %}
                       {% if "students" in request.get_full_path %}
                            {% if sessions.is_active %}
                            <tr>
                                <td class="custom-table-width">

                                    {{ sessions }}

                                </td>



                                {% getSessionMap object 'assignmentinfo' sessions as sessionmap %}

                                <td class="start-date dateconFullMonth date-width">{{ sessionmap.0.Start_Date|date:"d M, Y h:i A" }}</td>
                                <td class="end-date dateconFullMonth date-width">{{ sessionmap.0.End_Date|date:"d M, Y h:i A" }}</td>
                                <td>
                                    {% now "Y-m-d H:i" as todays_datewithtime %}
                                    {% if not sessionmap or not sessionmap.0.Start_Date or not sessionmap.0.End_Date  %}
                                        <span class="badge badge-danger">{% trans 'Inactive' %}</span>
                                    {% elif sessionmap.0.Start_Date and todays_datewithtime < sessionmap.0.Start_Date|date:"Y-m-d H:i" %}
                                        <span class="badge badge-info">{% trans 'Upcoming' %}</span>
                                    {% elif sessionmap.0.End_Date and todays_datewithtime > sessionmap.0.End_Date|date:"Y-m-d H:i" %}
                                        <span class="badge badge-danger">{% trans 'Expired' %}</span>
                                    {% else %}
                                        <span class="badge badge-success">{% trans 'Active' %}</span>
                                    {% endif %}
                                    {% for chaptersession in object.Chapter_Code.chapter_sessionmaps.all %}
                                        {% if sessionmap.0.Session_Code == chaptersession.Session_Code %}
                                            {% if sessionmap.0.End_Date > chaptersession.End_Date and sessionmap.0.End_Date and chaptersession.End_Date %}
                                                <h6 class="text-danger">{% trans 'Assignment End Date is greater than Chapter' %}.</h6>
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                </td>


                            </tr>
                            {% endif %}
                       {% else %}

                            <tr>
                                <td class="custom-table-width">

                                    {{ sessions }}
                                     {% if  '/teachers' not in request.path %}
                                        {% if sessions.is_active %}
                                            <span class=" text-success"> <b
                                                    style="text-transform: uppercase; font-size:14px">[{% trans 'Active' %}]</b>  </span>
                                        {% else %}
                                            <span class=" text-danger"><b
                                                    style="text-transform: uppercase; font-size:14px">[{% trans 'Inactive' %}]</b></span>
                                        {% endif %}
                                    {% endif %}
                                </td>



                                {% getSessionMap object 'assignmentinfo' sessions as sessionmap %}
                                {#                                {% for sessionmap in object.assignment_sessionmaps.all %}#}
                                {#                                    {% if  sessionmap.Session_Code == sessions %}#}
                                <td class="start-date dateconFullMonth date-width">{{ sessionmap.0.Start_Date|date:"d M, Y h:i A" }}</td>
                                <td class="end-date dateconFullMonth date-width">{{ sessionmap.0.End_Date|date:"d M, Y h:i A" }}</td>
                                <td>
                                    {% now "Y-m-d H:i" as todays_datewithtime %}
                                    {% if not sessionmap or not sessionmap.0.Start_Date or not sessionmap.0.End_Date  %}
                                        <span class="badge badge-danger">{% trans 'Inactive' %}</span>
                                    {% elif sessionmap.0.Start_Date and todays_datewithtime < sessionmap.0.Start_Date|date:"Y-m-d H:i" %}
                                        <span class="badge badge-info">{% trans 'Upcoming' %}</span>
                                    {% elif sessionmap.0.End_Date and todays_datewithtime > sessionmap.0.End_Date|date:"Y-m-d H:i" %}
                                        <span class="badge badge-danger">{% trans 'Expired' %}</span>
                                    {% else %}
                                        <span class="badge badge-success">{% trans 'Active' %}</span>
                                    {% endif %}
                                    {% for chaptersession in object.Chapter_Code.chapter_sessionmaps.all %}
                                        {% if sessionmap.0.Session_Code == chaptersession.Session_Code %}
                                            {% if sessionmap.0.End_Date > chaptersession.End_Date and sessionmap.0.End_Date and chaptersession.End_Date %}
                                                <h6 class="text-danger">{% trans 'Assignment End Date is greater than Chapter' %}.</h6>
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                </td>
                                {#                                    {% endif %}#}
                                {#                                {% endfor %}#}

                                    <td>
                                        <button type="button" class="btn btn-sm btn-primary inningmap-btn"
                                                data-toggle="modal"
                                                data-target="#inningmap_form_modal" data-sessionid="{{ sessions.id }}"
                                                data-objectid="{{ object.id }}">
                                            {% trans 'Change' %}
                                        </button>
                                    </td>

                            </tr>


                       {% endif %}
                        {% endfor %}

                    </table>




                    <ul class="text-center">
                {% if '/students' not in request.path %}
                <li class="p-2 border-top">
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#editAssignmentModal"
                        id="editAssignment-btn">
                        {% trans "Edit Assignment" %}
                    </button>
                    &nbsp;
                    {% if '/teachers' in request.path %}
                    <a class="btn btn-danger text-white assignment-confirm-delete"
                        id="{{ object.pk }}">{% trans "Delete" %}</a>
                    <form method="post" action="{% url 'teacher_assignmentinfo_delete' pk=object.pk %}"
                        id="deleteAssignment{{ object.pk }}">
                        {% csrf_token %}
                        <!-- <input type="hidden" value="{{question.pk}}" name="question_id"> -->
                        <input type="hidden" value="{{ object.pk }}" name="assignment_id">
                        <input type="hidden" value="{{ object.Course_Code.id }}" name="course_id">
                        <input type="hidden" value="{{ object.Chapter_Code.id }}" name="chapter_id">
                    </form>
                    {% else %}
                    <a class="btn btn-danger text-white assignment-confirm-delete"
                        id="{{ object.pk }}">{% trans "Delete" %}</a>
                    <form method="post" action="{% url 'assignmentinfo_delete' pk=object.pk %}"
                        id="deleteAssignment{{ object.pk }}">
                        {% csrf_token %}
                        <!-- <input type="hidden" value="{{questions.pk}}" name="question_id"> -->
                        <input type="hidden" value="{{ object.pk }}" name="assignment_id">
                        <input type="hidden" value="{{ object.Course_Code.id }}" name="course_id">
                        <input type="hidden" value="{{ object.Chapter_Code.id }}" name="chapter_id">
                    </form>
                    {% endif %}
                    <!-- <button class="btn btn-danger chapter-confirm-delete" id="{{ object.pk }}">Delete
                        Chapter</button>
                    <form method="post" action="{% url 'chapterinfo_delete' pk=object.pk %}"
                        id="deleteChapter{{ object.pk }}">
                        {% csrf_token %}
                        <input type="hidden" value="{{ object.pk }}" name="chapter_id">
                        <input type="hidden" value="{{ object.Course_Code.id }}" name="course_id">
                    </form> -->
                </li>
                {% endif %}
                {% if 'teacher' in request.path %}
                <li class="p-2 border-top">
                    <a class="btn btn-success btn-info" href="{% url 'teacher_assignment_answers' object.pk %}">
                        {% trans "View Assignment Submissions" %}
                    </a>
                </li>
                {% endif %}
                <!-- <li class="p-2 border-top">
                    <button type="button" class="btn btn-info" data-toggle="modal" data-target="#add_question_modal"
                        id="add-newquestion-btn">
                        Add Question
                    </button>
                </li> -->
            </ul>
        </div>
    </div>
</div>
{% block customjss %}
    <script src="{% static 'vendors/jquery/dist/jquery.min.js' %}"></script>
    <script src=" {% static 'vendors/jQuery-Smart-Wizard/js/jquery.smartWizard.js' %}"></script>
    <script src="{% static 'vendors/moment/min/moment.min.js' %}"></script>
    <script src="{% static 'vendors/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js' %}"></script>


<script>
        $(".answerButton").click(function () {
            //$(`#answerContent${this.id}`).toggle();
            $(`#answerContent${this.id}`).toggle();
            //console.log("Answer Button Clicked");
        });

</script>


<script>
        $('#myModal').on('shown.bs.modal', function () {
            $('#myInput').trigger('focus')
        });

        $(document).on('click', '.confirm-delete', function () {
            ans = confirm('Are you sure you want to delete this Question?');
            if (ans == true) {
                $(`#deleteQuestion${this.id}`).submit();
            } else {
                return false;
            }
        });

        $(document).on('click', '.assignment-confirm-delete', function () {
            ans = confirm('Are you sure you want to delete this Assignment?');
            if (ans == true) {
                $(`#deleteAssignment${this.id}`).submit();
            } else {
                return false;
            }
        });

        $('#add-newquestion-btn').on('click', function () {
            if (submitted) {
                return false
            }
            $('#add_question_modal_body').empty();
            $('#edit_question_modal_body').empty();
            $('#add_question_modal_body').append(
                `<input type="hidden" name="Assignment_Code" id="id_Assignment_Code" value="{{ object.pk }}"
                           class="select form-control">`
            )
            $.ajax({
                type: "GET",
                url: "{% url 'questioninfo_create_ajax' %}",  // URL to your view that serves new info
                success: function (response) {
                    $('#add_question_modal_body').append(response);
                },
                error: function () {
                    submitted = false;
                    console.log('Error in generating add question form')
                },
                complete: function () {
                    $(".se-pre-con-ajax").fadeOut("fast");
                }
            });
        });

        $('.editquestion-btn').on('click', function () {
            if (submitted) {
                return false
            }
            $('#edit_question_modal_body').empty();
            $('#edit_question_modal_body').append(
                `<input type="hidden" name="Assignment_Code" id="id_Assignment_Code" value="{{ object.pk }}"
                           class="select form-control">`
            )
            $('#edit_question_modal_body').attr('data-questionpk', $(this).attr('data-questionpk'))
            $.ajax({
                type: "GET",
                url: `/questioninfo/edit/${$(this).attr('data-questionpk')}/ajax/`,  // URL to your view that serves new info
                success: function (response) {
                    $('#edit_question_modal_body').append(response);
                    $('#edit_question_modal_body').find('form')
                },
                error: function () {
                    submitted = false;
                    console.log('Error in generating add question form')
                },
                complete: function () {
                    $(".se-pre-con-ajax").fadeOut("fast");
                }
            });
        });


        var submitted = false;
        $(".submitAnswer").on('click',  function (e) {
            e.preventDefault(); // avoid to execute the actual submit of the form.
            if (submitted) {
                return false
            }
            submitted = true;
            var answerdata = new FormData();
            if ($(`#id_Assignment_File${$(this).attr('data-id')}`).val()) {
                var answer_file = $(`#id_Assignment_File${$(this).attr('data-id')}`)[0].files[0];
            } else {
                var answer_file = 0;
            }
            var answer_text = $(`.form_${$(this).attr('data-id')}`).find(`iframe`).contents().find('.note-editable').html();

            if (!answer_text) {
                answer_text = '';
            }

            if (answer_file == 0 && answer_text == '') {
                console.log('empty');
            } else {
                answerdata.append("Assignment_File", answer_file);
                answerdata.append("csrfmiddlewaretoken", '{{csrf_token}}');
                answerdata.append("Assignment_Answer", answer_text);
                answerdata.append("Question_Code", $(`#id_Question_Code${$(this).attr('data-id')}`).val());
                answerdata.append("Student_Code", $(`#id_Student_Code${$(this).attr('data-id')}`).val());

                var answerformdiv = $(this).closest('form');
                $.ajax({
                    url: $(this).attr('data-url'),  // URL to your view that serves new info
                    data: answerdata,
                    // get the form data
                    type: 'post', // GET or POST
                    enctype: 'multipart/form-data',
                    processData: false,
                    xhr: function () {
                        var xhr = new window.XMLHttpRequest();
                        xhr.upload.addEventListener("progress", function (evt) {
                            if (evt.lengthComputable) {
                                var bar = $('.bar');
                                var percent = $('.percent');
                                var progress = $('.progress');
                                var percentComplete = Math.round((evt.loaded * 100) / evt.total);
                                var percentVal = percentComplete + '%';
                                percent.width(percentVal);
                                percent.html(percentVal);
                                {#$('#status').html('<b> Uploading -> ' + (Math.round(percentComplete * 100)) + '% </b>');#}
                            }
                        }, false);
                        return xhr;
                    },
                    contentType: false,
                    success: function (response) {
                        console.log('Success');
                        location.reload();
                    },
                    beforeSend: function () {
                        var html = `
                            <div class="progress" style="max-height: 10px;">
                                <div class="percent" style="max-width: 100%; background-color: limegreen;">0%</div >
                            </div>
                        `;
                        $(html).insertAfter($(answerformdiv).find('input[type=file]'));
                        var percent = $('.percent');
                        var progress = $('.progress');
                        var percentVal = '0%';
                        percent.width(percentVal);
                    },
                    complete: function (xhr) {
                        progress.remove();
                    },
                    error: function (e) {
                        submitted = false;
                        alert(e.responseJSON.msg)
                        console.log('Error in submitting file. ' + e.responseJSON.msg)
                    }
                });
            }
        });

        $('button[type=reset]').on('click', function () {
            $(this).closest('form').find('.progress').remove();
        })
    </script>


 <script>
        $(document).ready(function () {
            $('.deleteanswer').on('click', function () {
                var answerpk = this.value
                var result = confirm("Are you sure you want to delete this answer?");
                if (!result) {
                    return false
                }
                $.ajax({
                    method: 'POST',
                    url: "{% url 'assignanswerinfo_delete' %}",  // URL to your view that serves new info
                    data: {
                        csrfmiddlewaretoken: '{{ csrf_token }}',
                        'answerpk': answerpk,
                    },
                    success: function (response) {
                        location.reload()
                    },
                    error: function (err) {
                        console.log(err.responseText)
                        location.reload()
                    },
                });
            });

            $('.editanswer').click(function () {
                var assignementForm = $(this).parent().find(`.assignment_update_form`);
                var iframe = $(this).parent().find(`iframe`);
                var innerDoc = iframe.contents();
                var shortAns = $(this).parent().find(`.short_answer`).html();
                $(this).parent().children().css('display', 'none');
                assignementForm.show();

                innerDoc.find(`.note-editable`).html(shortAns);
                $(this).parent().find(`#id_Assignment_Answer`).html(shortAns);
            });

            $('.cancelBtn').on('click', function () {
                $(this).closest('.assignment_update_form').parent().children().css('display', 'block');
                $(this).closest('.assignment_update_form').hide();
            })
            //$('.resetBtn').on('click', function () {
            //  $(this).closest('.editdiv').find('textarea').val('')
            //})
        });


        // $('input[type=datetime-local]').each(function () {
        //    $(this).val(`${newdate.getFullYear()}-${('0' + newdate.getMonth()).substr(-2)}-${('0' + newdate.getDate()).substr(-2)}T${('0' + newdate.getHours()).substr(-2)}:${('0' + newdate.getMinutes()).substr(-2)}`)
        // })

        $('.inningmap-btn').on('click', function () {
            inningMapDataLoad($(this), $(this).attr('data-sessionid'), $(this).attr('data-objectid'), '{% url 'assignmentinninginfomap' %}')
        })
    </script>



{% endblock %}