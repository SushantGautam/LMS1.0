{% load static %}

<div class="outerdiv">
    {% include 'WebApp/theme/alerts.html' %}
    <div class="row">
        <div class="col-md-5 col-sm-12 col-xs-12">
            <h2 class="detailListHeader">Assignment Information</h2>
            <hr class="header_hr">
            {% if '/students' not in request.path %}
            <div class="col-md-12 col-sm-12 col-xs-12 text-center">
                <!-- <a style="float: right" href="{% if '/teachers' in request.path %}
                            /teachers{{ object.get_update_url }}
                                    {% else %}
                                        {{ object.get_update_url }}
                                    {% endif %}">
                            <b><u>Edit Assignment</u></b></a> -->
                <button type="button" class="btn-sm btn-link" data-toggle="modal" data-target="#editAssignmentModal"
                    id="editAssignment-btn">
                    Edit Assignment
                </button>
                {% if '/teachers' in request.path %}

                <span style="float: right;">
                    <button type="button" class="btn btn-link"><a id="{{ object.pk }}" class="assignment-confirm-delete"
                            style="color: rgb(255, 0, 0);cursor:pointer">Delete</a></button>
                </span>
                <form method="post" action="{% url 'teacher_assignmentinfo_delete' pk=object.pk %}"
                    id="deleteAssignment{{ object.pk }}">
                    {% csrf_token %}
                    <!-- <input type="hidden" value="{{questions.pk}}" name="question_id"> -->
                    <input type="hidden" value="{{object.pk}}" name="assignment_id">
                    <input type="hidden" value="{{object.Course_Code.id}}" name="course_id">
                    <input type="hidden" value="{{object.Chapter_Code.id}}" name="chapter_id">
                </form>
                {% else %}
                <span style="float: right;">
                    <button type="button" class="btn btn-link"><a id="{{ object.pk }}" class="assignment-confirm-delete"
                            style="color: rgb(255, 0, 0);cursor:pointer">Delete</a></button>
                </span>
                <form method="post" action="{% url 'assignmentinfo_delete' pk=object.pk %}"
                    id="deleteAssignment{{ object.pk }}">
                    {% csrf_token %}
                    <!-- <input type="hidden" value="{{questions.pk}}" name="question_id"> -->
                    <input type="hidden" value="{{object.pk}}" name="assignment_id">
                    <input type="hidden" value="{{object.Course_Code.id}}" name="course_id">
                    <input type="hidden" value="{{object.Chapter_Code.id}}" name="chapter_id">
                </form>
                {% endif %}
            </div>
            {% endif %}
            <div class="col-md-12 col-sm-12 col-xs-12">
                <h5><b>
                        <table class="table table-striped table-bordered">
                            <tr>
                                <td>Assignment Topic</td>
                                <td>{{ object.Assignment_Topic }}</td>
                            </tr>
                            <tr>
                                <td>Assignment Deadline</td>
                                <td>{{ object.Assignment_Deadline }}</td>
                            </tr>
                            <tr>
                                <td>Course Code</td>
                                <td>{{ object.Course_Code }}</td>
                            </tr>
                            <tr>
                                <td>Chapter Code</td>
                                <td>{{ object.Chapter_Code }}</td>
                            </tr>
                            <tr>
                                <td>Register Agent</td>
                                <td>{{ object.Register_Agent }}</td>
                            </tr>
                            <tr>
                                <td>Status</td>
                                <td>{% if object.Use_Flag == True %}
                                    <span class="text-success">Active</span>
                                    {% else %}
                                    <span class="text-danger">Inactive</span>
                                    {% endif %}
                                </td>
                            </tr>
                        </table>
                    </b>
                </h5>
            </div>
            <br>
            {% if 'teacher' in request.path %}
            <div class="text-center">
                <h4><a class="btn btn-sm btn-info" href="{% url 'teacher_assignment_answers' object.pk %}">View
                        Assignment Submissions</a></h4>
            </div>
            {% endif %}

        </div>
        <div class=" col-md-7 col-sm-12 col-xs-12 ">
            <div class="row">
                <div class=" col-md-8 col-sm-8 col-xs-12 text-center">
                    <h2 class="subHeader">Questions</h2>
                </div>

                {% if '/students' not in request.path %}
                <div class="col-md-4 col-sm-4 col-xs-12 text-center" style="margin-top: 10px">
                    <button type="button" class="btn-sm btn-success" data-toggle="modal" data-target="#addQuestionModal"
                        id="add-newquestion-btn">
                        Add Question
                    </button>
                </div>
                {% endif %}

            </div>

            <div class="col-md-12" style="padding-right: 0;">
                {% for questions in Questions %}

                <div class="col-md-12 col-sm-12 col-xs-12 leftborder" style="margin-bottom: 5px;padding-right: 0;">
                    <div class="col-md-8 col-sm-8 col-xs-12">
                        <h5 style="padding-top: 3px; color: #000000"> Q: {{ forloop.counter }}

                        </h5>
                        <h5>
                            <b style="color: #000000">{{ questions.Question_Title }}</b>
                        </h5>
                    </div>
                    <div class="col-md-4 col-sm-4 col-xs-12 no-padding">
                        {% if '/students' in request.path %}
                        <button class="answerButton" type="button" id="{{ questions.pk }}" style="width:100px;height:25px;border: 1px solid #017a9b;color:#017a9b;background-color: white;border-radius: 4px;
                                                    margin-top: 25px;margin-left: 40px;">ANSWER <i
                                class="fa fa-arrow-right"></i>
                        </button>
                        {% endif %}
                        <a class="moreButton" id="{{ questions.pk }}"><i class="fa fa-chevron-down"
                                style="padding-top:30px; float:right;cursor: pointer;"
                                id="moreArrow{{ questions.pk }}"></i>
                        </a>
                        {% if '/students' not in request.path %}
                        <button class="btn-link" class="btn-sm btn-success" data-toggle="modal"
                            data-target="#editQuestionModal{{ questions.pk }}" id="editquestion-btn{{ questions.pk }}">
                            Edit Question
                        </button>
                        <div class="modal fade" id="editQuestionModal{{ questions.pk }}" tabindex="-1" role="dialog"
                            aria-labelledby="editQuestionLabel" aria-hidden="true"
                            id="editquestion-btn{{ questions.pk }}">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header text-center">
                                        <h4 class="modal-title" id="editQuestionModalLabel"><b>Edit Question </b>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </h4>
                                    </div>
                                    <div class="modal-body modal-auto" id="edit_question_modal_body{{ questions.pk }}">
                                        <form method="post" class="editQuestionForm" id="{{ questions.pk }}"
                                            enctype="multipart/form-data">
                                            {% csrf_token %}
                                            <div
                                                class="col-md-12 col-sm-12 col-xs-12 no-padding form-group has-feedback">
                                                <div
                                                    class="col-md-12 col-sm-12 col-xs-12 no-padding form-group has-feedback">
                                                    <div id="div_id_Question_Title_edit" class="form-group">
                                                        <label for="id_Question_Title_edit" class="control-label ">
                                                            Question_Title
                                                        </label>
                                                        <div class="controls ">
                                                            <input type="text" name="Question_Title_edit"
                                                                maxlength="500"
                                                                id="id_Question_Title_edit{{ questions.pk }}"
                                                                class="textinput textInput form-control"
                                                                required="required"
                                                                value="{{questions.Question_Title}}">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div
                                                class="col-md-12 col-sm-12 col-xs-12 no-padding form-group has-feedback">
                                                <div id="div_id_Question_Description_edit" class="form-group">
                                                    <label for="id_Question_Description_edit" class="control-label ">
                                                        Question Description
                                                    </label>
                                                    <div class="controls ">
                                                        <textarea name="Question_Description_edit" rows="5" cols="40"
                                                            class="textarea form-control"
                                                            id="id_Question_Description_edit{{ questions.pk }}">{{ questions.Question_Description }}</textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-sm-6 col-xs-12 form-group has-feedback">
                                                <div id="div_id_Question_Score_edit" class="form-group no-padding">
                                                    <label for="id_Question_Score_edit" class="control-label ">
                                                        Question Score
                                                    </label>
                                                    <div class="controls ">
                                                        <input type="number" name="Question_Score_edit"
                                                            class="numberinput form-control"
                                                            id="id_Question_Score_edit{{ questions.pk }}"
                                                            value="{{questions.Question_Score}}">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-sm-6 col-xs-12 form-group has-feedback">
                                                <div id="div_id_Answer_Type_edit" class="form-group no-padding">
                                                    <label for="id_Answer_Type_edit"
                                                        class="control-label  requiredField">
                                                        Answer Type *
                                                    </label>
                                                    <div class="controls ">
                                                        <select name="Answer_Type_edit" class="select form-control"
                                                            required="" id="id_Answer_Type_edit{{ questions.pk }}">
                                                            <option {% if questions.Answer_Type == 'S' %} selected
                                                                {% endif %} value="S">Short Answer</option>
                                                            <option {% if questions.Answer_Type == 'F' %} selected
                                                                {% endif %} value="F">File Upload</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-12 col-sm-12 col-xs-12 form-group has-feedback">
                                                <div id="div_id_Question_Media_File_edit" class="form-group">
                                                    <label for="id_Question_Media_File_edit" class="control-label ">
                                                        Question Media File
                                                    </label>
                                                    <div class="controls ">
                                                        {% if questions.Question_Media_File %}
                                                        Currently: <a
                                                            href="{{ questions.Question_Media_File.url }}">{{questions.Question_Media_File}}</a>
                                                        <input type="checkbox" name="Question_Media_File-clear"
                                                            id="Question_Media_File-clear_id{{questions.pk}}">
                                                        <label for="Question_Media_File-clear_id">Clear</label>
                                                        <br>
                                                        Change:
                                                        {% endif %}
                                                        <input type="file" name="Question_Media_File_edit"
                                                            id="id_Question_Media_File_edit{{ questions.pk }}"
                                                            class="clearablefileinput">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-12 col-sm-12 col-xs-12 form-group has-feedback">
                                                <input type="hidden" id="id_Use_Flag_edit{{ questions.pk }}"
                                                    name="Use_Flag" value="True">
                                                <input type="hidden" name="Register_Agent_edit"
                                                    id="id_Register_Agent_edit{{ questions.pk }}"
                                                    value="{{ request.user.id }}" class="select form-control">
                                                <input type="hidden" name="Assignment_Code_edit"
                                                    id="id_Assignment_Code_edit{{ questions.pk }}"
                                                    value="{{ object.id }}" class="select form-control">
                                            </div>

                                            * are the required fields
                                            <br><br>
                                            <div class="submitButton text-center col-md-12">
                                                <button class="btn btn-success" type="submit">Submit</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% if '/teachers' in request.path %}

                        <span style="float: right;"><a id="{{ questions.pk }}" class="confirm-delete"
                                style="color: #2A3F54;cursor:pointer">
                                Delete
                            </a></span>

                        <form method="post"
                            action="{% url 'teacher_questioninfo_delete' assignment=object.pk pk=questions.pk %}"
                            id="deleteQuestion{{ questions.pk }}">
                            {% csrf_token %}
                            <input type="hidden" value="{{questions.pk}}" name="question_id">
                            <input type="hidden" value="{{object.pk}}" name="assignment_id">
                            <input type="hidden" value="{{object.Course_Code.id}}" name="course_id">
                            <input type="hidden" value="{{object.Chapter_Code.id}}" name="chapter_id">
                        </form>
                        {% else %}
                        <span style="float: right;"><a id="{{ questions.pk }}" class="confirm-delete"
                                style="color: #2A3F54;cursor:pointer">
                                Delete
                            </a></span>

                        <form method="post"
                            action="{% url 'webapp_questioninfo_delete' assignment=object.pk pk=questions.pk %}"
                            id="deleteQuestion{{ questions.pk }}">
                            {% csrf_token %}
                            <input type="hidden" value="{{questions.pk}}" name="question_id">
                            <input type="hidden" value="{{object.pk}}" name="assignment_id">
                            <input type="hidden" value="{{object.Course_Code.id}}" name="course_id">
                            <input type="hidden" value="{{object.Chapter_Code.id}}" name="chapter_id">
                        </form>
                        {% endif %}
                        {% endif %}
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12" id="questionContent{{ questions.pk }}"
                        style="display: none;">
                        {% if  questions.Question_Score %}
                        <div class=" col-md-4 col-sm-12 col-xs-12 no-padding">
                            Question Score :
                        </div>
                        <div class=" col-md-8 col-sm-12 col-xs-12 no-padding">
                            <b style="color: #000000">{{ questions.Question_Score }}</b>
                        </div>
                        {% endif %}
                        {% if  questions.Question_Description %}
                        <div class=" col-md-4 col-sm-12 col-xs-12 no-padding">
                            Question Description :
                        </div>
                        <div class=" col-md-8 col-sm-12 col-xs-12 no-padding">
                            <b style="color: #000000">{{ questions.Question_Description }}</b>
                        </div>
                        {% endif %}
                        {% if questions.Answer_Type %}
                        <div class="col-md-4 col-sm-12 col-xs-12 no-padding">
                            Answer Type :

                        </div>
                        <div class=" col-md-8 col-sm-12 col-xs-12 no-padding">
                            <b style="color: #000000">
                                {% if questions.Answer_Type == 'S' %}
                                Short Answer
                                {% else %}
                                File Upload
                                {% endif %}</b> </div>
                        {% endif %}
                        {% if  questions.Question_Media_File %}
                        <div class=" col-md-4 col-sm-12 col-xs-12 no-padding">
                            Question Media :
                        </div>
                        <div class=" col-md-12 col-sm-12 col-xs-12 no-padding text-center">
                            <!-- <b style="color: #000000">{{ questions.Question_Media_File }}</b> -->
                            {% if questions.extension == '.jpg' or questions.extension == '.png' %}
                            <img class="card-img-top" width="400px" src="{{ questions.Question_Media_File.url }}">
                            {% else %}
                            <a href="{{ questions.Question_Media_File.url }}" target="_blank"><b
                                    style="color:#017a9b">Click
                                    to view attatched file</b></a>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                    <div class="x_panel" id="answerContent{{ questions.pk }}" style="display: none">
                        <div class="x_content">
                            {% for answer in Answers %}
                                {% if questions.id == answer.Question_Code.id %}
                                    {% if answer.Assignment_Answer != '' %}
                                        <p style="margin: 0;color:#000000;">{{ answer.Assignment_Answer }}</p>
                                    {% else %}
                                        <p style="margin: 0;color:#000000;">File has been Submitted</p>

                                        <a href="{{ answer.Assignment_File.url }}" target="_blank"><b
                                                style="color:#017a9b">Click
                                            to view Submitted file</b></a>
                                        <button class="btn btn-danger deleteanswer" value="{{ answer.pk }}"
                                                style="float: right" title="Delete Answer"><i class="fa fa-trash"
                                                                                              aria-hidden="true"></i>
                                        </button>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}

                            {% for answer in notAnswered %}
                                {% if  questions.id == answer %}
                                    <form enctype="multipart/form-data" method="post" id="{{ questions.id }}"
                                          data-parsley-validate="" class="form-horizontal form-label-left submitAnswer"
                                          novalidate="" data-id="{{ questions.id }}">
                                        {% csrf_token %}
                                {% if questions.Answer_Type == 'S' %}
                                <div class="form-group">
                                    <textarea class="form-control rounded-0" rows="5" cols="100"
                                        name="Assignment_Answer" id="id_Assignment_Answer{{questions.id}}"
                                        placeholder="Enter your Answer" required></textarea>
                                    <input type="hidden" value="{{ request.user.id }}" name="Student_Code"
                                        id="id_Student_Code{{questions.id}}">
                                    <input type="hidden" value="{{ questions.id }}" name="Question_Code"
                                        id="id_Question_Code{{questions.id}}">

                                </div>
                                <div class="form-group text-center">
                                    <!-- <button class="btn btn-primary" type="button" id="cancelButton{{ questions.pk }}">
                                                Cancel
                                            </button> -->
                                    <button class="btn btn-sm btn-primary" type="reset">Reset</button>
                                    <button type="submit" class="btn btn-sm btn-success submitAnswer"
                                        id="answer{{questions.id}}">Submit</button>
                                </div>
                                {% elif questions.Answer_Type == 'F' %}

                                <div class="form-group">
                                    <input type="file" name="Assignment_File" id="id_Assignment_File{{questions.id}}"
                                        required />
                                    <input type="hidden" value="{{ request.user.id }}" name="Student_Code"
                                        id="id_Student_Code{{questions.id}}">
                                    <input type="hidden" value="{{ questions.id }}" name="Question_Code"
                                        id="id_Question_Code{{questions.id}}">
                                </div>
                                <div class="form-group text-center">
                                    <button class="btn btn-sm btn-primary" type="button"
                                        id="cancelButton{{ questions.pk }}">
                                        Cancel
                                    </button>
                                    <button type="submit" class="btn btn-sm btn-success submitAnswer"
                                        id="answer{{questions.id}}">Submit</button>
                                </div>
                                {% endif %}
                            </form>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

    </div>


</div>
<div class="modal fade" id="addQuestionModal" tabindex="-1" role="dialog" aria-labelledby="addQuestionModalLabel"
    aria-hidden="true" id="add_question_modal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h4 class="modal-title" id="addQuestionModalLabel"><b>Add Question </b>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </h4>
            </div>
            <div class="modal-body modal-auto" id="add_question_modal_body">
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="editAssignmentModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h4 class="modal-title" id="exampleModalLabel"><b>Edit Assignment </b>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </h4>
            </div>
            <div class="modal-body modal-auto" id="editAssignment_modal_body">
                <form method="post" id="ajaxassignmentinfoform">
                    {% csrf_token %}
                    <div class="col-md-12 col-sm-12 col-xs-12 form-group has-feedback">
                        <div id="div_id_Assignment_Topic_edit" class="form-group">
                            <label for="id_Assignment_Topic_edit" class="control-label ">
                                Assignment Topic *
                            </label>
                            <div class="controls ">
                                <input type="text" name="Assignment_Topic" maxlength="500" id="id_Assignment_Topic_edit"
                                    class="textinput textInput form-control" required="required"
                                    value="{{object.Assignment_Topic}}">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 form-group has-feedback">
                        <div id="div_id_Assignment_Deadline_edit" class="form-group">
                            <label for="id_Assignment_Deadline_edit" class="control-label ">
                                Assignment Deadline *
                            </label>
                            <div class="controls ">
                                <input type="date" name="Assignment_Deadline_edit" class="datetimeinput form-control"
                                    id="id_Assignment_Deadline_edit" value="{{object.Assignment_Deadline|date:'Y-m-d'}}"
                                    min="{{datetime|date:'Y-m-d'}}" max="9999-12-31">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <label>Publish</label><br>
                        <input type="checkbox" id="id_Use_Flag" class="js-switch" name="Use_Flag"
                            {% if object.Use_Flag == False %} &nbsp; {% elif object.Use_Flag == True %} checked
                            {% endif %}><br> <br>
                    </div>
                    <div class="result text-center"></div>

                    <div class="col-md-12 col-sm-12 col-xs-12 form-group has-feedback">
                        <input type="hidden" name="Register_Agent" id="id_Register_Agent" value="{{ request.user.id }}"
                            class="select form-control">
                        <input type="hidden" name="Course_Code" id="id_Course_Code" value="{{ object.Course_Code.id }}"
                            class="select form-control">
                        <input type="hidden" name="Chapter_Code" id="id_Chapter_Code"
                            value="{{ object.Chapter_Code.id }}" class="select form-control">
                        <input type="hidden" name="today_date" id="id_today_date" value="{{datetime|date:'Y-m-d'}}"
                            class="select form-control">
                    </div>

                    <div class="submitButton text-center col-md-12">
                        <button class="btn btn-success" type="submit">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% block customjss %}

<script src="{% static 'vendorsx/jquery/dist/jquery.min.js' %}"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script src=" {% static 'vendorsx/jQuery-Smart-Wizard/js/jquery.smartWizard.js' %}"></script>
<script>    $(".se-pre-con-ajax").fadeOut("fast");</script>
<script>
    const selectElement = document.querySelector('#id_Assignment_Deadline_edit');
    selectElement.addEventListener('change', (event) => {
        const result = document.querySelector('.result');
        var date = Date.parse($('#id_today_date').val());
        var deadline = Date.parse(event.target.value);
        var remaining = (deadline - date) / (1000 * 3600 * 24);
        if (remaining < 0) {
            result.textContent = `Days Remaining : Invalid`;

        }
        else {
            result.textContent = `Days Remaining : ${remaining} days`;

        };
    });
</script>
<script>
    $(".editQuestionForm").submit(function (e) {
        e.preventDefault(); // avoid to execute the actual submit of the form.
        var formdata = new FormData();
        var file = $(`#id_Question_Media_File_edit${this.id}`)[0].files[0];
        formdata.append("Question_Media_File", file);
        formdata.append("csrfmiddlewaretoken", '{{ csrf_token }}');
        formdata.append("clear", $(`#Question_Media_File-clear_id${this.id}`).is(":checked"));
        // console.log($(`#Question_Media_File-clear_id${this.id}`).is(":checked"));
        formdata.append("Question_Title", $(`#id_Question_Title_edit${this.id}`).val());
        formdata.append("Question_Score", $(`#id_Question_Score_edit${this.id}`).val());
        formdata.append("Question_Description", $(`#id_Question_Description_edit${this.id}`).val());
        formdata.append("Answer_Type", $(`#id_Answer_Type_edit${this.id}`).val());
        formdata.append("Use_Flag", $(`#id_Use_Flag_edit${this.id}`).val());
        formdata.append("Register_Agent", $(`#id_Register_Agent_edit${this.id}`).val());
        formdata.append("Assignment_Code", $(`#id_Assignment_Code_edit${this.id}`).val());
        formdata.append("pk", this.id);

        $.ajax({
            url: "{% url 'webapp_questioninfo_edit_ajax' %}",  // URL to your view that serves new info
            data: formdata,
            // get the form data
            type: $(this).attr('method'), // GET or POST
            enctype: 'multipart/form-data',
            processData: false,
            contentType: false,
            success: function (response) {
                console.log('Success')
                location.reload()
            },
            error: function () {
                console.log('Error in posting question edit form')
            }

        });
    });
</script>
<script>
    $("#ajaxassignmentinfoform").submit(function (e) {
        e.preventDefault(); // avoid to execute the actual submit of the form.
        $.ajax({
            url: "{% url 'assignmentinfo_edit_ajax' %}",  // URL to your view that serves new info
            data: {
                "csrfmiddlewaretoken": '{{ csrf_token }}',
                "Assignment_Topic": $('#id_Assignment_Topic_edit').val(),
                "Assignment_Deadline": $('#id_Assignment_Deadline_edit').val(),
                "Use_Flag": $('#id_Use_Flag').is(":checked"),
                "Course_Code": $('#id_Course_Code').val(),
                "Chapter_Code": $('#id_Chapter_Code').val(),
                "Register_Agent": $('#id_Register_Agent').val(),
                "Assignment_ID": '{{ object.id }}'
            },
            // get the form data
            type: $(this).attr('method'), // GET or POST
            success: function (response) {
                console.log('Success')
                location.reload()
            },
            error: function () {
                console.log('Error in posting assignment edit form')
            }

        });
    });
</script>
<script>
    $('#myModal').on('shown.bs.modal', function () {
        $('#myInput').trigger('focus')
    });

    $(document).on('click', '.confirm-delete', function () {
        ans = confirm('Are you sure you want to delete this Question?');
        if (ans == true) {
            $(`#deleteQuestion${this.id}`).submit();
        } else {
            return false;
        }
    });

    $(document).on('click', '.assignment-confirm-delete', function () {
        ans = confirm('Are you sure you want to delete this Assignment?');
        if (ans == true) {
            $(`#deleteAssignment${this.id}`).submit();
        } else {
            return false;
        }
    });

    $('#add-newquestion-btn').on('click', function () {
        $('#add_question_modal_body').empty();
        $('#add_question_modal_body').append(
            `<input type="hidden" name="Assignment_Code" id="id_Assignment_Code" value="{{ object.pk }}"
                           class="select form-control">`
        )
        $.ajax({
            type: "GET",
            url: "{% url 'questioninfo_create_ajax' %}",  // URL to your view that serves new info
            success: function (response) {
                $('#add_question_modal_body').append(response);
            },
            error: function () {
                console.log('Error in generating add question form')
            },
            complete: function () {
                $(".se-pre-con-ajax").fadeOut("fast");
            }
        });
    });


    var submitted = false;
    $(".submitAnswer").submit(function (e) {
        e.preventDefault(); // avoid to execute the actual submit of the form.
        if (submitted) {
            return false
        }
        submitted = true;
        var answerdata = new FormData();
        if ($(`#id_Assignment_File${this.id}`).val()) {
            var answer_file = $(`#id_Assignment_File${this.id}`)[0].files[0];
        } else {
            var answer_file = 0;
        }

        if ($(`#id_Assignment_Answer${this.id}`).val()) {
            var answer_text = $(`#id_Assignment_Answer${this.id}`).val();
        } else {
            var answer_text = '';
        }

        if (answer_file == 0 && answer_text == '') {
            console.log('empty');
        } else {
            answerdata.append("Assignment_File", answer_file);
            answerdata.append("csrfmiddlewaretoken", '{{csrf_token}}');
            answerdata.append("Assignment_Answer", answer_text);
            answerdata.append("Question_Code", $(`#id_Question_Code${this.id}`).val());
            answerdata.append("Student_Code", $(`#id_Student_Code${this.id}`).val());

            $.ajax({
                url: "{% url 'assignanswerinfo_create_ajax' %}",  // URL to your view that serves new info
                data: answerdata,
                // get the form data
                type: $(this).attr('method'), // GET or POST
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (response) {
                    console.log('Success')
                    location.reload()
                },
                error: function (e) {
                    submitted = false;
                    alert(e.responseJSON.msg)
                    console.log('Error in submitting file. ' + e.responseJSON.msg)
                }
            });
        }
    });
</script>

    <script>
        $(".answerButton").click(function () {
            $(`#answerContent${this.id}`).toggle();
        });
        $(".moreButton").click(function () {
            $(`#questionContent${this.id}`).toggle();
        });
    </script>

    <script>
        $(document).ready(function () {
            $('.deleteanswer').on('click', function () {
                var answerpk = this.value
                var result = confirm("Are you sure you want to delete this answer?");
                if (!result) {
                    return false
                }
                $.ajax({
                    method: 'POST',
                    url: "{% url 'assignanswerinfo_delete' %}",  // URL to your view that serves new info
                    data: {
                        csrfmiddlewaretoken: '{{ csrf_token }}',
                        'answerpk': answerpk,
                    },
                    success: function (response) {
                        location.reload()
                    },
                    error: function (err) {
                        console.log(err.responseText)
                        location.reload()
                    },
                });
            });
        })
    </script>
{% endblock %}