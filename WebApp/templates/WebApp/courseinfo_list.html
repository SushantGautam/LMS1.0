{% extends "base.html" %}
{% load static %}

{% block title %}
| Courses
{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'start' %}">Home</a></li>
<li class="breadcrumb-item active" aria-current="page">Course</li>
{% endblock %}

{% block content %}
{% include 'course/courseinfo_list.html' %}
{% endblock content %}

{% block javascript %}
<script>
    $(".button-info").click(function () {
        $("ul.info-text").toggle();
    });

    $('#form_import_csv').submit(function (e) {
        e.preventDefault();
        var formData = new FormData($('form').get(0));
        // csrf = $('#csrfmiddlewaretoken').get(0).files[0];
        csrf = $('input[name="csrfmiddlewaretoken"]').attr('value');
        formData.append("csrfmiddlewaretoken", csrf);
        if ($('#id_import_csv').val()) {
            $('#submitspinner').html(`<i class="fa fa-spinner fa-spin"></i> `);
            $('#submitcsv').attr('disabled', true);
            $('.closeImportCSV').attr('disabled', true);
            $.ajax({
                type: "POST",
                url: "{% url 'csv_import_course' %}",  // URL to your view that serves new info
                data: formData,
                cache: false,
                processData: false,
                contentType: false,
                success: function (response) {
                    $('.import-message').addClass(response.class);
                    $('.import-message').removeClass(response.rmclass);
                    $('.import-message').html(response.message);
                },
                error: function () {
                    $('.import-message').addClass('text-danger');
                    $('.import-message').removeClass('text-sucess');
                    $('.import-message').html("Error while processing data please try again and verify the format.");
                },
                complete: function () {
                    $('#submitspinner').html(``);
                    $('#submitcsv').attr('disabled', false);
                    $('.closeImportCSV').attr('disabled', false);
                }
            });
        } else {
            $('.import-message').addClass('text-danger');
            $('.import-message').html("Please upload a csv file with defined format.");
        }
    });

    $('.closeImportCSV').click(function () {
        window.location.reload();
    });

    $(".query_form").submit(function (e) {
        val = $(this).find('input').val()
        if (!val.replace(/^\s+|\s+$/g, "").length != 0) {
            console.log('empty')
            alert('Please enter a search term')
            e.preventDefault()
        }
    });
</script>
{% endblock %}