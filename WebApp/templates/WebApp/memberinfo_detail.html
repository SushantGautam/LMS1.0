{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% block breadcrumb %}
    <li class="breadcrumb-item"><a href="{% url 'memberinfo_list' %}">{% trans 'Member' %}</a></li>
    <li class="breadcrumb-item active" aria-current="page">{{ object.username }}</li>
{% endblock %}

{% block content %}

    <div class="outerdiv">
        <h2 class="detailListHeader">{% trans 'Member Information' %}</h2>
        <hr class="header_hr">
        <div class="col-md-12">{% include 'WebApp/theme/alerts.html' %}</div>
        <div class="col-md-8 col-sm-12 col-xs-12 text-center col-md-offset-2">
            <div class="circleProfile text-center">
                <img src="{{ object.Avatar }}">
            </div>
            <div class="text-center">
                <a class="member-edit" style="float: right;color: #2A3F54" href="{{ object.get_update_url }}"><b>{% trans 'Edit Member' %}</b></a>
            </div>
        </div>
        <div class="col-md-8 col-sm-12 col-xs-12 col-md-offset-2">
            <h5><b>
                <table class="table table-striped table-bordered">
                    <tr>
                        <td class="mediumblack">{% trans 'Member ID' %}</td>
                        <td>{{ object.Member_ID }} <small style="padding-left: 3em;"> {% trans 'Assigned by center' %} </small></td>
                    </tr>
                    <tr>
                        <td class="mediumblack">{% trans 'Username' %}</td>
                        <td>{{ object.username }} <small style="padding-left: 3em;"> {% trans 'Used for login' %} </small></td>
                    </tr>

                    <tr>
                        <td class="mediumblack">{% trans 'Full Name' %}</td>
                        <td>{{ object.first_name }} {{ object.last_name }}</td>
                    </tr>
                    <tr>
                        <td class="mediumblack">{% trans 'Email' %}</td>
                        <td>{{ object.email }}</td>
                    </tr>
                    <tr>
                        <td class="mediumblack">{% trans 'Department' %}</td>
                        <td>{{ object.Member_Department }}</td>
                    </tr>

                    {% if object.Is_Teacher %}
                        <tr>
                            <td class="mediumblack">{% trans 'Position' %}</td>
                            <td>{{ object.Member_Position }}</td>
                        </tr>
                    {% endif %}
                    <tr>
                        <td class="mediumblack">{% trans 'Permanent Address' %}</td>
                        <td>{{ object.Member_Permanent_Address }}</td>
                    </tr>
                    <tr>
                        <td class="mediumblack">{% trans 'Temporary Address' %}</td>
                        <td>{{ object.Member_Temporary_Address }}</td>
                    </tr>
                    <tr>
                        <td class="mediumblack">{% trans 'BirthDate' %}</td>
                        <td>{{ object.Member_BirthDate|date:"F d, Y" }}</td>
                    </tr>
                    <tr>
                        <td class="mediumblack">{% trans 'Phone No' %}.</td>
                        <td>{{ object.Member_Phone }}</td>
                    </tr>

                    <tr>
                        <td class="mediumblack">Gender</td>
                        <td>{% if object.Member_Gender == 'M' %}
                            {% trans 'Male' %}
                        {% elif object.Member_Gender == 'F' %}
                            {% trans 'Female' %}
                        {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td class="mediumblack">{% trans 'Status' %}</td>
                        <td>{% if  object.Use_Flag  == True %}
                            <span class="text-success">{% trans 'Active' %}</span>
                            <a style="float: right;color: #2A3F54;cursor:pointer" class="confirm-deactivate"
                               id="{{ object.id }}"><u> {% trans 'Deactivate' %} </u></a>
                            <form method="post" action="{% url 'memberinfo_deactivate'  pk=object.pk %}"
                                  id="deactivateForm">
                                {% csrf_token %}
                            </form>
                        {% else %}
                            <span class="text-danger">{% trans 'Blocked' %}</span>
                            <a style="float: right;color: #2A3F54;cursor:pointer" class="confirm-activate"
                               id="{{ object.id }}"><u> {% trans 'Activate' %} </u></a>
                            <form method="post" action="{% url 'memberinfo_activate'  pk=object.pk %}"
                                  id="activateForm">
                                {% csrf_token %}
                                <input type="hidden" value='' name='url'>
                            </form>
                        {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td class="mediumblack">{% trans 'Register DateTime' %}</td>
                        <td class="">
                            <span class="dateconFullMonth">{{ object.date_joined|date:"d M, Y h:i A" }}</span>
                        </td>
                    </tr>
                    <tr>
                        <td class="mediumblack">{% trans 'Member Type' %}</td>
                        <td>
                            {% if object.Is_CenterAdmin %}
                                &nbsp;{% trans 'Admin' %}
                            {% endif %}
                            {% if object.Is_Teacher %}
                                &nbsp;{% trans 'Teacher' %}
                            {% endif %}
                            {% if object.Is_Student %}
                                &nbsp;{% trans 'Student' %}
                            {% endif %}

                        </td>
                    </tr>
                    {% if object.password %}
                        <tr>
                            <td class="mediumblack">{% trans 'Password' %}</td>
                            <td>&nbsp;******** <a style="float: right;color: #2A3F54"
                                                  href="/change-password/{{ object.id }}/"><u> {% trans 'Change Password' %} </u></a>
                            </td>
                        </tr>
                    {% elif not object.password %}
                        <tr>
                            <td class="mediumblack">{% trans 'Password' %}</td>
                            <td><a style="float: middle" href="/change-password/{{ object.id }}/"><u> {% trans 'Add New Password' %}
                            </u></a></td>
                        </tr>
                    {% endif %}
                </table>
            </b></h5>
            <div class="text-center">
                <a class="confirm-delete" style="color: #2A3F54;cursor:pointer">
                    <b><u>{% trans 'Delete Member' %}</u></b>
                </a><small style="color:#2A3F54"><u> ({% trans 'Note: Instead of deleting a member you can deactivate him/her instead' %})</u></small>
                <br><br>
                <form method="post" action="{% url 'memberinfo_delete' pk=object.pk %}" id="delete_form">
                    {% csrf_token %}
                    <input type="hidden">
                </form>
            </div>
        </div>
        {% if object.Is_Student %}
            <div class="row" style="margin-bottom: 15px;">
                <div class="col col-md-6" style="height:220px; overflow:auto">
                    <h4 style="font-weight: 600; text-align:center"> {% trans 'Student Associated Sessions List' %} </h4>
                    <table class="table table-bordered table-striped memberdatatable">
                        <thead>
                        <tr>
                            <th>{% trans 'No' %}.</th>
                            <th>{% trans 'Session Name' %}</th>
                            <th>{% trans 'Status' %}</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for session in student_sessions %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>
                                    <a href="{{ session.get_absolute_url }}">
                                        {{ session.Inning_Name }}
                                    </a>
                                </td>
                                <td>
                                    {% now "Y-m-d H:i" as todays_datewithtime %}
                                    {% if session.Use_Flag and session.Start_Date|date:"Y-m-d H:i" < todays_datewithtime and session.End_Date|date:"Y-m-d H:i" > todays_datewithtime %}
                                        <span class="badge badge-success">{% trans 'Active' %}</span>
                                    {% elif session.Use_Flag and session.Start_Date|date:"Y-m-d H:i" > todays_datewithtime %}
                                        <span class="badge badge-warning">{% trans 'Expired' %}</span>
                                    {% else %}
                                        <span class="badge badge-danger">{% trans 'Expired' %}</span>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="col col-md-6" style="height:220px; overflow:auto">
                    <h4 style="font-weight: 600; text-align:center"> {% trans 'Student Associated Groups List' %} </h4>
                    <table class="table table-bordered table-striped memberdatatable">
                        <thead>
                        <tr>
                            <th>{% trans 'No' %}.</th>
                            <th>{% trans 'Group Name' %}</th>
                            <th>{% trans 'Student Count' %}</th>
                            <th>{% trans 'Status' %}</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for group in student_groups %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td><a href="{{ group.get_absolute_url }}">{{ group.GroupMapping_Name }}</a></td>
                                <td>{{ group.Students.all.count }}</td>
                                <td>
                                    {% if group.Use_Flag %}
                                        <span class="badge badge-success">{% trans 'Active' %}</span>
                                    {% else %}
                                        <span class="badge badge-danger">{% trans 'Inactive' %}</span>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        {% endif %}
        {% if object.Is_Teacher %}
            <div class="row">
                <div class="col col-md-6" style="height:220px; overflow:auto">
                    <h4 style="font-weight: 600; text-align:center"> {% trans 'Teacher Associated Sessions List' %} </h4>
                    <table class="table table-bordered table-striped memberdatatable">
                        <thead>
                        <tr>
                            <th>{% trans 'No' %}.</th>
                            <th>{% trans 'Session Name' %}</th>
                            <th>{% trans 'Status' %}</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for session in teacher_sessions %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>
                                    <a href="{{ session.get_absolute_url }}">
                                        {{ session.Inning_Name }}
                                    </a>
                                </td>
                                <td>
                                    {% now "Y-m-d H:i" as todays_datewithtime %}
                                    {% if session.Use_Flag and session.Start_Date|date:"Y-m-d H:i" < todays_datewithtime and session.End_Date|date:"Y-m-d H:i" > todays_datewithtime %}
                                        <span class="badge badge-success">{% trans 'Active' %}</span>
                                    {% else %}
                                        <span class="badge badge-danger">{% trans 'Inactive' %}</span>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="col col-md-6" style="height:220px; overflow:auto">
                    <h4 style="font-weight: 600; text-align:center"> {% trans 'Teacher Associated Groups List' %} </h4>
                    <table class="table table-bordered table-striped memberdatatable">
                        <thead>
                        <tr>
                            <th>{% trans 'No' %}.</th>
                            <th>{% trans 'Group Name' %}</th>
                            <th>{% trans 'Course Name' %}</th>
                            <th>{% trans 'Teacher Count' %}</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for group in teacher_groups %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td><a href="{{ group.get_absolute_url }}">{{ group.InningGroup_Name }}</a></td>
                                <td>
                                    <a href="{{ group.Course_Code.get_absolute_url }}">
                                        {{ group.Course_Code.Course_Name }}
                                    </a>
                                </td>
                                <td>{{ group.Teacher_Code.all.count }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        {% endif %}
    </div>

{% endblock %}


{% block customjss %}
    <script>
        $(document).on('click', '.confirm-deactivate', function (event) {
            ans = confirm('Are you sure you want to deactivate this Member?');
            if (ans == true) {
                $('#deactivateForm').submit();
            } else {
                return false;
            }
        });
        $(document).on('click', '.confirm-activate', function (event) {
            ans = confirm('Are you sure you want to activate this Member?');
            if (ans == true) {
                $('#activateForm').submit();
            } else {
                return false;
            }
        });

        $(document).on('click', '.confirm-delete', function () {
            ans = confirm('Are you sure you want to delete this Member?');
            if (ans == true) {
                $('#delete_form').submit();
            } else {
                return false;
            }
        });

        $(document).ready(function () {

            var table_main = $('.memberdatatable').DataTable({
                responsive: true,
                dom: 'lBfrtip',
                buttons: [],
                "searching": false,
                "bPaginate": false,
                "bLengthChange": false,
                "bFilter": true,
                "bInfo": false,
                "bAutoWidth": false
            });
        });
    </script>
{% endblock %}