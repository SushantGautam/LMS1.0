{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'start' %}">{% trans "Home" %}</a></li>
<li class="breadcrumb-item"><a href="{% url 'memberinfo_list' %}">{% trans "Member" %}</a></li>
<li class="breadcrumb-item" aria-current="page">{{ object.username }}</li>
{% endblock %}
{% block content %}
<div class="container">
    <div class="page-header">
        <div class="page-title d-block text-center">
            <h2>{% trans "Member Information" %}</h2>
        </div>
    </div>
    <div class="text-center">
        <figure class="avatar mr-2" style="height: 10rem; width: 10rem;">
            {% if object.Avatar %}
            <img src="{{ object.Avatar }}" class="rounded-circle" alt="avatar">
            {% else %}
            <img src="{% static 'media/image/user/man_avatar3.jpg'%}" class="rounded-circle" alt="avatar">
            {% endif %}
        </figure>
    </div>
    <a class="float-right font-weight-bold text-warning my-3"
        href="{{ object.get_update_url }}">{% trans "Edit Member" %}</a>
    <table class="table table-striped table-bordered pt-3">
        <tr>
            <td>{% trans "Member ID" %}</td>
            <td style="max-width:12rem">
                {{ object.Member_ID }} <small class="float-right"> {% trans "Assigned by center" %}</small>
            </td>
            <td>{% trans "Username" %}</td>
            <td>{{ object.username }} <small class="float-right"> {% trans "Used for login" %}</small></td>
        </tr>

        <tr>
            <td>{% trans "Full Name" %}</td>
            <td>{{ object.first_name }} {{ object.last_name }}</td>
            <td>{% trans "Email" %}</td>
            <td>{{ object.email }}</td>
        </tr>
        <tr>
            <td>{% trans "Department" %}</td>
            <td>{{ object.Member_Department }}</td>
            {% if object.Is_Teacher %}
            <td>{% trans "Position" %}</td>
            <td>{{ object.Member_Position }}</td>
            {% endif %}
        </tr>
        <tr>
            <td>{% trans "Permanent Address" %}</td>
            <td>{{ object.Member_Permanent_Address }}</td>
            <td>{% trans "Temporary Address" %}</td>
            <td>{{ object.Member_Temporary_Address }}</td>
        </tr>
        <tr>
            <td>{% trans "BirthDate" %}</td>
            <td>{{ object.Member_BirthDate|date:"F d, Y" }}</td>
            <td>{% trans "Phone Number" %}</td>
            <td>{{ object.Member_Phone }}</td>
        </tr>
        <tr>
            <td>{% trans "Gender" %}</td>
            <td>{% if object.Member_Gender == 'M' %}
                {% trans "Male" %}
                {% elif object.Member_Gender == 'F' %}
                {% trans "Female" %}
                {% endif %}
            </td>
            <td>{% trans "Status" %}</td>
            <td>{% if  object.Use_Flag  == True %}
                <span class="text-success">{% trans "Active" %}</span>
                <a href="javascript:void(0)" class="confirm-deactivate float-right" id="{{object.id}}"><u>
                        {% trans "Deactivate" %} </u></a>
                <form method="post" action="{% url 'memberinfo_deactivate'  pk=object.pk %}" id="deactivateForm">
                    {% csrf_token %}
                </form>
                {% else %}
                <span class="text-danger">{% trans "Blocked" %}</span>
                <a href="javascript:void(0)" class="confirm-activate float-right" id="{{object.id}}"><u>
                        {% trans "Activate" %} </u></a>
                <form method="post" action="{% url 'memberinfo_activate'  pk=object.pk %}" id="activateForm">
                    {% csrf_token %}
                    <input type="hidden" value='' name='url'>
                </form>
                {% endif %}
            </td>
        </tr>
        <tr>
            <td>{% trans "Register DateTime" %}</td>
            <td class="datecon">{{ object.date_joined|date:'M d, Y H:i' }}</td>
            <td>{% trans "Member Type" %}</td>
            <td>
                {% if object.Is_CenterAdmin %}
                &nbsp;{% trans "Admin" %}
                {% endif %}
                {% if object.Is_Teacher %}
                &nbsp;{% trans "Teacher" %}
                {% endif %}
                {% if object.Is_Student %}
                &nbsp;{% trans "Student" %}
                {% endif %}
            </td>
        </tr>
        {% if object.password %}
        <tr>
            <td>{% trans "Password" %}</td>
            <td colspan="3">&nbsp;******** <a href="/change-password/{{ object.id }}/" class="float-right"><u>
                        {% trans "Change Password" %} </u></a>
            </td>
        </tr>
        {% elif not object.password %}
        <tr>
            <td>{% trans "Password" %}</td>
            <td colspan="3">
                <a href="/change-password/{{ object.id }}/" class="float-right">
                    <u> {% trans "Add New Password" %} </u>
                </a>
            </td>
        </tr>
        {% endif %}
    </table>
    <div class="text-center">
        <a class="confirm-delete" style="color: #2A3F54;cursor:pointer">
            <b><u>{% trans "Delete Member" %}</u></b>
        </a><small style="color:#2A3F54"><u> ({% trans "Note" %}: {% trans "Instead of" %}
                {% trans "deleting a member" %} {% trans "you can" %} {% trans "deactivate" %}
                {% trans "him" %}/{% trans "her" %}
                {% trans "instead" %})</u></small>
        <br><br>
        <form method="post" action="{% url 'memberinfo_delete' pk=object.pk %}" id="delete_form">
            {% csrf_token %}
            <input type="hidden">
        </form>
    </div>

    {% if object.Is_Student %}
    <div class="row mt-4">
        <div class="col-lg-6 col-md-12" style="max-height:220px; overflow:auto">
            <h4 class="text-center text-primary pb-2"> Student Associated Sessions List </h4>
            <table class="table table-bordered table-striped memberdatatable">
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>Session Name</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for session in student_sessions %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>
                            <a href="{{ session.get_absolute_url }}">
                                {{ session.Inning_Name }}
                            </a>
                        </td>
                        <td>
                            {% now "Y-m-d H:i" as todays_datewithtime %}
                            {% if session.Use_Flag and session.Start_Date|date:"Y-m-d H:i" < todays_datewithtime and session.End_Date|date:"Y-m-d H:i" > todays_datewithtime %}
                            <span class="badge badge-success">Active</span>
                            {% elif session.Use_Flag and session.Start_Date|date:"Y-m-d H:i" > todays_datewithtime %}
                            <span class="badge badge-warning">Expired</span>
                            {% else %}
                            <span class="badge badge-danger">Expired</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3" class="text-center">No Sessions Added</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="col-lg-6 col-md-12" style="max-height:220px; overflow:auto">
            <h4 class="text-center text-primary pb-2"> Student Associated Groups List </h4>
            <table class="table table-bordered table-striped memberdatatable">
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>Group Name</th>
                        <th>Student Count</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for group in student_groups %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td><a href="{{ group.get_absolute_url }}">{{ group.GroupMapping_Name }}</a></td>
                        <td>{{ group.Students.all.count }}</td>
                        <td>
                            {% if group.Use_Flag %}
                            <span class="badge badge-success">Active</span>
                            {% else %}
                            <span class="badge badge-danger">Inactive</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center">No Groups Added</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
    {% if object.Is_Teacher %}
    <div class="row mt-4">
        <div class="col-lg-6 col-md-12" style="max-height:220px; overflow:auto">
            <h4 class="text-center text-primary pb-2"> Teacher Associated Sessions List </h4>
            <table class="table table-bordered table-striped memberdatatable">
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>Session Name</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for session in teacher_sessions %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>
                            <a href="{{ session.get_absolute_url }}">
                                {{ session.Inning_Name }}
                            </a>
                        </td>
                        <td>
                            {% now "Y-m-d H:i" as todays_datewithtime %}
                            {% if session.Use_Flag and session.Start_Date|date:"Y-m-d H:i" < todays_datewithtime and session.End_Date|date:"Y-m-d H:i" > todays_datewithtime %}
                            <span class="badge badge-success">Active</span>
                            {% else %}
                            <span class="badge badge-danger">Inactive</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3" class="text-center">No Sessions Added</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="col-lg-6 col-md-12" style="max-height:220px; overflow:auto">
            <h4 class="text-center text-primary pb-2"> Teacher Associated Groups List </h4>
            <table class="table table-bordered table-striped memberdatatable">
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>Group Name</th>
                        <th>Course Name</th>
                        <th>Teacher Count</th>
                    </tr>
                </thead>
                <tbody>
                    {% for group in teacher_groups %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td><a href="{{ group.get_absolute_url }}">{{ group.InningGroup_Name }}</a></td>
                        <td>
                            <a href="{{ group.Course_Code.get_absolute_url }}">
                                {{ group.Course_Code.Course_Name }}
                            </a>
                        </td>
                        <td>{{ group.Teacher_Code.all.count }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center">No Groups Added</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

</div>
{% endblock %}
{% block javascript %}
<script>
    $(document).on('click', '.confirm-deactivate', function (event) {
        ans = confirm('Are you sure you want to deactivate this Member?');
        if (ans == true) {
            $('#deactivateForm').submit();
        } else {
            return false;
        }
    });
    $(document).on('click', '.confirm-activate', function (event) {
        ans = confirm('Are you sure you want to activate this Member?');
        if (ans == true) {
            $('#activateForm').submit();
        } else {
            return false;
        }
    });

    $(document).on('click', '.confirm-delete', function () {
        ans = confirm('Are you sure you want to delete this Member?');
        if (ans == true) {
            $('#delete_form').submit();
        } else {
            return false;
        }
    });
</script>
{% endblock %}