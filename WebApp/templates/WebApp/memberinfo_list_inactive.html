{% extends "base.html" %}
{% load static %}

{% block stylesheets %}
    <link href="{% static 'vendorsx/datatables.net-bs/css/dataTables.bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendorsx/datatables.net-buttons-bs/css/buttons.bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'vendorsx/datatables.net-responsive-bs/css/responsive.bootstrap.min.css' %}" rel="stylesheet">
{% endblock %}

{% block breadcrumb %}
    <li class="breadcrumb-item active" aria-current="page">Members</li>
{% endblock %}

{% block content %}
    <div class="memberDiv">
        <hr class="header_hr">
        <h2 class="tableHeader">List of Blocked Members</h2>

        <nav id="navbar_parent" class="navbar-light" style="background-color: grey">
            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12" style="background-color: #808080;">
                    <div class="col-md-8 col-sm-8 col-xs-7">
                        <ul class="nav navbar-nav navbar-center member-list">
                            <li><a class="navbar-brand" id="all_button" href="#">All</a></li>
                            <li><a class="navbar-brand" id="teacher_button" href="#">Teacher</a></li>
                            <li><a class="navbar-brand" id="student_button" href="#">Student</a></li>
                        </ul>
                    </div>
                    <div class="col-md-4 col-sm-4 col-xs-5 blocked-members">
                                <span class="span-member" style="margin:2px"><a
                                        href="{% url 'memberinfo_list' %}" style="color: white">View
                                        Active Members</a></span>
                    </div>

                </div>

            </div>


        </nav>
        <hr class="header_hr">
        <br><br>
        <div class="col-md-6 text-danger">{% include 'WebApp/theme/alerts.html' %}</div>
        <form method="post" action="{% url 'memberinfo_inactive_delete_checked' %}" style="display: inline">
            {% csrf_token %}
            <div class="col-md-12 col-sm-12 col-xs-12">
                <nav id="navbar_parent" class="navbar-dark">

                    <div class="btn-createnew">
                        <button class="btn btn-info editCheckedMembers" type="button" data-toggle="modal"
                                data-target="#edit_checked_details_modal">
                            <i class="fa fa-edit"></i>
                        </button>

                        <button class="btn btn-danger deleteCheckedMembers" type="submit"
                                onclick="return confirm('Are you sure you want to delete ?')">
                            <i class="fa fa-trash"></i>
                        </button>

                    </div>
                </nav>
            </div>

            <div class="membertable col-md-12 col-sm-12 col-xs-12 table-responsive" id="member_dataTable">
                <table class="table table-striped table-bordered bg-white nowrap">
                    <thead class="thead-light bg-primary">
                    <tr class="tableTitleRow">
                        <td>
                            <input type="checkbox" class="memberinfoCheckAll">
                        </td>
                        <td class="text-center">S. No.</td>
                        <td>Username</td>
                        <td>Member ID</td>
                        <td>Full Name</td>
                        <td>Email</td>
                        <td>Department</td>
                        <td>Phone</td>
                        <td>Gender</td>
                        <td>Student</td>
                        <td>Teacher</td>
                        <td>Type</td>
                        <td class="text-center">Action</td>
                    </tr>
                    </thead>
                    {% for object in object_list %}
                        {% if object.id != request.user.id %}
                            <tr>
                                <td><input type="checkbox" class="memberinfoCheckbox" value="{{ object.id }}"
                                           name="memberinfo_id[]"></td>
                                <td class="text-center" style="vertical-align: middle;">{{ forloop.counter }}</td>
                                <td style="vertical-align: middle;"><b><a
                                        href="{{ object.get_absolute_url }}">{{ object.username }}</a></b></td>
                                <td style="vertical-align: middle;">{{ object.Member_ID }}</td>
                                <td style="vertical-align: middle;">{{ object.first_name }}&nbsp;{{ object.last_name }}</td>
                                <td>{{ object.email }}</td>
                                <td>{{ object.Member_Department }}</td>
                                <td>{{ object.Member_Phone }}</td>
                                <td style="vertical-align: middle;">
                                    {{ object.get_Member_Gender_display }}
                                </td>
                                <td style="vertical-align: middle;">{{ object.Is_Student }}</td>
                                <td style="vertical-align: middle;">{{ object.Is_Teacher }}</td>
                                <td>
                                    {% if object.Is_Teacher == True and object.Is_Student == True %}
                                        Teacher, Student
                                    {% elif object.Is_Teacher == True %}
                                        Teacher
                                    {% elif object.Is_Student == True %}
                                        Student
                                    {% else %}
                                        Not Assigned
                                    {% endif %}
                                </td>
                                <td class="text-center">

                                    <button class="btn btn-sm btn-success confirm-activate" id="{{ object.pk }}">
                                        Activate
                                    </button>
                                    <form method="post" action="{% url 'memberinfo_activate'  pk=object.pk %}"
                                          id="activateForm-{{ object.pk }}">
                                        {% csrf_token %}
                                        <input type="hidden" value='memberinfo_list_inactive' name='url'>
                                    </form>
                                    <button class="btn btn-sm btn-danger confirm-delete" id="{{ object.pk }}">Delete
                                    </button>
                                    <form method="post" action="{% url 'memberinfo_delete' pk=object.pk %}"
                                          id="delete_form-{{ object.pk }}">
                                        {% csrf_token %}
                                        <input type="hidden" name="redirect" value="memberinfo_list_inactive">
                                    </form>
                                </td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                </table>
            </div>
        </form>
    </div>

    <br>
    <br>

    {% include 'WebApp/memberinfo_mass_option_form.html' %}
{% endblock %}

{% block customjss %}
    <script src="{% static 'vendorsx/datatables.net/js/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'vendorsx/datatables.net-bs/js/dataTables.bootstrap.min.js' %}"></script>

    <script src="{% static 'vendorsx/datatables.net-buttons/js/dataTables.buttons.min.js' %}"></script>
    <script src="{% static 'vendorsx/datatables.net-buttons-bs/js/buttons.bootstrap.min.js' %}"></script>
    <script src="{% static 'vendorsx/datatables.net-buttons/js/buttons.html5.min.js' %}"></script>
    <script src="{% static 'vendorsx/datatables.net-buttons/js/buttons.print.min.js' %}"></script>

    <script src="{% static 'vendorsx/datatables.net-responsive/js/dataTables.responsive.min.js' %}"></script>
    <script src="{% static 'vendorsx/datatables.net-responsive-bs/js/responsive.bootstrap.js' %}"></script>
    <script type="text/javascript">
        $(document).on('click', '.confirm-activate', function (event) {
            var id = event.target.id;
            ans = confirm('Are you sure you want to activate this Member?');
            if (ans == true) {
                $(`#activateForm-${id}`).submit();
            } else {
                return false;
            }
        });

        $(document).on('click', '.confirm-delete', function () {
            ans = confirm('Are you sure you want to delete this Member?');
            if (ans == true) {
                $(`#delete_form-${this.id}`).submit();
            } else {
                return false;
            }
        });


        $("#all_button").css("color", "white");
        $("#student_button").css("color", "black");
        $("#teacher_button").css("color", "black");

        setTimeout(function () {
            $('#message').fadeOut('slow');
        }, 3000);

        $(document).ready(function () {

            var table_main = $('.table').DataTable({
                dom: 'lBfrtip',
                stateSave: true,
                responsive: true,
                buttons: [
                    {
                        extend: 'csv',
                        text: '<span class="exportcsv"><i class="fa fa-paper-plane-o"></i> Export to CSV </span>'
                    },
                    {
                        extend: 'print',
                        text: '<span class="print"><i class="fa fa-print"></i> Print </span>',
                        fieldSeparator: '\t'
                    }],
                "columnDefs": [
                    {
                        "targets": [8, 9],
                        "visible": false,
                        "searchable": true
                    }

                ]

            });


            $("#student_button").bind("click", function () {
                $("#student_button").css("color", "white");
                $("#teacher_button").css("color", "black");
                $("#all_button").css("color", "black");
                table_main.columns().search('').draw();
                table_main.column(7).search("True").draw();


            });
            $("#teacher_button").bind("click", function () {
                $("#student_button").css("color", "black");
                $("#teacher_button").css("color", "white");
                $("#all_button").css("color", "black");

                table_main.columns().search('').draw();
                table_main.column(8).search("True").draw();

            });

            $("#all_button").bind("click", function () {
                $("#all_button").css("color", "white");
                $("#student_button").css("color", "black");
                $("#teacher_button").css("color", "black");
                table_main.columns().search('').draw();
            });


        });
    </script>

{% endblock %}