{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'start' %}">{% trans "Home" %}</a></li>
<li class="breadcrumb-item">
    <a href="
    {% if object.Course_Code.Use_Flag %}
        {% url 'courseinfo_grid_active' %}
    {% else %}
        {% url 'courseinfo_grid_inactive' %}
    {% endif %}">
        {% trans "Course" %}
    </a>
</li>
<li class="breadcrumb-item"><a href="{{ object.Course_Code.get_absolute_url }}">{{ object.Course_Code }}</a></li>
<li class="breadcrumb-item"><a href="{{ object.Chapter_Code.get_absolute_url }}">{{ object.Chapter_Code }}</a></li>
<li class="breadcrumb-item active" aria-current="page">{{ object.Assignment_Topic }}</li>
{% endblock %}
{% block content %}
{% include 'assignment/assignmentinfo_detail.html' %}
{% include 'inning/inningmapFormModal.html' %}
{% endblock %}

{% block javascript %}

<script>    $(".se-pre-con-ajax").fadeOut("fast");</script>


<script>
        $('#editAssignment-btn').on('click', function () {
            $('#editAssignment_modal_body').empty();
            $.ajax({
                type: "GET",
                url: "{% url 'assignmentinfo_edit_ajax_chapter_id' object.Chapter_Code.id object.pk %}",  // URL to your view that serves new info
                success: function (response) {
                    let url = '/assignmentinfo/edit/{{ object.pk }}/ajax/';
                    $('#editAssignment_modal_body').append(response);
                    $('#ajaxassignmentinfoform').attr('action', url);
                    $('#editAssignment_modal_body').append(`
                        <input type="hidden" name="Register_Agent" id="id_Register_Agent" value="{{ request.user.id }}"
                               class="select form-control">
                        <input type="hidden" name="Course_Code" id="id_Course_Code" value="{{ object.Course_Code.id }}"
                               class="select form-control">
                        <input type="hidden" name="Chapter_Code" id="id_Chapter_Code"
                               value="{{ object.Chapter_Code.id }}" class="select form-control">
                    `)

                    Switchery(document.querySelector('.js-switch'));
                },
                error: function () {
                    console.log('Error in generating assignment edit form')
                },
                complete: function () {
                    $(".se-pre-con-ajax").fadeOut("fast");
                }
            });
        });
</script>


<script>
 document.getElementById('id_Assignment_Start_edit').value = new Date(document.getElementById('id_Assignment_Start_edit').value).toLocaleString("en-US")
 document.getElementById('id_Assignment_Deadline_edit').value = new Date(document.getElementById('id_Assignment_Deadline_edit').value).toLocaleString("en-US")

 $("#ajaxassignmentinfoform").submit(function (e) {
        e.preventDefault(); // avoid to execute the actual submit of the form.
        $.ajax({
            url: "{% url 'assignmentinfo_edit_ajax' object.pk %}",  // URL to your view that serves new info
            data: {
                "csrfmiddlewaretoken": '{{ csrf_token }}',
                "Assignment_Topic": $('#id_Assignment_Topic_edit').val(),
                "Assignment_Start": new Date($('#id_Assignment_Start_edit').val()).toISOString(),
                "Assignment_Deadline": new Date($('#id_Assignment_Deadline_edit').val()).toISOString(),
                "Use_Flag": $('#id_Use_Flag').is(":checked"),
                "Course_Code": $('#id_Course_Code').val(),
                "Chapter_Code": $('#id_Chapter_Code').val(),
                "Register_Agent": $('#id_Register_Agent').val(),
                "Assignment_ID": '{{ object.id }}'
            },
            // get the form data
            type: $(this).attr('method'), // GET or POST
            success: function (response) {
                console.log('Success')
                location.reload()
            },
            error: function (err) {
                console.log('Error in posting assignment create form')
                $('.form-errors').empty().append(err.responseJSON.Message).css('display', 'block')
            }

        });
    });


  $('#id_Assignment_Deadline_edit').on('dp.change', function (event) {
        const result = document.querySelector('.result');
        var date = new Date();
        var deadline = new Date(event.target.value);
        var remaining = dateDifference(deadline, date);
        if (remaining < 0) {
            result.textContent = `Days Remaining : Invalid`;

        } else {
            result.textContent = `Days Remaining : ${remaining}`;

        }
        ;
    });

</script>



<script>
       $(document).on('click', '.confirm-delete', function () {
            ans = confirm('Are you sure you want to delete this Question?');
            if (ans == true) {
                $(`#deleteQuestion${this.id}`).submit();
            } else {
                return false;
            }
        });

        $(document).on('click', '.assignment-confirm-delete', function () {
            ans = confirm('Are you sure you want to delete this Assignment?');
            if (ans == true) {
                $(`#deleteAssignment${this.id}`).submit();
            } else {
                return false;
            }
        });

        $('#add-newquestion-btn').on('click', function () {
            if (submitted) {
                return false
            }
            $('#add_question_modal_body').empty();
            $('#edit_question_modal_body').empty();
            $('#add_question_modal_body').append(
                `<input type="hidden" name="Assignment_Code" id="id_Assignment_Code" value="{{ object.pk }}"
                           class="select form-control">`
            )
            $.ajax({
                type: "GET",
                url: "{% url 'questioninfo_create_ajax' %}",  // URL to your view that serves new info
                success: function (response) {
                    $('#add_question_modal_body').append(response);
                },
                error: function () {
                    submitted = false;
                    console.log('Error in generating add question form')
                },
                complete: function () {
                    $(".se-pre-con-ajax").fadeOut("fast");
                }
            });
        });
        var submitted = false;
        $('.editquestion-btn').on('click', function () {
            if (submitted) {
                return false
            }
            $('#edit_question_modal_body').empty();
            $('#edit_question_modal_body').append(
                `<input type="hidden" name="Assignment_Code" id="id_Assignment_Code" value="{{ object.pk }}"
                           class="select form-control">`
            )
            $('#edit_question_modal_body').attr('data-questionpk', $(this).attr('data-questionpk'))
            $.ajax({
                type: "GET",
                url: `/questioninfo/edit/${$(this).attr('data-questionpk')}/ajax/`,  // URL to your view that serves new info
                success: function (response) {
                    $('#edit_question_modal_body').append(response);
                    $('#edit_question_modal_body').find('form')
                },
                error: function () {
                    submitted = false;
                    console.log('Error in generating add question form')
                },
                complete: function () {
                    $(".se-pre-con-ajax").fadeOut("fast");
                }
            });
        });



        $('button[type=reset]').on('click', function () {
            $(this).closest('form').find('.progress').remove();
        })
</script>


<script>
         $('.inningmap-btn').on('click', function () {
            inningMapDataLoad($(this), $(this).attr('data-sessionid'), $(this).attr('data-objectid'), '{% url 'assignmentinninginfomap' %}')
        })
</script>

{% endblock %}
