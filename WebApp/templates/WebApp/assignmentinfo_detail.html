{% extends "base.html" %}
{% load static %}
{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'start' %}">Home</a></li>
<li class="breadcrumb-item"><a href="
    {% if object.Course_Code.Use_Flag %}
        {% url 'courseinfo_grid_active' %}
    {% else %}
        {% url 'courseinfo_grid_inactive' %}
    {% endif %}
    ">Course</a></li>
<li class="breadcrumb-item"><a href="{{ object.Course_Code.get_absolute_url }}">{{ object.Course_Code }}</a></li>
<li class="breadcrumb-item"><a href="{{ object.Chapter_Code.get_absolute_url }}">{{ object.Chapter_Code }}</a></li>
<li class="breadcrumb-item active" aria-current="page">{{ object.Assignment_Topic }}</li>
{% endblock %}
{% block content %}
<div class="modal fade" id="add_question_modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-primary font-weight-bold" id="add_question_modal_title">Add Question
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i class="ti-close"></i>
                </button>
            </div>
            <div class="modal-body" id="add_question_modal_body">
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editAssignmentModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-primary font-weight-bold" id="editAssignmentModal_title">Edit Assignment
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i class="ti-close"></i>
                </button>
            </div>
            <div class="modal-body" id="editAssignmentModal_body">
                <form method="post" id="ajaxassignmentinfoform">
                    {% csrf_token %}
                    <div class="alert alert-danger form-errors" style="display: none">
                    </div>
                    <div class="form-group">
                        <label for="id_Assignment_Topic_edit" class="control-label">
                            Assignment Topic <span class="asteriskField">*</span>
                        </label>
                        <input type="text" name="Assignment_Topic" maxlength="500" class="form-control" required
                            id="id_Assignment_Topic_edit" value="{{ object.Assignment_Topic }}">
                    </div>
                    <!-- <div class="form-group">
                        <div id="div_id_Assignment_Topic_edit" class="form-group">
                            <label for="id_Assignment_Topic_edit" class="control-label ">
                                Assignment Topic *
                            </label>
                            <div class="controls ">
                                <input type="text" name="Assignment_Topic" maxlength="500" id="id_Assignment_Topic_edit"
                                    class="textinput textInput form-control" required="required"
                                    value="{{ object.Assignment_Topic }}">
                            </div>
                        </div>
                    </div> -->
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label for="id_Assignment_Start_edit" class="control-label">
                                    Assignment Start *
                                </label>
                                <input type="text" name="Assignment_Start_edit" class="form-control"
                                    id="id_Assignment_Start_edit" value="{{ object.Assignment_Start|date:'c' }}" min=""
                                    max="9999-12-31">
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label for="id_Assignment_Deadline_edit" class="control-label">
                                    Assignment Deadline *
                                </label>
                                <input type="text" name="Assignment_Deadline_edit" class="form-control"
                                    id="id_Assignment_Deadline_edit" value="{{ object.Assignment_Deadline|date:'c' }}"
                                    min="{{ datetime|date:'Y-m-d' }}" max="9999-12-31">
                            </div>
                        </div>
                    </div>
                    <div class="form-group text-center">
                        <label for="id_Use_Flag">Publish</label><br>
                        <input type="checkbox" id="id_Use_Flag" class="js-switch" name="Use_Flag"
                            {% if object.Use_Flag == False %} &nbsp; {% elif object.Use_Flag == True %} checked
                            {% endif %}>
                    </div>

                    <div class="result text-center"></div>
                    <div class="form-group">
                        <input type="hidden" name="Register_Agent" id="id_Register_Agent" value="{{ request.user.id }}"
                            class="select form-control">
                        <input type="hidden" name="Course_Code" id="id_Course_Code" value="{{ object.Course_Code.id }}"
                            class="select form-control">
                        <input type="hidden" name="Chapter_Code" id="id_Chapter_Code"
                            value="{{ object.Chapter_Code.id }}" class="select form-control">
                        <input type="hidden" name="today_date" id="id_today_date" value="{{ datetime|date:'Y-m-d' }}"
                            class="select form-control">
                    </div>
                    <div class="submitButton text-center col-md-12">
                        <button class="btn btn-primary" type="submit">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class=" col-md-8 col-sm-12 col-xs-12 ">
        <div class="page-header">
            <div class="page-title">
                <h4 class="d-flex align-items-center">Assignment Information
                </h4>
            </div>
            <h5>{{ object.Assignment_Topic }}</h5>
        </div>

        <div class="my-5">
            <div class="d-flex justify-content-between">
                <h4 class="text-primary mb-4">List of Questions</h4>
                <div>
                    <button type="button" class="btn btn-info" data-toggle="modal" data-target="#add_question_modal"
                        id="add-newquestion-btn">
                        Add Question
                    </button>
                </div>
            </div>
            {% for question in Questions %}
            <div class="accordion mb-4" id="questionList{{ question.pk }}">
                <div class="card shadow-none border">
                    <div class="card-header justify-content-between" id="headingOne">
                        <div class="d-flex align-items-center">
                            <figure class="avatar avatar-sm">
                                <span class="avatar-title rounded-circle"> {{ forloop.counter }}</span>
                            </figure>
                            <h5 class="text-secondary m-0 pl-3 cursor-pointer">
                                {{ question.Question_Title }}
                            </h5>
                        </div>
                        <div class="row d-flex align-items-center">
                            {% if '/students' in request.path %}
                            <button class="btn btn-sm btn-outline-primary answerButton mx-2" type="button"
                                id="{{ question.pk }}">ANSWER <i class="fa fa-arrow-right"></i>
                            </button>
                            {% endif %}
                            {% if '/students' not in request.path %}
                            <div class="modal fade" id="editQuestionModal{{ question.pk }}" tabindex="-1" role="dialog"
                                aria-labelledby="editQuestionLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header text-center">
                                            <h5 class="modal-title text-primary font-weight-bold"
                                                id="editQuestionModal_title">Edit Question
                                            </h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <i class="ti-close"></i>
                                            </button>

                                        </div>
                                        <div class="modal-body modal-auto" id="edit_question_modal_body">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-info btn-floating editquestion-btn mx-2" data-toggle="modal"
                                data-target="#editQuestionModal{{ question.pk }}" id="editquestion-btn{{ question.pk }}"
                                data-questionpk="{{ question.pk }}">
                                <i class="fa fa-pencil"></i>
                            </button>
                            {% if '/teachers' in request.path %}
                            <button id="{{ question.pk }}"
                                class="btn btn-sm btn-danger btn-floating confirm-delete mx-2">
                                <i class="fa fa-trash"></i>
                            </button>
                            <form method="post"
                                action="{% url 'teacher_questioninfo_delete' assignment=object.pk pk=question.pk %}"
                                id="deleteQuestion{{ question.pk }}">
                                {% csrf_token %}
                                <input type="hidden" value="{{ question.pk }}" name="question_id">
                                <input type="hidden" value="{{ object.pk }}" name="assignment_id">
                                <input type="hidden" value="{{ object.Course_Code.id }}" name="course_id">
                                <input type="hidden" value="{{ object.Chapter_Code.id }}" name="chapter_id">
                            </form>
                            {% else %}
                            <button id="{{ question.pk }}"
                                class="btn btn-sm btn-danger btn-floating confirm-delete mx-2">
                                <i class="fa fa-trash"></i>
                            </button>
                            <form method="post"
                                action="{% url 'webapp_questioninfo_delete' assignment=object.pk pk=question.pk %}"
                                id="deleteQuestion{{ question.pk }}">
                                {% csrf_token %}
                                <input type="hidden" value="{{ question.pk }}" name="question_id">
                                <input type="hidden" value="{{ object.pk }}" name="assignment_id">
                                <input type="hidden" value="{{ object.Course_Code.id }}" name="course_id">
                                <input type="hidden" value="{{ object.Chapter_Code.id }}" name="chapter_id">
                            </form>
                            {% endif %}
                            {% endif %}
                        </div>
                        <a data-toggle="collapse" data-target="#question{{ question.pk }}" aria-expanded="true"
                            aria-controls="collapseOne" href="javascript:void(0)">
                            <figure class="avatar avatar-sm">
                                <span class="avatar-title rounded-circle">
                                    <i class="fa fa-chevron-down"></i>
                                </span>
                            </figure>
                        </a>
                    </div>
                    <div id="question{{ question.pk }}" class="collapse show" aria-labelledby="headingOne"
                        data-parent="#questionList{{ question.pk }}">
                        <div class="p-3">
                            {% if  question.Question_Score %}
                            <p>Question Score : {{ question.Question_Score }}</p>
                            {% endif %}
                            {% if  question.Question_Description %}
                            <p>Question Description : {{ question.Question_Description | safe }}</p>
                            {% endif %}
                            {% if question.Answer_Type %}
                            <p>Answer Type : {% if question.Answer_Type == 'S' %}
                                Short Answer
                                {% else %}
                                File Upload
                                {% endif %}
                            </p>
                            {% endif %}
                            {% if  question.Question_Media_File %}
                            <p>Question Media : </p>
                            <p>
                                {% if question.extension == '.jpg' or question.extension == '.png' %}
                                <img class="card-img-top" width="400px" src="{{ question.Question_Media_File.url }}">
                                {% else %}
                                <a href="{{ question.Question_Media_File.url }}" target="_blank"><b
                                        style="color:#017a9b">Click
                                        to view attatched file</b></a>
                                {% endif %}
                            </p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12 col-sm-12 col-xs-12 leftborder" style="margin-bottom: 5px;padding-right: 0;">
                <div class="x_panel" id="answerContent{{ question.pk }}" style="display: none">
                    <div class="x_content">
                        {% for answer in Answers %}
                        {% if question.id == answer.Question_Code.id %}
                        {% if answer.Assignment_Answer != '' %}
                        <p>{{ answer.Assignment_Answer }}</p>
                        {% now "Y-m-d H:i" as todays_date %}
                        {% if object.Assignment_Deadline|date:"Y-m-d H:i" >= todays_date and object.Assignment_Start|date:"Y-m-d H:i" <= todays_date %}
                        <button class="btn btn-info editanswer" data-Student_Code="{{ request.user.id }}"
                            data-Question_Code="{{ question.id }}" data-Answer_Code="{{ answer.pk }}"
                            value="{{ answer.pk }}" style="float: right" title="Edit Answer"><i class="fa fa-edit"
                                aria-hidden="true"></i>
                        </button>
                        <button class="btn btn-danger deleteanswer" value="{{ answer.pk }}" style="float: right"
                            title="Delete Answer"><i class="fa fa-trash" aria-hidden="true"></i>
                        </button>
                        {% endif %}
                        {% else %}
                        <p>File has been Submitted</p>
                        <a href="{{ answer.Assignment_File.url }}" target="_blank"><b style="color:#017a9b">Click
                                to view Submitted file</b></a>
                        <button class="btn btn-danger deleteanswer" value="{{ answer.pk }}" style="float: right"
                            title="Delete Answer"><i class="fa fa-trash" aria-hidden="true"></i>
                        </button>
                        {% endif %}
                        {% endif %}
                        {% endfor %}

                        {% for answer in notAnswered %}
                        {% if  question.id == answer %}
                        {#                                        <form enctype="multipart/form-data" method="post" id="{{ question.id }}"#}
                        {#                                              data-parsley-validate=""#}
                        {#                                              class="form-horizontal form-label-left submitAnswer"#}
                        {#                                              novalidate="" data-id="{{ question.id }}">#}
                        {#                                            {% csrf_token %}#}
                        <form>
                            {% if question.Answer_Type == 'S' %}
                            <div class="form-group">
                                <textarea class="form-control rounded-0" rows="5" cols="100" name="Assignment_Answer"
                                    id="id_Assignment_Answer{{ question.id }}" placeholder="Enter your Answer"
                                    required></textarea>
                                <input type="hidden" value="{{ request.user.id }}" name="Student_Code"
                                    id="id_Student_Code{{ question.id }}">
                                <input type="hidden" value="{{ question.id }}" name="Question_Code"
                                    id="id_Question_Code{{ question.id }}">

                            </div>

                            <div class="form-group text-center">
                                {% now "Y-m-d H:i" as todays_date %}
                                {% if object.Assignment_Deadline|date:"Y-m-d H:i" >= todays_date and object.Assignment_Start|date:"Y-m-d H:i" <= todays_date %}
                                <!-- <button class="btn btn-primary" type="button" id="cancelButton{{ question.pk }}">
                                                Cancel
                                            </button> -->
                                <button class="btn btn-sm btn-primary" type="reset">Reset
                                </button>
                                <button type="button" class="btn btn-sm btn-success submitAnswer"
                                    id="answer{{ question.id }}" data-id="{{ question.id }}"
                                    data-url="{% url 'assignanswerinfo_create_ajax' %}">
                                    Submit
                                </button>
                                {% else %}
                                <p class="text-danger">Submission is prohibited. Please check
                                    assignment start and end date</p>
                                {% endif %}
                            </div>

                            {% elif question.Answer_Type == 'F' %}

                            <div class="form-group">
                                <label for="id_Assignment_File{{ question.id }}" class="">
                                    <span style="font-size: 10px; color: #721c24">
                                        Assignment File (Max: 10 MB) </span>
                                </label>

                                <input type="file" name="Assignment_File" id="id_Assignment_File{{ question.id }}"
                                    required />
                                <input type="hidden" value="{{ request.user.id }}" name="Student_Code"
                                    id="id_Student_Code{{ question.id }}">
                                <input type="hidden" value="{{ question.id }}" name="Question_Code"
                                    id="id_Question_Code{{ question.id }}">
                            </div>
                            <div class="form-group text-center">
                                {% now "Y-m-d H:i" as todays_date %}
                                {% if object.Assignment_Deadline|date:"Y-m-d H:i" >= todays_date and object.Assignment_Start|date:"Y-m-d H:i" <= todays_date %}
                                <button class="btn btn-sm btn-primary" type="reset" id="cancelButton{{ question.pk }}">
                                    Cancel
                                </button>

                                <button type="button" class="btn btn-sm btn-success submitAnswer"
                                    id="answer{{ question.id }}" data-id="{{ question.id }}"
                                    data-url="{% url 'assignanswerinfo_create_ajax' %}">
                                    Submit
                                </button>
                                {% else %}
                                <p class="text-danger">Submission is prohibited. Please check
                                    assignment start and end date</p>
                                {% endif %}
                            </div>
                            {% endif %}
                        </form>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="col-md-4 col-sm-12 col-xs-12">
        <div class="card">
            <div class="px-4 pt-4">
                <p class="text-primary mb-3">Assignment : {{ object.Assignment_Topic }}</p>
                <p>
                    Assignment Start Date : {{ object.Assignment_Start|date:'d M, Y h:i A' }}
                </p>
                <p>
                    Assignment End Date : {{ object.Assignment_Deadline|date:'d M, Y h:i A' }}
                </p>
                <p>
                    Course Code : {{ object.Course_Code }}
                </p>
                <p>
                    Chapter Code : {{ object.Chapter_Code }}
                </p>
                <p>
                    Status :{% if object.Use_Flag is True %}
                    <span class="badge badge-success">Published</span>
                    {% elif object.Use_Flag is False %}
                    <span class="badge badge-danger">Not Published</span>
                    {% endif %}

                    {% now "Y-m-d H:i" as todays_datewithtime %}
                    {% if object.Assignment_Start and todays_datewithtime < object.Assignment_Start|date:"Y-m-d H:i" %}
                    <span class="badge badge-info">Upcoming</span>
                    {% elif object.Assignment_Deadline and todays_datewithtime > object.Assignment_Deadline|date:"Y-m-d H:i" %}
                    <span class="badge badge-danger">Expired</span>
                    {% else %}
                    <span class="badge badge-success">Active</span>
                    {% endif %}
                </p>

                <p>
                    Register Agent : {{ object.Register_Agent }}
                </p>
            </div>
            <ul class="text-center">
                {% if '/students' not in request.path %}
                <li class="p-2 border-top">
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#editAssignmentModal"
                        id="editAssignment-btn">
                        Edit Assignment
                    </button>
                    &nbsp;
                    {% if '/teachers' in request.path %}
                    <a class="btn btn-danger text-white assignment-confirm-delete" id="{{ object.pk }}">Delete</a>
                    <form method="post" action="{% url 'teacher_assignmentinfo_delete' pk=object.pk %}"
                        id="deleteAssignment{{ object.pk }}">
                        {% csrf_token %}
                        <!-- <input type="hidden" value="{{question.pk}}" name="question_id"> -->
                        <input type="hidden" value="{{ object.pk }}" name="assignment_id">
                        <input type="hidden" value="{{ object.Course_Code.id }}" name="course_id">
                        <input type="hidden" value="{{ object.Chapter_Code.id }}" name="chapter_id">
                    </form>
                    {% else %}
                    <a class="btn btn-danger text-white assignment-confirm-delete" id="{{ object.pk }}">Delete</a>
                    <form method="post" action="{% url 'assignmentinfo_delete' pk=object.pk %}"
                        id="deleteAssignment{{ object.pk }}">
                        {% csrf_token %}
                        <!-- <input type="hidden" value="{{questions.pk}}" name="question_id"> -->
                        <input type="hidden" value="{{ object.pk }}" name="assignment_id">
                        <input type="hidden" value="{{ object.Course_Code.id }}" name="course_id">
                        <input type="hidden" value="{{ object.Chapter_Code.id }}" name="chapter_id">
                    </form>
                    {% endif %}
                    <!-- <button class="btn btn-danger chapter-confirm-delete" id="{{ object.pk }}">Delete
                        Chapter</button>
                    <form method="post" action="{% url 'chapterinfo_delete' pk=object.pk %}"
                        id="deleteChapter{{ object.pk }}">
                        {% csrf_token %}
                        <input type="hidden" value="{{ object.pk }}" name="chapter_id">
                        <input type="hidden" value="{{ object.Course_Code.id }}" name="course_id">
                    </form> -->
                </li>
                {% endif %}
                {% if 'teacher' in request.path %}
                <li class="p-2 border-top">
                    <a class="btn btn-success btn-info" href="{% url 'teacher_assignment_answers' object.pk %}">
                        View Assignment Submissions
                    </a>
                </li>
                {% endif %}
                <!-- <li class="p-2 border-top">
                    <button type="button" class="btn btn-info" data-toggle="modal" data-target="#add_question_modal"
                        id="add-newquestion-btn">
                        Add Question
                    </button>
                </li> -->
            </ul>
        </div>
    </div>
</div>

{% endblock %}
{% block javascript %}
<script src="{% static 'vendorsx/jquery/dist/jquery.min.js' %}"></script>
<script src=" {% static 'vendorsx/jQuery-Smart-Wizard/js/jquery.smartWizard.js' %}"></script>
<script src="{% static 'vendorsx/moment/min/moment.min.js' %}"></script>
<script src="{% static 'vendorsx/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js' %}"></script>
<script>    $(".se-pre-con-ajax").fadeOut("fast");</script>

<script>
    document.getElementById('id_Assignment_Start_edit').value = new Date(document.getElementById('id_Assignment_Start_edit').value).toLocaleString("en-US")
    document.getElementById('id_Assignment_Deadline_edit').value = new Date(document.getElementById('id_Assignment_Deadline_edit').value).toLocaleString("en-US")
    $('#id_Assignment_Deadline_edit').datetimepicker();
    $('#id_Assignment_Start_edit').datetimepicker();
    $("#ajaxassignmentinfoform").submit(function (e) {
        e.preventDefault(); // avoid to execute the actual submit of the form.
        $.ajax({
            url: "{% url 'assignmentinfo_edit_ajax' %}",  // URL to your view that serves new info
            data: {
                "csrfmiddlewaretoken": '{{ csrf_token }}',
                "Assignment_Topic": $('#id_Assignment_Topic_edit').val(),
                "Assignment_Start": new Date($('#id_Assignment_Start_edit').val()).toISOString(),
                "Assignment_Deadline": new Date($('#id_Assignment_Deadline_edit').val()).toISOString(),
                "Use_Flag": $('#id_Use_Flag').is(":checked"),
                "Course_Code": $('#id_Course_Code').val(),
                "Chapter_Code": $('#id_Chapter_Code').val(),
                "Register_Agent": $('#id_Register_Agent').val(),
                "Assignment_ID": '{{ object.id }}'
            },
            // get the form data
            type: $(this).attr('method'), // GET or POST
            success: function (response) {
                console.log('Success')
                location.reload()
            },
            error: function (err) {
                console.log('Error in posting assignment create form')
                $('.form-errors').empty().append(err.responseJSON.Message).css('display', 'block')
            }

        });
    });
    $('#id_Assignment_Deadline_edit').on('dp.change', function (event) {
        const result = document.querySelector('.result');
        var date = new Date();
        var deadline = new Date(event.target.value);
        var remaining = dateDifference(deadline, date);
        if (remaining < 0) {
            result.textContent = `Days Remaining : Invalid`;

        } else {
            result.textContent = `Days Remaining : ${remaining}`;

        }
        ;
    });
</script>

<script>
    $('#myModal').on('shown.bs.modal', function () {
        $('#myInput').trigger('focus')
    });

    $(document).on('click', '.confirm-delete', function () {
        ans = confirm('Are you sure you want to delete this Question?');
        if (ans == true) {
            $(`#deleteQuestion${this.id}`).submit();
        } else {
            return false;
        }
    });

    $(document).on('click', '.assignment-confirm-delete', function () {
        ans = confirm('Are you sure you want to delete this Assignment?');
        if (ans == true) {
            $(`#deleteAssignment${this.id}`).submit();
        } else {
            return false;
        }
    });

    $('#add-newquestion-btn').on('click', function () {
        if (submitted) {
            return false
        }
        $('#add_question_modal_body').empty();
        $('#add_question_modal_body').append(
            `<input type="hidden" name="Assignment_Code" id="id_Assignment_Code" value="{{ object.pk }}"
                           class="select form-control">`
        )
        $.ajax({
            type: "GET",
            url: "{% url 'questioninfo_create_ajax' %}",  // URL to your view that serves new info
            success: function (response) {
                $('#add_question_modal_body').append(response);
            },
            error: function () {
                submitted = false;
                console.log('Error in generating add question form')
            },
            complete: function () {
                $(".se-pre-con-ajax").fadeOut("fast");
            }
        });
    });

    $('.editquestion-btn').on('click', function () {
        if (submitted) {
            return false
        }
        $('#edit_question_modal_body').empty();
        $('#edit_question_modal_body').append(
            `<input type="hidden" name="Assignment_Code" id="id_Assignment_Code" value="{{ object.pk }}"
                           class="select form-control">`
        )
        $('#edit_question_modal_body').attr('data-questionpk', $(this).attr('data-questionpk'))
        $.ajax({
            type: "GET",
            url: `/questioninfo/edit/${$(this).attr('data-questionpk')}/ajax/`,  // URL to your view that serves new info
            success: function (response) {
                $('#edit_question_modal_body').append(response);
                $('#edit_question_modal_body').find('form')
            },
            error: function () {
                submitted = false;
                console.log('Error in generating edit question form')
            },
            complete: function () {
                $(".se-pre-con-ajax").fadeOut("fast");
            }
        });
    });


    var submitted = false;
    $(".qacontainer").on('click', '.submitAnswer', function (e) {
        e.preventDefault(); // avoid to execute the actual submit of the form.
        if (submitted) {
            return false
        }
        submitted = true;
        var answerdata = new FormData();
        if ($(`#id_Assignment_File${$(this).attr('data-id')}`).val()) {
            var answer_file = $(`#id_Assignment_File${$(this).attr('data-id')}`)[0].files[0];
        } else {
            var answer_file = 0;
        }

        if ($(`#id_Assignment_Answer${$(this).attr('data-id')}`).val()) {
            var answer_text = $(`#id_Assignment_Answer${$(this).attr('data-id')}`).val();
        } else {
            var answer_text = '';
        }

        if (answer_file == 0 && answer_text == '') {
            console.log('empty');
        } else {
            answerdata.append("Assignment_File", answer_file);
            answerdata.append("csrfmiddlewaretoken", '{{csrf_token}}');
            answerdata.append("Assignment_Answer", answer_text);
            answerdata.append("Question_Code", $(`#id_Question_Code${$(this).attr('data-id')}`).val());
            answerdata.append("Student_Code", $(`#id_Student_Code${$(this).attr('data-id')}`).val());

            $.ajax({
                url: $(this).attr('data-url'),  // URL to your view that serves new info
                data: answerdata,
                // get the form data
                type: 'post', // GET or POST
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                success: function (response) {
                    console.log('Success')
                    location.reload()
                },
                error: function (e) {
                    submitted = false;
                    alert(e.responseJSON.msg)
                    console.log('Error in submitting file. ' + e.responseJSON.msg)
                }
            });
        }
    });
</script>

<script>
    $(".answerButton").click(function () {
        $(`#answerContent${this.id}`).toggle();
    });

</script>

<script>
    $(document).ready(function () {
        $('.deleteanswer').on('click', function () {
            var answerpk = this.value
            var result = confirm("Are you sure you want to delete this answer?");
            if (!result) {
                return false
            }
            $.ajax({
                method: 'POST',
                url: "{% url 'assignanswerinfo_delete' %}",  // URL to your view that serves new info
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    'answerpk': answerpk,
                },
                success: function (response) {
                    location.reload()
                },
                error: function (err) {
                    console.log(err.responseText)
                    location.reload()
                },
            });
        });
        $('.editanswer').click(function () {
            $(this).parent().children().css('display', 'none')
            $(this).parent().append(`
                <div class="editdiv">
                <form>
                    <textarea class="form-control rounded-0" rows="5" cols="100"
                              name="Assignment_Answer"
                              placeholder="Enter your Answer"
                              id="id_Assignment_Answer${$(this).attr('data-Question_Code')}" required>${$(this).parent().find('p').text()}</textarea>
                    <input type="hidden" value="${$(this).attr('data-Student_Code')}" name="Student_Code"
                    id=id_Student_Code${$(this).attr('data-Question_Code')}>
                    <input type="hidden" value="${$(this).attr('data-Question_Code')}" name="Question_Code"
                    id=id_Question_Code${$(this).attr('data-Question_Code')}>
                    <div class="form-group text-center">

                             <button class="btn btn-sm btn-primary cancelBtn" type="button" id="cancelButton{{ questions.pk }}">
                                Cancel
                            </button>
                            <button class="btn btn-sm btn-primary resetBtn" type="reset">Reset</button>

                            <button type="button" class="btn btn-sm btn-success submitAnswer"
                                    id="answer${$(this).attr('data-Question_Code')}"
                                    data-id="${$(this).attr('data-Question_Code')}"
                                    data-url="{% url 'assignanswerinfo_create_ajax' %}?editanswer=${this.value}">Submit
                            </button>
                    </div>
                    </form>
                </div>
                `)
        })

        $('.qacontainer').on('click', '.cancelBtn', function () {
            $(this).closest('.editdiv').parent().children().css('display', 'block')
            $(this).closest('.editdiv').remove()
        })
        //$('.qacontainer').on('click', '.resetBtn', function () {
        //  $(this).closest('.editdiv').find('textarea').val('')
        //})
    })
        // $('input[type=datetime-local]').each(function () {
        //    $(this).val(`${newdate.getFullYear()}-${('0' + newdate.getMonth()).substr(-2)}-${('0' + newdate.getDate()).substr(-2)}T${('0' + newdate.getHours()).substr(-2)}:${('0' + newdate.getMinutes()).substr(-2)}`)
        // })
</script>
{% endblock %}