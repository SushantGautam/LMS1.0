{% load static %}
<div class="modal fade" id="exampleModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true" id="create_chapter_modal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h4 class="modal-title" id="exampleModalLabel"><b>Create Chapter</b>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </h4>
            </div>
            <div class="modal-body modal-auto" id="create_chapter_modal_body">
            </div>
        </div>
    </div>
</div>

<div class="outerdiv">
    {% include 'WebApp/theme/alerts.html' %}

    <div class="col-md-12 col-sm-12 col-xs-12 text-center">
        <h2 class="detailListHeader">Course Information</h2>
    </div>

    <div class="col-md-12 col-sm-12 col-xs-12">
        <hr class="header_hr" style="margin-bottom: 5px;margin-top: 5px;">
        <div class="col-md-6 col-sm-12 col-xs-12 no-padding">
            <h3 align="center"><b>{{ object.Course_Name }}</b></h3>
            <br>

            <img class="card-img-top" src="
                            {% if object.Course_Cover_File %}
                                /media/{{ object.Course_Cover_File }}
                            {% else %}
                                {% static 'images/course.jpg' %}
                            {% endif %}" alt="Card image cap" style="
                            display: block;
                            margin-left: auto;
                            margin-right: auto;
                            width: 50%;
                            max-height: 400px">

            <div class="courseDetailStyle1 row" style="margin-top: 10px">


                <div class="col-lg-6" style="font-size: 15px;">

                    <h5 align="center">
                        {% if topic %}
                            <a target="_blank" href="
                        {% if '/teachers' in request.path %}
                        {% url 'Teacher_Course_Forum' object.pk %}
                        {% elif '/students' in request.path %}
                        {% url 'Student_Course_Forum' object.pk %}
                        {% else %}
                        {% url 'Course_Forum' object.pk %}
                        {% endif %}">
                                <i class="fa fa-comment-o"></i> <b> FORUM </b></a>
                        {% else %}
                            {% if '/students' not in request.path %}
                                <a target="_blank" href="
                        {% if '/teachers' in request.path %}
                        {% url 'Teacher_Course_Forum' object.pk %}
                        {% else %}
                        {% url 'Course_Forum' object.pk %}
                        {% endif %}">
                                    <i class="fa fa-comment-o"></i> <b> Add Forum </b></a>
                            {% endif %}
                        {% endif %}

                    </h5>
                </div>
                {% if '/students' not in request.path %}
                    <div class="col-md-6 col-sm-12 col-xs-12" style="margin-top: 10px;">
                        <a href="{% if '/teachers' in request.path %}
                    /teachers{{ object.get_update_url }}
                        {% else %}
                            {{ object.get_update_url }}
                        {% endif %}"><b><u>Edit Course</u></b></a>
                        <span style="float: right;">
                        <a id="{{ object.pk }}" class="course-confirm-delete"
                           style="color: rgb(255, 0, 0);cursor:pointer">Delete</a>
                    </span>
                        <form method="post" action="{% url 'courseinfo_delete' pk=object.pk %}"
                              id="deleteCourse{{ object.pk }}">
                            {% csrf_token %}
                            <!-- <input type="hidden" value="{{questions.pk}}" name="question_id"> -->
                            <input type="hidden" value="{{ object.pk }}" name="course_id">
                        </form>
                    </div>
                {% endif %}
            </div>
            <table class="table">

                <tr>
                    <td style="vertical-align: middle;">Difficulty</td>
                    <td>

                        <span id="rating"></span>


                    </td>
                </tr>
                <tr>
                    <td>Course Provider</td>
                    <td>{{ object.Course_Provider }}</td>
                </tr>
                <tr>
                    <td>Registered By</td>
                    <td>{{ object.Register_Agent }}</td>
                </tr>
                <tr>
                    <td>Status</td>
                    <td>
                        {% if object.Use_Flag == True %}
                            Active
                        {% elif object.Use_Flag == False %}
                            Deactivated
                        {% endif %}
                    </td>
                </tr>
            </table>
            <div class="col-md-12 col-sm-12 col-xs-12 no-padding">
                <h4 align="center"><b>Course Description</b></h4>
                <p style="margin-left: 10px; overflow-wrap:break-word; "> {{ object.Course_Description }} </p>
                <hr>
            </div>

            <table class="table">
                {% if quizcount %}
                    <tr>
                        <td style="border-top:0 ">
                            <div class="col-md-8 col-sm-8 col-xs-8 no-padding" style="
    width: -webkit-fill-available;
">

                                Number of Exams
                                <div class="panel-group" id="accordionm" role="tablist" aria-multiselectable="true">

                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingTwobb">
                                            <h4 class="panel-title">
                                                <a class="collapsed" role="button" data-toggle="collapse"
                                                   data-parent="#accordionm" href="#collapseTwoc" aria-expanded="false"
                                                   aria-controls="collapseTwoc">
                                                    View All Exams <i class="fa fa-angle-double-down"></i>
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="collapseTwoc" class="panel-collapse collapse" role="tabpanel"
                                             aria-labelledby="headingTwobb">
                                            <div class="panel-body">
                                                {% for eachquiz in quizcount %}
                                                    <br> {{ eachquiz.title }}
                                                    {% if "students" in request.path %}-
                                                        {% if not eachquiz.draft %}
                                                            <a href="/quiz/quiz{{ eachquiz.pk }}/take/">Take Exam</a>
                                                        {% endif %}
                                                    {% elif  "teachers" in request.path %}
                                                        <br>   <a style="color: #0c83e4; font-size: large"
                                                                  href="/teachers/quiz/detail/{{ eachquiz.pk }}/">Detail</a>
                                                        <br>
                                                        <p style="color: #00A000">
                                                            {{ eachquiz.draft|yesno:"Inactive, Active" }}
                                                        <p>
                                                        <hr>
                                                    {% else %}
                                                        <br>   <a style="color: #0c83e4; font-size: large"
                                                                  href="/quiz/detail/{{ eachquiz.pk }}/">Detail</a><br>
                                                        <p style="color: #00A000">
                                                            {{ eachquiz.draft|yesno:"Inactive, Active" }}
                                                        <p>
                                                        <hr>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>


                        </td>
                        <td style="border-top:0; ">
                            {{ quizcount.count }}

                        </td>

                        <td style="border-top:0; ">
                            {% if 'students' in request.path %}
                            {% else %}
                                <button type="button" class="btn qts-button" id="exam_paper_popup"
                                        data-toggle="modal"
                                        data-target="#quiz_create_popup"><i class="fa fa-plus"></i> Exam
                                </button>
                            {% endif %}
                        </td>
                    </tr>
                {% else %}
                    No Active Exams
                    <hr>
                {% endif %}
                <tr>
                    <td>
                        <div class="col-md-8 col-sm-8 col-xs-8 no-padding">
                            Number of Survey
                        </div>
                    </td>
                    <td>
                        {{ surveycount.count }}
                    </td>
                </tr>
                {% if numberOfQuizExclExams.count %}
                    <tr>
                        <td>
                            {% if numberOfQuizExclExams %}

                                <div style="width: -webkit-fill-available;">
                                    Number of Quizs
                                    <div class="panel-group" id="accordionmo" role="tablist"
                                         aria-multiselectable="true">

                                        <div class="panel panel-default">
                                            <div class="panel-heading" role="tab" id="headingTwobbx">
                                                <h4 class="panel-title">
                                                    <a class="collapsed" role="button" data-toggle="collapse"
                                                       data-parent="#accordionmo" href="#collapseTwocn"
                                                       aria-expanded="false"
                                                       aria-controls="collapseTwocn">
                                                        View All Quizs <i class="fa fa-angle-double-down"></i>
                                                    </a>
                                                </h4>
                                            </div>
                                            <div id="collapseTwocn" class="panel-collapse collapse" role="tabpanel"
                                                 aria-labelledby="headingTwobbx">
                                                <div class="panel-body">
                                                    {% for eachquiz in numberOfQuizExclExams %}
                                                        <br> {{ eachquiz.title }}
                                                        {% if "students" in request.path %}-
                                                            <a href="/quiz/quiz{{ eachquiz.pk }}/take/">Take Quiz</a>
                                                        {% elif  "teachers" in request.path %}
                                                            <br>   <a style="color: #0c83e4; font-size: large"
                                                                      href="/teachers/quiz/detail/{{ eachquiz.pk }}/">Detail</a>
                                                            <br>
                                                            <p style="color: #00A000">
                                                                {{ eachquiz.draft|yesno:"Inactive, Active" }}
                                                            <p>
                                                            <hr>
                                                        {% else %}
                                                            <br>   <a style="color: #0c83e4; font-size: large"
                                                                      href="/quiz/detail/{{ eachquiz.pk }}/">Detail</a>
                                                            <br>
                                                            <p style="color: #00A000">
                                                                {{ eachquiz.draft|yesno:"Inactive, Active" }}
                                                            <p>
                                                            <hr>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            {% endif %}

                        </td>
                        <td>
                            {{ numberOfQuizExclExams.count }}
                        </td>
                    </tr>
                {% else %}
                    No Active Quizs
                    <hr>
                {% endif %}
            </table>
            <!-- <p>

                <a class="btn btn-primary" data-toggle="collapse" href="#quizcollapse" role="button"
                    aria-expanded="false" aria-controls="quizcollapse">
                    {{ object.quiz_set.count }} Quizes
                </a>

            </p> -->
            <!-- <br> -->
            <!-- <p>
                <a class="btn btn-primary" data-toggle="collapse" href="#surveycollapse" role="button"
                    aria-expanded="false" aria-controls="surveycollapse">
                    {{ surveycount.count }} Surveys
                </a>

            </p> -->
            <!-- <div class="collapse" id="surveycollapse">
                <div class="card card-body">
                    {% for each in surveycount %}
                    <a href="/survey/surveyinfo/detail/{{ each.pk }}"> {{ each.Survey_Title }}</a>
                    {% endfor %}
                </div>
            </div> -->


        </div>
        <div class="col-md-6 col-sm-12 xol-xs-12">
            <div class="col-md-12 col-sm-12 xol-xs-12">
                <div class="col-md-8 col-sm-12 col-xs-12 text-center">
                    <h2 class="subHeader">Chapters</h2>


                </div>

                {% if '/students' not in request.path %}
                    <div class="col-md-4 col-sm-12 col-xs-12 text-center" style="margin-top: 10px">
                        <button type="button" class="btn-sm btn-success" data-toggle="modal"
                                data-target="#exampleModal1"
                                id="add-newchapter-btn">
                            Create New Chapter
                        </button>
                    </div>
                {% endif %}
                <div class="col-md-12 col-sm-12 xol-xs-12">
                    <script> var lastchapter = 0;</script>
                    {% for o in chapters %}
                        <div class="col-md-12 col-sm-12 col-xs-12 leftborder" style=" margin: 5px;">
                            <div class="col-md-8 col-sm-8 col-xs-12">
                                <h5 style="padding-top: 2px; color: #000000"> Chapter No: {{ o.Chapter_No }}</h5>
                                <h4>
                                    <b style="color: #000000">{{ o.Chapter_Name }}</b>
                                </h4>
                            </div>
                            <div class="col-md-4 col-sm-4 col-xs-12">
                                <a href="{% if '/students' in request.path %}
                                {{ o.student_get_absolute_url }}
                            {% elif '/teachers' in request.path %}
                                {{ o.teacher_get_absolute_url }}
                            {% else %}
                               {{ o.get_absolute_url }}
                            {% endif %}">
                                    <button type="button" style="float: right;width:150px;height:25px;border: 1px solid #017a9b;color:#017a9b;background-color: white;border-radius: 4px;
                                margin-top: 20px;margin-bottom: 10px;">View Chapter &nbsp;<i
                                            class="fa fa-arrow-right"></i>
                                    </button>
                                </a>
                            </div>

                            <div class="col-md-12 col-sm-12 col-xs-12">
                                <hr style="margin-top: 5px; margin-bottom: 5px;">
                                <p>{{ o.Summary|truncatewords:40 }}</p>
                            </div>
                        </div>
                        <script> var lastchapter = {{ o.Chapter_No }};</script>

                    {% endfor %}
                </div>
                {#                <div>#}
                {#                    <ul>#}
                {#                        {% for q in exam_quiz %}#}
                {#                            <li>{{ q.title }}</li>#}
                {#                        {% endfor %}#}
                {#                    </ul>#}
                {#                </div>#}
            </div>
        </div>
    </div>
</div>

<div id="quiz_create_popup" class="modal fade">
    <div class="modal-dialog" style="width: fit-content">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Create Quiz</h4>
            </div>
            <div class="modal-body modal-auto" id="quiz_form_ajax">
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

<div id="question_form_popup" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" id="qn_close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" id="question_model_title">Add Question</h4>
            </div>
            <div class="modal-body modal-auto" id="question_form_ajax">
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

{% block customjss %}
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script>

        if (parseInt('{{object.Course_Level}}'))
            for (j = 0; j < parseInt('{{object.Course_Level}}'); j++) {
                $('#rating').append("&nbsp;<i class='fa fa-star' style='color:#f5ba00'></i>");
            }
        else
            $('#rating').append("Rating not defined");

    </script>
    <script src=" {% static 'vendorsx/jQuery-Smart-Wizard/js/jquery.smartWizard.js' %}"></script>
    <script>
        $('#myModal').on('shown.bs.modal', function () {
            $('#myInput').trigger('focus')
        });

        $(document).on('click', '.course-confirm-delete', function () {
            ans = confirm('Are you sure you want to delete this Course?');
            if (ans == true) {
                $(`#deleteCourse${this.id}`).submit();
            } else {
                return false;
            }
        });


        $('#add-newchapter-btn').on('click', function () {
            $('#create_chapter_modal_body').empty();
            $("#create_chapter_modal_body").append('<div class="se-pre-con-ajax"></div>');
            $('#create_chapter_modal_body').append(`<input type="hidden" name="Course_Code" id="id_Course_Code" value="{{ object.pk }}" class="select form-control">`);

            $.ajax({
                type: "GET",
                url: "{% url 'chapterinfo_create_ajax' %}",  // URL to your view that serves new info
                success: function (response) {
                    $('#create_chapter_modal_body').append(response);
                    Switchery(document.querySelector('.js-switch'));
                },
                error: function () {
                    console.log('Error in generating chapter create form')
                },
                complete: function () {
                    $(".se-pre-con-ajax").fadeOut("fast");
                    $("#id_Chapter_No").val(lastchapter + 1);
                }
            });


        });
    </script>
    <script>
        $('#exam_paper_popup').on('click', function () {
            $.ajax({
                type: "GET",
                data: {'course_id': '{{ object.id }}', 'test_type': 'exam_paper',},
                url: "{% url 'quiz_create_ajax'%}",  // URL to your view that serves new info
                success: function (data) {
                    $("#quiz_form_ajax").html(data);
                }
            });
        });
        $('#qn_close').on("click", function () {
            $("#quiz_create_popup").modal("show");
        });

        function quiz_create_content(response) {
            console.log(response['url']);
            console.log(response['teacher_url']);
            console.log(response['student_url']);
            location.reload();
        }
    </script>
{% endblock %}