{% extends "teacher_module/base.html" %}
{% load static %}
{% block title %}
| Course
{% endblock %}
{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'teacher_home' %}">Home</a></li>
<li class="breadcrumb-item active" aria-current="page">My Courses</li>
{% endblock %}
{% block content %}
<div class="page-header">
    <div class="page-title">
        <h2>{% if '/active' in request.path %}
            List of My Courses
            {% else %}
            List of Inactive Courses
            {% endif %}
        </h2>
        <div>
            {% if '/active' in request.path %}
            <a href="{% url 'teacher_mycourses_list_inactive' %}">
                <span class="text-right " style="float:right;color:#5A738E">
                    <b>View <span> Inactive </span>courses</b>
                </span>
            </a>
            {% else %}
            <a href="{% url 'teacher_mycourses_list_active' %}">
                <span class="text-right " style="float:right;color:#5A738E">
                    View <span> <b>Active</b> </span>courses
                </span>
            </a>
            {% endif %}
        </div>
    </div>
</div>
<div class="row">
    <div class="col-lg-8 col-md-8 col-sm-12">
        <form method="get" action="" class="query_form">
            <div class="row">
                <div class="col-md-4 col-sm-6">
                    <input type="text" name="teacher_mycoursequery" placeholder="Search Course"
                        value="{{ request.GET.query }}" class="form-control">
                </div>
                <button class="btn btn-default" type="submit"><i class="fa fa-search"></i>&nbsp;Search</button>
            </div>
        </form>
    </div>
    <div class="col-lg-4 col-md-4 col-sm-12">
        <div class="pull-right">
            <span> <b>Show</b> </span>
            <label>
                <select name="QuizTable_length" aria-controls="QuizTable" class="form-control input-sm"
                    id="paginate_courses">
                    <option value="6">6</option>
                    <option value="12">12</option>
                    <option value="30">30</option>
                    <option value="60">60</option>
                </select>
            </label>
            <span> <b>Entries</b> </span>
        </div>
    </div>
</div>
<div class="row mt-4">
    {% for courses in response %}
    <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 col-xs-12">
        <div class="card card-container">
            <img src="{% if courses.Course_Cover_File %}
                        {{ courses.Course_Cover_File.url }}
                    {% else %}
                        {% static 'media/image/course.jpg' %}
                    {% endif %}" class="card-img-top card-image" alt="image" width="100%" height="270px" style="object-fit: cover">
            <div class="card-overlay text-white">
                <div class="p-3">
                    <h5 class="course-title"><a href="{{ courses.teacher_get_absolute_url }}" class="text-white">{{ courses.Course_Name }}</a>
                    </h5>
                    {% if courses.get_teachers_of_this_course %}
                    <p class="card-text">
                        Teacher(s):
                        {% for eachTeacher in courses.get_teachers_of_this_course|slice:":4" %}
                        {{ eachTeacher.getFullName|truncatechars:15 }}&nbsp;
                        {% endfor %}
                        {% if courses.get_teachers_of_this_course|length > 4 %}
                        ....
                    {% endif %}

                    </p>
                    {% else %}
                    <p>
                    No Teacher Assigned
                    </p>
                    {% endif %}
                    Difficulty :
                    {% for i in '12345'|make_list %}
                    {% if courses.Course_Level >= forloop.counter %}
                    <span class="fa fa-fw fa-star text-warning"></span>
                    {% else %}
                    <span class="fa fa-fw fa-star-o text-warning"></span>
                    {% endif %}
                    {% endfor %}
                    </p>
                    <hr>
                    <p class="card-text height-50">
                        {% if courses.Course_Description %}
                        {{ courses.Course_Description|truncatechars:45 }}
                        {% else %}
                        No Description
                        {% endif %}
                    </p>
                    <div class="text-center">
                        <a href="{{ courses.teacher_get_absolute_url }}" class="btn btn-outline-light text-white">Go to Course</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12 my-3 text-center">
        No Course Found
    </div>
    {% endfor %}
</div>
<div class="col-12 text-center">
    {% if response.has_other_pages %}
    <div class=" text-center">
        <ul class="pagination">
            {% if response.has_previous %}
            <li>
                <a
                    href="?page=
                        {{ response.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">&laquo;</a>
            </li>
            {% else %}
            <li class="disabled"><span>&laquo;</span></li>
            {% endif %}
            {% for i in response.paginator.page_range %}
            {% if response.number == i %}
            <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
            {% else %}
            <li>
                <a
                    href="?page={{ i }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">{{ i }}</a>
            </li>
            {% endif %}
            {% endfor %}
            {% if response.has_next %}
            <li>
                <a
                    href="?page=
                        {{ response.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">&raquo;</a>
            </li>
            {% else %}
            <li class="disabled"><span>&raquo;</span></li>
            {% endif %}
        </ul>
    </div>
    {% endif %}
</div>
<div class="col-12">
    <div class="table-responsive" style="display:none;padding: 0;" id="tableView">
        <span class="checkboxCheckedLength"></span>
        <table class="table table-striped table-bordered bg-white nowrap" id="course_dataTable">
            <thead class="thead-light bg-primary">
                <tr class="tableTitleRow">
                    <td>ID</td>
                    <td>Course Name</td>
                    <td>Teachers</td>
                    <td>Course Provider</td>
                    <td>Course Level</td>
                    <td>Action</td>
                </tr>
            </thead>
            {% for object in object_list %}
            <tr>
                <td style="vertical-align: middle;">{{ forloop.counter }}</td>
                <td style="vertical-align: middle;"> <strong><a href="{% if '/students' in request.path %}
                        {{ object.student_get_absolute_url }}
                    {% else %}
                        {{ object.get_absolute_url }}
                    {% endif %}">{{ object.Course_Name|truncatechars:70 }} </a></strong></td>
                <td style="vertical-align: middle;"> {% if object.get_teachers_of_this_course %}
                    <p style="height: 30px; overflow:auto">

                        {% for eachTeacher in object.get_teachers_of_this_course %}&nbsp;
                        {{ eachTeacher.getFullName }}
                        {% endfor%}
                    </p>
                    {% else %}
                    <p style="height: 30px; overflow:auto"> No Teacher </p>
                    {% endif %}</td>
                <td style="vertical-align: middle;">
                    {{ object.Course_Provider }}
                </td>
                <td style="vertical-align: middle;">
                    {{object.Course_Level}}
                </td>

                <td class="text-center"><a class="btn btn-sm btn-info"
                        href="/teachers{{ object.get_update_url }}">Edit</a>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>
{% endblock %}

{% block javascript %}
<script>
    $(".query_form").submit(function (e) {
        val = $(this).find('input').val()
        if (!val.replace(/^\s+|\s+$/g, "").length != 0) {
            console.log('empty')
            alert('Please enter a search term')
            e.preventDefault()
        }
    });
</script>
<script>
    document.querySelector("#cardButton").addEventListener('click', cardView);
    document.querySelector("#tableButton").addEventListener('click', tableView);
    function cardView() {
        $("#cardButton").css('color', 'black');
        $("#tableButton").css('color', 'grey');
        document.querySelector('#cardView').style.display = "inline-block";
        document.querySelector('#tableView').style.display = "none";
    }
    function tableView() {
        $("#cardButton").css('color', 'grey');
        $("#tableButton").css('color', 'black');
        document.querySelector('#tableView').style.display = "block";
        document.querySelector('#cardView').style.display = "none";

    }
</script>
<script>
    $(document).ready(function () {
        if ('{{ request.GET.paginate_by }}') {
            $('#paginate_courses').val('{{ request.GET.paginate_by }}')
        }
        $('#paginate_courses').on('change', function () {
            window.location.href = "{{ request.path }}?paginate_by=" + this.value;
        })
    })


    $('.card-overlay').each(function(){
        var theight = $(this).find('.course-title').height() + 25;
        $(this).css({height:theight});
        $(this).parent().hover(function () {
            $(this).find(".card-overlay").css({height:"100%"})
            $(this).find('.course-title').css({
                maxHeight: "40px",
                // whiteSpace: "wrap",
                overflow: "hidden",
                textOverflow: "ellipsis"})
        }, function () {
            $(this).find(".card-overlay").css({height:theight})
            $(this).find('.course-title').css({
                maxHeight: "100%",
                // whiteSpace: "wrap",
                overflow: "visible",
                textOverflow: "none"})
        });
    })
</script>
{% endblock %}