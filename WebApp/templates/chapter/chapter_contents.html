{% load staticfiles %}

<html>
<head>
    <!-- Bootstrap -->
    <link href="{% static 'vendorsx/bootstrap/dist/css/bootstrap.min.css' %}" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="{% static 'vendorsx/font-awesome/css/font-awesome.min.css' %}" rel="stylesheet">

    <link href="{% static 'chapterPageBuilder/css/style.css' %}" rel="stylesheet">

    <style>
        .button-position{
            height: 20px;
            width: 20px;
            margin: 5px;
            padding: 5px!important;
            background-color: white;
            z-index: 999;
            top:50vh;
            position: absolute;
            display: none;
            transition: all 1s ease;
        }
        .button-position:hover{
            cursor: pointer;
        }
        
        .overall-contents:hover .button-position{display: block;}

        .overall-contents:hover .content-title{display: block;}

        #container{
            background-color: white;
            color: black;
        }

        body{
            background-color: black;
        }

        .content-title{
            color: white;
            font-size: 18px;
            font-weight: 600;
            text-transform: uppercase;
            /* display: none; */
            transition: all 0.3s ease;
        }
        .content-footer1{
            color: white;
            font-size: 12px;
            font-weight: 200;
            padding-right: 20px;
            /* display: none; */
            transition: all 0.3s ease;
        }

    </style>
</head>

<body>
    <div class="container-fluid">
        <!-- For Title -->
        <div class="row">
            <div class="content-title1 container text-center">
                <span id="chaptertitle" class="content-title">
                    <!-- Chapter title goes here -->
                    {{chapter}}
                </span>
            </div>
        </div>

        <div class="row overall-contents">
            <div class="col-md-12">
                <div class="col-md-1 col-xs-1 col-sm-1 col-xl-1">
                    <div id = "prev-btn" class="button-position" style="left:0;">
                        <i class="fa fa-backward"></i>
                    </div>
                </div>
                <div class="col-md-10 col-xs-10 col-sm-10 col-xl-10">
                    <div id="container" style="position: relative;">

                    </div>
                </div>
                <div class="col-md-1 col-xs-1 col-sm-1 col-xl-1">
                    <div id = "next-btn" class="button-position" style="right:0;">
                        <i class="fa fa-forward"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- For Footer -->
        <div class="row"> 
            <div class="content-footer1 text-right">
                Page <span id="currentpage"></span> of <span id="totalpages"></span> 
            </div>           
        </div>
    </div>
</body>
</html>

<!-- jQuery -->
<script src="{% static 'vendorsx/jquery/dist/jquery.min.js' %}"></script>
<script type="text/javascript">
    document.addEventListener('visibilitychange', function(){
        pauseAllVideos(); // change tab text for demo
    });

    $(document).keydown(function (e) {
        if (e.keyCode == '39') {
            $('#next-btn').click();
            return false
        }
        if (e.keyCode == '37') {
            $('#prev-btn').click();
            return false
        }
        //UP
        if (e.keyCode == '38') {
            $('body').animate({ scrollTop: 0 }, 100);
            return false;
        }
        //DOWN
        if (e.keyCode == '40') {
            $('body').animate({ scrollTop: $(document).height() }, 100);
            return false;
        }

        if (e.keyCode == '70') {
            toggleFullScreen();
            return false;
        }
    });

    $('#next-btn').off().click(function () {
        pauseAllVideos();
        $("#container > .coursepages ").each(function () {
            if ($(this).css("display") == "block") {
                res = this.id.match(/[0-9]+/);
            }
        });
        if (res < $("#container > div ").length) {
            $('#page' + res).css("display", "none");
            res++;
            $('#page' + res).css("display", "block")
        }
        $('#currentpage').text(res);
    });

    $('#prev-btn').off().click(function () {
        pauseAllVideos();
        $("#container > div ").each(function () {
            if ($(this).css("display") == "block") {
                res = this.id.match(/[0-9]+/);
            }
        });
        if ((res - 1) > 0) {
            $('#page' + res).css("display", "none");
            res--;
            $('#page' + res).css("display", "block")
        }
        $('#currentpage').text(res);
    });

    var data = {{ data | safe}};
    // console.log(data)

    container_height = $('body').height()-$('.content-title1').height()-$('.content-footer1').height()
    // console.log($('body').height(), $('.content-title1').height(), $('.content-footer1').height())
    $('#container').css('height', container_height*100/$('body').height()+"%")
    // $('#container').css('background-color',"red")
    // container_width = $('body').width()-$('#prev-btn').width()-$('#next-btn').width()
    // console.log($('#prev-btn').width(), $('body').width())
    // $('#container').width(container_width)
    // console.log($('#container').height(), $('#container').width())
    // console.log(data.canvasheight, data.canvaswidth)

    // function scaleScreen(container_height, container_width, canvasheight, canvaswidth){
    //     scaleY = container_height/parseFloat(canvasheight);
    //     scaleX = container_width/parseFloat(canvaswidth);
    //     return {'scaleY':scaleY, 'scaleX':scaleX}
    // }
    
    // scaleData = scaleScreen($('#container').height(),  $('#container').width(), data.canvasheight, data.canvaswidth)

    function pauseAllVideos() 
    { 
        $('iframe').each(function(){
            $(this).attr('src', $(this).attr('src'));
            // console.log($(this)[0])
            // $(this)[0].contentWindow.postMessage('{"event":"command","func":"' + 'pauseVideo' + '","args":""}', '*');
        });
        $('video').each(function () 
        {
            this.pause();
        });
    }

    function loaddata(data){
        $('#totalpages').text(data.numberofpages);
        $('#currentpage').text(1);
        $.each(data.pages, function (key, value) {
            $.each(value, function (count) {
                // Create modal
                $('#container').append(`
                <div id="page${key}" class = 'coursepages' role="dialog" style="display: none;">

                </div>`)
                // -------------------------------

                $.each(value[count], function (div, div_value) {
                    var now = Math.floor(Math.random() * 900000) + 100000;
                    if (div == 'textdiv') {
                        $.each(div_value, function (css, css_value) {
                            css_string = JSON.stringify(css_value)
                            $('#page' + key).append(`
                                <div style = "overflow-y:auto; position:absolute; top: ${css_value.tops}%; left: ${css_value.left}%; height:${css_value.height}%; width:${css_value.width}%">
                                    ${css_value.content}
                                </div>
                            `);
                            // $('#page' + key).append(css_value.content);

                        });
                    }
                    if (div == 'pic') {
                        $.each(div_value, function (css, css_value) {
                            src = css_value['background-image']
                            console.log(css_value.div)
                            // imgsrc = src.match(/(["'])(?:(?=(\\?))\2.)*?\1/);
                            $('#page' + key).append(`
                                <div style = 'position:absolute; top: ${css_value.tops}%; left: ${css_value.left}%; height:${parseFloat(css_value.height)}%; width:${parseFloat(css_value.width)}%'>
                                <img src = ${src} style = "height:100%; width:100%; object-fit:contain"></img>        
                                </div>
                            `);
                            // $('#page' + key).append(css_value.div);
                        });
                    }

                    if (div == 'btn-div') {
                        $.each(div_value, function (css, css_value) {
                            link = "";
                            if (css_value.hasOwnProperty('link')) {
                                link = "href = " + css_value.link;
                            }
                            $('#page' + key).append(`
                            <div style = "position:absolute; top: ${css_value.tops}%; left: ${css_value.left}%; height: ${css_value.height}%; width: ${css_value.width}%;">
                                <a ${link} target="_blank"><button>${css_value.btn_name}</button</a>
                            </div>
                        `)
                        });
                    }

                    if (div == 'pdf') {
                        $.each(div_value, function (css, css_value) {
                            $('#page' + key).append(`
                            <div style = "position:absolute; top: ${css_value.tops}%; left: ${css_value.left}%; height: ${css_value.height}%; width: ${css_value.width}%;">
                                <object data="${css_value.link}" type="application/pdf" width="100%" height="100%">
                                    alt : <a href="${css_value.link}">${css_value.link}</a>
                                </object>
                            </div>
                        `)
                        });
                    }
                    
                    if (div == 'video') {
                        $.each(div_value, function (css, css_value) {
                            if (css_value.hasOwnProperty('online_link')) {
                                var embed = `<div id = '${now}' style = "position:absolute; top: ${css_value.tops}%; left: ${css_value.left}%; height: ${css_value.height}%; width: ${css_value.width}%;">
                                    <iframe width="100%" height="94%" src="${css_value.online_link}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

                                    </div>`
                                //     <script>
                                //     var options = {
                                //         url: "${css_value.link}",
                                //         width: "${css_value.width}",
                                //         height: "${css_value.height}"
                                //     };

                                //     var videoPlayer = new Vimeo.Player('${now}', options);
                                // `
                            } else {
                                var embed = `
                                <div style = "position:absolute; top: ${css_value.tops}%; left: ${css_value.left}%; height: ${css_value.height}%; width: ${css_value.width}%;">
                                    <video width="100%" height="100%" controls>
                                        <source src="${css_value.local_link}" type="video/mp4">
                                        <source src="${css_value.local_link}" type="video/ogg">
                                        Your browser does not support the video tag.
                                    </video>
                                </div>
                                `
                            }
                            $('#page' + key).append(embed)
                        });
                    }

                    if (div == '_3d') {
                        $.each(div_value, function (css, css_value) {
                            $('#page' + key).append(`
                            <div style = "position:absolute; top: ${css_value.tops}%; left: ${css_value.left}%; height: ${css_value.height}%; width: ${css_value.width}%;">
                                <iframe src="${css_value.link}" width="100%" height="100%">
                                </iframe>
                            </div>
                        `)
                        });
                    }
                });
            });
        });
    }

    loaddata(data)
    $('#page1').css('display', 'block');



    function toggleFullScreen() {
        if ((document.fullScreenElement && document.fullScreenElement !== null) ||
            (!document.mozFullScreen && !document.webkitIsFullScreen)) {
            if (document.documentElement.requestFullScreen) {
                document.documentElement.requestFullScreen();
            } else if (document.documentElement.mozRequestFullScreen) {
                document.documentElement.mozRequestFullScreen();
            } else if (document.documentElement.webkitRequestFullScreen) {
                document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
            }
        } else {
            if (document.cancelFullScreen) {
                document.cancelFullScreen();
            } else if (document.mozCancelFullScreen) {
                document.mozCancelFullScreen();
            } else if (document.webkitCancelFullScreen) {
                document.webkitCancelFullScreen();
            }
        }
    }
</script>

