{% load staticfiles %}

<html>
<head>
    <!-- Bootstrap -->
    <link href="{% static 'vendorsx/bootstrap/dist/css/bootstrap.min.css' %}" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="{% static 'vendorsx/font-awesome/css/font-awesome.min.css' %}" rel="stylesheet">

    <link href="{% static 'chapterPageBuilder/css/style.css' %}" rel="stylesheet">
</head>

<body>
    <div class="container-fluid">
        <!-- For Title -->
        <div class="row">
            <div class="content-title1">
                <span id="chaptertitle">
                    <!-- Chapter title goes here -->
                </span>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <!-- <div class="col-md-1"> -->
                    <div class="button-position" style="position: relative">
                        <div class="prev-btn"
                            style="position: absolute; left:0;top:50vh">
                            <button id="prev-btn" class="btn btn-secondary"><i class="fa fa-backward"></i>
                            </button>
                        </div>
                    </div>
                <!-- </div> -->
                <!-- <div class="col-md-10"> -->
                    <div id="container" style="position: relative;">

                    </div>
                <!-- </div> -->
                <!-- <div class="col-md-1"> -->
                    <div class="button-position">
                        <div style="position: absolute; right:0;top:50vh;">
                            <button id="next-btn" class="btn btn-secondary"><i class="fa fa-forward"></i>
                            </button>
                        </div>
                    </div>
                <!-- </div> -->
            </div>
        </div>

        <!-- For Footer -->
        <div class="row"> 
            <div class="content-footer1">
                Page <span id="currentpage">1</span> of <span id="totalpages">10</span> 
            </div>           
        </div>
    </div>
</body>
</html>

<!-- jQuery -->
<script src="{% static 'vendorsx/jquery/dist/jquery.min.js' %}"></script>
<script type="text/javascript">
    var data = {{ data | safe}};
    console.log(data)

    container_height = $('body').height()-$('.content-title1').height()-$('.content-footer1').height()
    console.log($('body').height(), $('.content-title1').height(), $('.content-footer1').height())
    $('#container').height(container_height)

    // container_height = $('body').width()-$('.content-title1').height()-$('.content-footer1').height()

    // $('#container').height(container_height)
    console.log($('#container').height(), $('#container').width())
    console.log(data.canvasheight, data.canvaswidth)

    scaleY = $('#container').height()/parseFloat(data.canvasheight);
    scaleX = $('#container').width()/parseFloat(data.canvaswidth);
    console.log('scaleY: ' +scaleY +' ,scaleX: '+scaleX)

    $.each(data.pages, function (key, value) {
        $.each(value, function (count) {
            // Create modal
            $('#container').append(`
            <div id="page${key}" class = 'coursepages' role="dialog">

            </div>`)
            // -------------------------------

            $.each(value[count], function (div, div_value) {
                var now = Math.floor(Math.random() * 900000) + 100000;
                if (div == 'textdiv') {
                    $.each(div_value, function (css, css_value) {
                        // css_string = JSON.stringify(css_value)
                        $('#page' + key).append(`
                        <div style = "position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height:${parseFloat(css_value.height)*scaleY}; width:${parseFloat(css_value.width)*scaleX}">
                            ${css_value.content}
                        </div>
                    `);
                    });
                }
                if (div == 'pic') {
                    $.each(div_value, function (css, css_value) {
                        src = css_value['background-image']
                        // imgsrc = src.match(/(["'])(?:(?=(\\?))\2.)*?\1/);
                        $('#page' + key).append(`
                        <div style = 'position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height:${parseFloat(css_value.height)*scaleY}; width:${parseFloat(css_value.width)*scaleX}'>
                        <img src = ${src} style = "height:${parseFloat(css_value.height)*scaleY}; width:${parseFloat(css_value.width)*scaleX}; object-fit:contain"></img>        
                        </div>

                    `);
                    });
                }

                if (div == 'btn-div') {
                    $.each(div_value, function (css, css_value) {
                        link = "";
                        if (css_value.hasOwnProperty('link')) {
                            link = "href = " + css_value.link;
                        }
                        $('#page' + key).append(`
                        <div style = "position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height: ${css_value.height*scaleY}; width: ${css_value.width*scaleX};">
                            <a ${link} target="_blank"><button>${css_value.btn_name}</button</a>
                        </div>
                    `)
                    });
                }

                if (div == 'pdf') {
                    $.each(div_value, function (css, css_value) {
                        $('#page' + key).append(`
                        <div style = "position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height: ${css_value.height*scaleY}; width: ${css_value.width*scaleX};">
                            <object data="${css_value.link}" type="application/pdf" width="100%" height="100%">
                                alt : <a href="${css_value.link}">${css_value.link}</a>
                            </object>
                        </div>
                    `)
                    });
                }
                
                if (div == 'video') {
                    $.each(div_value, function (css, css_value) {
                        if (css_value.hasOwnProperty('online_link')) {
                            var embed = `<div id = '${now}' style = "position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height: ${css_value.height*scaleY}; width: ${css_value.width*scaleX};">
                                <iframe width="100%" height="94%" src="${css_value.online_link}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

                                </div>`
                            //     <script>
                            //     var options = {
                            //         url: "${css_value.link}",
                            //         width: "${css_value.width}",
                            //         height: "${css_value.height}"
                            //     };

                            //     var videoPlayer = new Vimeo.Player('${now}', options);
                            // `
                        } else {
                            var embed = `
                            <div style = "position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height: ${css_value.height*scaleY}; width: ${css_value.width*scaleX};">
                                <video width="100%" height="100%" controls>
                                    <source src="${css_value.local_link}" type="video/mp4">
                                    <source src="${css_value.local_link}" type="video/ogg">
                                    Your browser does not support the video tag.
                                </video>
                            </div>
                            `
                        }
                        $('#page' + key).append(embed)
                    });
                }

                if (div == '_3d') {
                    $.each(div_value, function (css, css_value) {
                        $('#page' + key).append(`
                        <div style = "position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height: ${css_value.height*scaleY}; width: ${css_value.width*scaleX};">
                            <iframe src="${css_value.link}" width="100%" height="100%">
                            </iframe>
                        </div>
                    `)
                    });
                }
            });
        });
    });



</script>
