{% load staticfiles %}
{% load define_action %}


{% if  "teachers" in request.path %}
    {% define 1 as ifteacher %}
{% else %}
    {% define 0 as ifteacher %}
{% endif %}

{% block head %}
    <head>
        <link rel="stylesheet" href="{% static 'chapterPageBuilder/css/jquery-ui.css' %}">
        <style>
            .examiframeholder {
                height: 100vh;
                width: 100%;
                top: 0;
                left: 0;
                position: absolute;
                z-index: 9999;

            }

            .closeiframebtn {
                display: none;
                position: fixed;
                float: right;
                height: -webkit-fit-content;
                height: -moz-fit-content;
                height: fit-content;
                top: 6vh;
                /* left: inherit; */
                right: 1%;
                cursor: pointer;
                bottom: 0;
                /* background-color: white; */
                /* width: 100%; */
                /* left: 48%; */
                text-align: center;
                border: none;
                z-index: 99;
            }


            .closeiframebtn button {
                background-color: white;
                height: 35px;
                width: 35px;
                border-radius: 50%;
                border-color: black;
                background-color: #79a6fb;
            }

            .closeiframebtn i {
                /* float: right; */
                font-size: 22px;
                font-weight: bold;
                color: white;
                /* border-bottom: groove; */
                /* text-align: center; */
                border: none;
            }
        </style>
        <link rel="icon"
              type="image/png"
              href="/static/images/logo.png"/>
        <meta name="viewport" content="width=device-width, intial-scale=1.0">
        <title>LMS</title>

        <!-- Bootstrap -->
        <link href="{% static 'vendorsx/bootstrap/dist/css/bootstrap.min.css' %}" rel="stylesheet">
        <!-- Font Awesome -->
        <!-- <link href="{% static 'vendorsx/font-awesome/css/font-awesome.min.css' %}" rel="stylesheet"> -->

        <link href="{% static 'build/css/theme.min.css' %}" rel="stylesheet">
        <link href="{% static 'lightbox/css/lightbox.css' %}" rel="stylesheet"/>

        <link href="{% static 'chapterPageBuilder/css/newViewer.css' %}" rel="stylesheet">
        <link rel="stylesheet" href="{% static 'chapterPageBuilder/css/responsive-viewer.css' %}">

        <!-- Chat CSS -->
        <link href="{% static 'chapterPageBuilder/css/chat.css' %}" rel="stylesheet">

        <!-- Animate CSS -->
        <link href="{% static 'vendorsx/animate.css/animate.min.css' %}" rel="stylesheet">

        {% if not connection_offline %}
            <link rel="stylesheet" href="{% static 'chapterPageBuilder/SummerNote/summernote.css' %}">
        {% endif %}
        <link rel="stylesheet" href="{% static 'chapterPageBuilder/js/owl-carousel/assets/owl.carousel.css' %}">

        <script type="text/javascript" crossorigin="anonymous"
                src="{% static 'vendorsx/jquery/jquery3.4.1.min.js' %}"></script>
        <link rel='manifest' href='/manifest.webmanifest'>


        <!-- Loads <model-viewer> for modern browsers: -->
        <script type="module" crossorigin="anonymous"
                src="{% static '3D_Viewer/model-viewer.js' %}">
        </script>

        <!-- Loads <model-viewer> for old browsers like IE11: -->
        <script nomodule crossorigin="anonymous"
                src="{% static '3D_Viewer/model-viewer-legacy.js' %}">
        </script>


    </head>
{% endblock head %}


<body>

<div class="top-header">
    <div class="container">
        <div class="col-md-12 col-sm-12 col-xs-12">
            <div class="row top-holder-row">
                <div class="col-md-6 col-sm-6 col-xs-8">
                    <div class="course-chapter">
                        <ul class="course-chapter-holder">
                            <li class="course-name">{{ course }} &nbsp;<i style="color:white"
                                                                          class="fa fa-caret-right"></i></li>
                            <li class="chapter-name">{{ chapter }} </li>
                        </ul>
                    </div>

                </div>
                <div class="col-md-6 col-sm-6 col-xs-4 page-name-holder">
                    {% if ifteacher %}
                        <div style="margin-right: 4em;color: white;">
                            <label for="id_screen_sync">Force Screen Sync</label>
                            <input type="checkbox" name="screen_sync" id="id_screen_sync">
                        </div>
                    {% endif %}
                    <div class="page-name">
                            <span> 
                                 {#  Close Button   #}
                                            <a href="
                                            {% if '/teachers' in request.path %}
                                                {% url 'teacher_chapterinfo_detail' course.pk chapter.pk %}
                                            {% elif '/students' in request.path %}
                                            {% url 'student_chapterinfo_detail' course.pk chapter.pk %}
                                        {% else %}
                                            {% url 'chapterinfo_detail' course.pk chapter.pk %}
                                        {% endif %}
                                        " class="back-btn-content"
                                               style="position: absolute; top:0px;right:5px; font-size:20px">
                                            <div class="closebtn">
                                                <!-- <i style="
                                                background-color: #2A3F54;
                                                color:white;
                                                font-size:24px;

                                                border-radius: 50%;
                                                padding: 0.5px 2px;
                                                " class="fa fa-times"></i> -->
                                                <i class="fas fa-window-close"></i>
                                            </div>
                                        </a>
                                  {# End of close button #}

                            </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="main-bottom-slider2" class="custom-owl-slider2">
    <div class="owl-carousel owl-theme thumbnail-container" id="thumbnail-slider">

    </div>

</div>
<section class="whole-container">


    <div id="sidebar-id" class="sidenavbar-part  animate">
        <div class="sidebar-top">

            <div class="col-md-12 col-sm-12 profile-description">
                <div class="row" style="margin: 0px;">
                    <div class="col-sm-3 col-md-3" style="padding: 0!important;">
                        <div>
                            <img class="img img-circle" src="{{ user.Avatar }}" alt="Profile_picture" width="50"
                                 height="50">
                        </div>

                    </div>
                    <div class="col-sm-9 col-md-9 user-information ">

                        <span>Welcome,</span>
                        <p class="user-name-part">{{ request.user }}</p>


                    </div>

                </div>

            </div>
        </div>


        <div class="chapter-lists-all">
            <div class="chapter-name1">
                Chapter Lists
            </div>
            <ul class="chapter-list">
                {% now "Y-m-d H:i" as todays_datewithtime %}
                {% for chapterobj in chapterList %}
                    <li>
                        {% if chapterobj.getChapterContent != '' %}
                            <a class="focus-page"
                               {% if chapterobj.pk == chapter.pk %}style=" background-color: #647ca8; padding:5px;"{% endif %}
                               href="
                                   {% if "teachers" in request.path %}
                                        {% url 'teacher_NewContentViewer' course.pk chapterobj.pk %}
                                   {% elif "students" in request.path %}
                                        {% url 'student_NewContentViewer' course.pk chapterobj.pk %}
                                   {% else %}
                                    {% url 'NewContentViewer' course.pk chapterobj.pk %}
                                   {% endif %}
                               ">
                                {% if not chapterobj.Use_Flag %}
                                    <span class="inactive-chapter">
                                {{ chapterobj.Chapter_No }}. {{ chapterobj.Chapter_Name }} ( Unpublished )
                            </span>
                                {% elif chapterobj.End_Date and todays_datewithtime > chapterobj.End_Date|date:"Y-m-d H:i" or chapterobj.Start_Date and todays_datewithtime < chapterobj.Start_Date|date:"Y-m-d H:i" %}
                                    <span class="inactive-chapter">
                                {{ chapterobj.Chapter_No }}. {{ chapterobj.Chapter_Name }} ( Inactive )
                            </span>
                                {% else %}
                                    <span>
                                {{ chapterobj.Chapter_No }}. {{ chapterobj.Chapter_Name }}
                            </span>
                                {% endif %}
                            </a>
                        {% else %}
                            <span class="inactive-chapter">
                                {{ chapterobj.Chapter_No }}. {{ chapterobj.Chapter_Name }} (No Contents)
                            </span>
                        {% endif %}
                    </li>
                {% endfor %}

            </ul>
        </div>


        <div class="sidebar-buttom ">

            <ul class="sidebar-bottom-icons" style=" list-style:none; padding: 0px !important">
                <li>
                    <a id="togglefull" data-toggle="tooltip" data-placement="top" title="" onclick="toggleFullScreen()"
                       data-original-title="FullScreen">
                        <span class="glyphicon glyphicon-fullscreen" aria-hidden="true"></span>
                    </a>

                </li>
                <li>
                    <a class="profileBtn" data-toggle="tooltip" data-placement="top" title="" href="
                    {% if '/teachers' in request.path %}
                        {% url 'teacher_user_profile' %}
                    {% elif '/students' in request.path %}
                        {% url 'student_user_profile' %}
                    {% else %}
                    /profile/
                    {% endif %}
                        "
                       data-original-title="Profile">
                        <span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                    </a>

                </li>
                <li>
                    <a class="apkdownloadBtn" data-toggle="tooltip" data-placement="top" title=""
                       href="https://we.tl/t-NjDo1I27Vy" target="_blank"
                       data-original-title="Download u-LMS Android App">
                        <span class="glyphicon glyphicon-phone" aria-hidden="true"></span>
                    </a>

                </li>
                <li>
                    <a class="logoutBtn" data-toggle="tooltip" data-placement="top" title="" href="/logout"
                       data-original-title="Logout">
                        <span class="glyphicon glyphicon-off" aria-hidden="true"></span>
                    </a>

                </li>

            </ul>

        </div>
    </div>
    {% if not connection_offline %}
        <ul class="chat-sidenav">
            <li data-toggle="tooltip" data-placement="right" title='Open Navgation' class="glyphicon glyphicon-th"
                id="hamburg-nav">
            </li>
            <li data-toggle="tooltip" data-placement="right" title='Chat ' class="icon-for-chat">
                <i style="color: white;" class="chat-icon closechatopen fa far fa-comment" id="closechatopen"></i>
            </li>
            <li data-toggle="tooltip" data-placement="right" title='Video Call' class="icon-for-video">
                <i style="color: white;" class="fa fa-video icon-video closechatopen1 "></i>
            </li>
        </ul>

        <ul class="edit-viewer">

            {% if '/teachers' in request.path %}

                <li data-toggle="tooltip" data-placement="bottom" title='Edit'>
                    <a href="{% url 'teachers_newChapterBuilder' course.pk chapter.pk %}"> <i
                            class="fas fa-pen-square"></i> </a>
                </li>

            {% elif '/teachers' not in request.path and '/students' not in request.path %}

                <li data-toggle="tooltip" data-placement="bottom" title='Edit'>
                    <a href="{% url 'newChapterBuilder' course.pk chapter.pk %}"> <i class="fas fa-pen-square"></i> </a>
                </li>

            {% endif %}

        </ul>


        <ul class="chat-sidenav-close slideInLeft animate">
            <li class=close-icon-sidebar>
                <i class="fa fa-times icon1-largescreen"></i>
                <i class="fa fa-minus-square icon2-smallscreen"></i>

            </li>
            <li class="icon-for-chat2">
                <i class="  fa far fa-comment"></i>
            </li>
            <li class="icon-for-video2">
                <i class="fa fa-video icon-video2"></i>

            </li>


        </ul>

        <!-- <div class="page-view-icon">

              <i title="Click for page view" style="color: white;" class="fa fa-list"></i>

        </div> -->

    {% endif %}


    <div id="container" class="container12">

        <div id="page-contents" class="page-contents"></div>


        <div id="main-bottom-slider" class="custom-owl-slider">
            <div class="owl-carousel owl-theme thumbnail-container" id="thumbnail-slider">

            </div>

        </div>

        <div class="page-link-view">
            <ul class="both-views">
                <li class="page-view">
                    <input id="page-id" type="checkbox" checked>&nbsp;
                    <label for="page-id" class="view-label"> Page View</label><br>
                </li>
                <li class="link-view">
                    <input id="link-id" type="checkbox" checked>&nbsp;
                    <label for="link-id" class="view-label"> Link View</label>

                </li>


            </ul>

        </div>

        <div class="navigation-owl ">
            <div class="navholder">
                <ul class="nav-view">
                    <li id="prev-btn"><i class="fa fa-angle-left"></i></li>
                    <li data-toggle="tooltip" data-placement="top" title='View Page Options' class="view-icon"
                        value="show"><i class="fa fa-list-ul"></i></li>

                    <li id="next-btn"><i class="fa fa-angle-right"></i></li>
                </ul>
                <div class="page-number-list">
                    <span style="color: white;" class="currentpage" id="currentpage"> &nbsp;&nbsp;</span> / <span
                        class="totalpages" id="totalpages"></span>
                </div>
            </div>


        </div>
        <div class="link-view-box hidden-xs">
            <div data-toggle="tooltip" data-placement="top" title='Enter Page Number' style="text-align:center">
                <input type="hidden" id="current-pg-num" value="">
                <input class="number-active" type="number" min="1" max="{{ data.numberofpages }}" id="pg-change"
                       name="firstname" placeholder="page"> <span>/ </span><span class="totalpages"></span>
            </div>


        </div>

        <!-- Chat BOX UI -->
        <span class="chat-info" data-userName="{{ user }}" data-userID="{{ user.id }}" data-userIcon="{{ user.Avatar }}"
              data-chapterID="{{ chapter.id }}"></span>

        <div id="main-chat-box" class="chat-dialogbox  animate">
            <ul class="chat-header">
                <li class="ham-icon">
                    <i class="fa fa-bars"></i>
                </li>
                {% if not ifteacher %}
                <li class="user-image-padding">
                <li>
                 {% endif %}   
                    <div class="green-online"></div>
                </li>
                <span style="color: white;">  Online</span>&nbsp;
                <li class="online-number">1</li>&nbsp;
                {% if not ifteacher %}
                <div class="chat-user-image">
                </div>
                {% endif %}
                </li>
                {% if not ifteacher %}
                <li class="name-user"></li>
                {% endif %}
                {% if ifteacher %}
                <li id="QuickQuiz" class="quiz-quick" data-toggle="modal" data-target="#quiz_create_popup"> Quick Quiz
                        <i class="fa fa-pencil" style="color:black"></i>
                    </li>

                <li id="QuickSurvey" class="survey-quick" data-toggle="modal" data-target="#survey_content_modal">Quick
                        Survey

                        <i class="fa fa-pencil" style="color: black;"></i>
                    </li>
                    {#                                <li>Force Screen Sync <input id="forceScreen" type="checkbox"></li>#}
                    {#                            {% else %}#}
                    {#                                <li id="followteacher" class="offline-followteacher">Teacher#}
                    {#                                    Offline<i class="fa fa-book"> </i></li>#}
                {% endif %}
                <li class="options-chat">
                    <div class="bell col-sm-6 col-xs-6" style="padding: 0px!important;">
                        <input type="hidden" name="notification" id="id_notification" value="1">
                        <span data-toggle="tooltip" data-placement="bottom" title='Click to hide'><i
                                class="bell-icon fas fa-bell "></i></span>
                        <span data-toggle="tooltip" data-placement="bottom" title='click to show'> <i
                                class="bell-icon-close text-danger fas fa-bell-slash"></i></span>

                    </div>
                    <div class="volume col-sm-6 col-xs-6" style="padding: 0px!important;">
                        <input type="hidden" name="sound" id="id_sound" value="1">
                        <span data-toggle="tooltip" data-placement="bottom" title='Click to Mute'><i
                                class="volume-icon fas fa-volume-up "></i></span>
                        <span data-toggle="tooltip" data-placement="bottom" title='Click to Unmute'><i
                                class="volume-icon-close text-danger fas fa-volume-mute "></i></span>


                    </div>
                </li>

                <li class="close-chat"><i class="fa fa-times"></i></li>
            </ul>

            <ul class="chat-body">
                <li class="left-chat user-list">
                </li>

                <li class="chat-canvas">
                    <div id="chat-log"></div>
                </li>
            </ul>

            <div class="input-send">
                <div class="msger-inputarea">
                    <input type="text" class="msger-input" id="chat-message-input" placeholder="Enter your message...">
                    <button type="submit" class="msger-send-btn" id="chat-message-submit"><i
                            class=" custom-send fa fa-paper-plane"></i></button>
                </div>
                <!-- <div class="row" style="margin: 0px!important;">
                    <div class="col-sm-10" style="padding: 0!important;">
                        <textarea class="form-control" id="chat-message-input" rows="1"></textarea>
                    </div>
                    <div class="send-button col-sm-2">
                        <button type="submit" id="chat-message-submit"><i class=" custom-send fa fa-paper-plane"></i></button>
                    </div>
                </div> -->
            </div>


        </div>
        <!-- Chat UI end -->
        <div class="video-box">
            <div class="close-minimizevideo">
                <div class="relative-video-call">
                    <ul class="video-call-option">

                        <li class="close-call">
                            <i class="fa fa-times"></i>

                        </li>

                    </ul>

                </div>
                <div id="UBL-meet"></div>

                <script src='https://meet.jit.si/external_api.js'></script>
                <script>
                    $(document).one('click', '.icon-for-video', function () {
                        $('.icon-for-video').prepend(`<i style="color: red; z-index:2; position:absolute;margin-top: 6px;margin-left: 4px;" class="far fa-dot-circle"></i>`);
                        $('.icon-for-video').attr('title','Live');
                        let audioMute = true;
                        let toolbarButtons = [
                                    'microphone', 'camera', 'closedcaptions', 'desktop', 'fullscreen',
                                    'fodeviceselection',
                                    'etherpad', 'sharedvideo', 'settings', 'raisehand',
                                    'videoquality', 'filmstrip', 'stats', 'shortcuts',
                                    'tileview', 'videobackgroundblur', 'download',
                                    //HIDDEN OPTIONS  NOT USED IGNORE
                                    // 'e2ee', 'security',
                                    // 'hangup',
                                    // 'profile', 'livestreaming', 'invite', 'feedback', 'help', 'recording', 'chat',
                                    // 'mute-everyone',
                                ];
                        let settingsSection = ['devices'];
                        const domain = 'meet.jit.si';

                        {% if ifteacher %}
                            audioMute = false;
                            toolbarButtons.push('mute-everyone');
                            settingsSection.push('moderator');
                        {% endif %}

                        const options = {
                            roomName: 'UBLCloud-{{ chapter.id }}'+ window.location.hostname,
                            width: "100%",
                            height: "100%",
                            parentNode: document.querySelector('#UBL-meet'),

                            configOverwrite: {
                                startWithAudioMuted: audioMute,
                                startWithVideoMuted: true,
                                disableDeepLinking: true,
                                etherpad_base: "https://pad.riseup.net/p/"
                            },

                            interfaceConfigOverwrite: {
                                APP_NAME: 'UBL Meet',
                                NATIVE_APP_NAME: 'UBL Meet',
                                PROVIDER_NAME: 'UBL',
                                SHOW_JITSI_WATERMARK: 0,
                                SHOW_WATERMARK_FOR_GUESTS: false,
                                userInfo: {
                                    displayName: '{{ user }}',  
                                    email: '{{ user.email }}',

                                },
                            TOOLBAR_BUTTONS: toolbarButtons,

                            SETTINGS_SECTIONS: settingsSection,

                            SHOW_CHROME_EXTENSION_BANNER: false,
                            SHOW_PROMOTIONAL_CLOSE_PAGE: false,
                            MOBILE_APP_PROMO: false,
                            },
                        };
                        const api = new JitsiMeetExternalAPI(domain, options);
                    });

                </script>
            </div>
        </div>
    </div>


    {#  Iframe Holder   #}
    <div id="examiframeholder">
        <div id="closeiframebtn" class="closeiframebtn">
            <button>
                <i class="fa fa-close" aria-hidden="true">
                </i>
            </button>
        </div>
        <div id="iframeholder"></div>
    </div>

</section>
{% if ifteacher %}
    {% include "chapter/content-viewer-moules/QuickSurvey.html" %}
    {% comment %}{% include "chapter/Content_Viewer_WebSocket_teacher.html" %} {% endcomment %}
{% else %}
    {% comment %}{% include "chapter/Content_Viewer_WebSocket_students.html" %} {% endcomment %}
{% endif %}
<script src="{% static 'vendorsx/jquery/dist/jquery.min.js' %}"></script>
<script src="{% static 'chapterPageBuilder/js/jquery-ui.min.js' %}"></script>

<!-- jQuery -->
<script src="{% static 'lightbox/js/lightbox.js' %}"></script>
<script src="{% static 'vendorsx/bootstrap/dist/js/bootstrap.min.js' %}"></script>
<script src="{% static 'vendorsx/moment/min/moment.min.js' %}"></script>
<script src="{% static 'vendorsx/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js' %}"></script>
<script src="{% static 'chapterPageBuilder/js/owl-carousel/owl.carousel.js' %}"></script>

<script src="{% static 'js/modernizr.js' %}"></script>

<!-- Cloudinary will be removed soon -->
<link href="https://unpkg.com/cloudinary-video-player@1.3.4/dist/cld-video-player.min.css"
      rel="stylesheet">
<script src="https://unpkg.com/cloudinary-core@2.6.3/cloudinary-core-shrinkwrap.min.js"
        type="text/javascript"></script>
<script src="https://unpkg.com/cloudinary-video-player@1.3.4/dist/cld-video-player.min.js"
        type="text/javascript"></script>

<!-- Font Awesome 5.13 -->
<script defer src="{% static 'fontawesome/js/all.js' %}"></script>

{% if not connection_offline %}
    <script src="{% static 'chapterPageBuilder/SummerNote/summernote.min.js' %}"></script>
{% endif %}


<!-- Chat related scripts -->
<script>
    var datearr = [];
    var chatDetails =
    {{ chat_history|safe }}
    const chatHistory = chatDetails.chat_history;
    const audioURLIn = "{% static 'audio/incoming_msg.mp3' %}";
    const audioURLOut = "{% static 'audio/outgoing_msg.mp3' %}";
    const botImage = "{% static 'images/bot.png' %}";
</script>

<!-- For notification sound -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.1.1/howler.min.js"></script>

<!-- CHAT SCRIPT -->
<script src="{% static 'chapterPageBuilder/js/chat.js' %}"></script>

<!-- notificationchat -->
<script>
    $(document).on('click', '.bell-icon', function () {
        $(".bell-icon-close").css("display", "block");
        $(".bell-icon").css("display", "none");
        $("#id_notification").val('0');
    });
    $(document).on('click', '.bell-icon-close', function () {
        $(".bell-icon").css("display", "block");
        $(".bell-icon-close").css("display", "none");
        $("#id_notification").val('1');
    });
    $(document).on('click', '.volume-icon', function () {
        $(".volume-icon-close").css("display", "block");
        $(".volume-icon").css("display", "none");
        $("#id_sound").val('0');
    });
    $(document).on('click', '.volume-icon-close', function () {
        $(".volume-icon").css("display", "block");
        $(".volume-icon-close").css("display", "none");
        $("#id_sound").val('1');
    });
</script>
<!-- ends -->
<!-- chat-icon active -->

<script>
    $(document).ready(function () {

        $(".icon-for-chat").click(ActiveChatIcon1);


    });

    function ActiveChatIcon1() {
        if ($(".chat-dialogbox").is(":visible")) {
            $(".closechatopen").removeClass("color-chat");

        } else {
            $(".closechatopen").addClass("color-chat");

        }

    }
</script>
<script>
    $(document).ready(function () {

        $(".icon-for-video").click(ActiveChatIcon);


    });

    function ActiveChatIcon() {
        if ($(".video-box").is(":visible")) {
            $(".closechatopen1").removeClass("color-chat");

        } else {
            $(".closechatopen1").addClass("color-chat");

        }

    }
</script>


<!-- ends -->


<script type="text/javascript">
    var chapterID = '{{ chapter.id }}'
    {% if not data %}
        alert("No contents in this page. Returning back to previous page...");
        window.history.go(-1);
    {% endif %}


    var currentpage = 1;
    var studystarttime = Date.now() / 1000 | 0; // Floors the value


    lightbox.option({
        'resizeDuration': 200,
        'wrapAround': true
    });

    // $('a').on('click', 'img', function(){
    //     console.log('hdjsf')
    //     if($(this).hasAttribute('data-lightbox')){
    //         return false;
    //     }
    // }).dblclick(function () {
    //     window.location = this.href;
    //     return false;
    // });
    document.addEventListener('visibilitychange', function () {
        pauseAllVideos(); // change tab text for demo
    })
    $(document).keydown(function (e) {
        if ($('#lightbox').css('display') == 'none' && $(document.activeElement)[0] == $('body')[0] && !$(document.activeElement).hasClass('modal-open')) {
            if (e.keyCode == '39') {
                $('#next-btn').click();
                return false
            }
            if (e.keyCode == '37') {
                $('#prev-btn').click();
                return false
            }
            //UP
            if (e.keyCode == '38') {
                $('body').animate({scrollTop: 0}, 100);
                return false;
            }
            //DOWN
            if (e.keyCode == '40') {
                $('body').animate({scrollTop: $(document).height()}, 100);
                return false;
            }

            if (e.keyCode == '70') {
                var hasFocus = $('input, textarea').is(':focus') || $('.note-editable').is(':focus');
                if (hasFocus) {
                    return
                }

                toggleFullScreen();
                return false;
            }

        }
    });

    {% if data %}
        var data = {{ data | safe}};
    {% endif %}

    function pauseAllVideos() {
        $('iframe').each(function () {
            $(this).attr('src', $(this).attr('src'));
            // console.log($(this)[0])
            // $(this)[0].contentWindow.
            // stMessage('{"event":"command","func":"' + 'pauseVideo' + '","args":""}', '*');
        });
        $('video').each(function () {
            this.pause();
        });
    }

    $(document).ready(function () {
        // Chat BOT time added
        let currentdate = new Date().toLocaleTimeString('en-US', {
            hour12: true,
            hour: "numeric",
            minute: "numeric"
        });
        $('.default-time').text(currentdate);


        $('#hamburg-nav').on('click mouseover', function () {
            {#openNav();#}
        });


        $('#page-contents').on('click', '.iframefullscreenbtn', function () {
            // check if fullscreen mode is available
            if (document.fullscreenEnabled ||
                document.webkitFullscreenEnabled ||
                document.mozFullScreenEnabled ||
                document.msFullscreenEnabled) {

                // which element will be fullscreen
                var iframe = $(this).parent().find('object')[0] || $(this).parent().find('iframe')[0];
                // Do fullscreen
                if (iframe.requestFullscreen) {
                    iframe.requestFullscreen();
                } else if (iframe.webkitRequestFullscreen) {
                    iframe.webkitRequestFullscreen();
                } else if (iframe.mozRequestFullScreen) {
                    iframe.mozRequestFullScreen();
                } else if (iframe.msRequestFullscreen) {
                    iframe.msRequestFullscreen();
                }
            } else {
                document.querySelector('.error').innerHTML = 'Your browser is not supported';
            }
        });

    });

    $('.page-contents').on('click', '.chapterbuttons', function (e) {
        if ($(this).hasClass('btn-div')) {
            return
        }
        e.preventDefault()
        let link = $(this).find('a')[0].href;
        if (link) {
            {% if '/students' in request.path %}
                loadexam(link)
            {% else %}
                loadexam(link, 1)
            {% endif %}
        }
    })

    function loadexam(link, ShowCloseBoxonInit = false) {

        $('#examiframeholder').addClass('examiframeholder')
        $('#iframeholder').append(`
            <iframe src = ${link} height = 100% width = 100%></iframe>
        `);
        $('iframe').on('load', function () {
            if ($(this).contents().find('#survey_already_taken').is(':visible')) {
                $('#closeiframebtn').css('display', 'block')

            }
            if (link != this.contentWindow.location.href && link + '/' != this.contentWindow.location.href) {
                $('#closeiframebtn').css('display', 'block')

            }
            if (ShowCloseBoxonInit) {
                $('#closeiframebtn').css('display', 'block')

            }
        });
    }

    $('#chapterProgressView').on('click', function (e) {
        e.preventDefault()
        var link = $(this).find('a')[0].href
        loadexam(link, true)
    })

    $('#attendanceView').on('click', function (e) {
        e.preventDefault()
        var link = $(this).find('a')[0].href
        loadexam(link, true)
    })

    $('#closeiframebtn').click(function () {
        $('#examiframeholder').removeClass('examiframeholder')
        $('#closeiframebtn').css('display', 'none')
        $('#iframeholder').empty();
    })

    $('#pg-change').on('change', function () {
        if (parseInt(this.value) <= parseInt(data.numberofpages) && parseInt(this.value) > 0) {
            pauseAllVideos();
            currentpage = this.value;
            changePage(this.value)
        }
    })

    function loaddata(data, currentpage = 1) {
        window.currentpage = currentpage
        $('.totalpages').text(data.numberofpages);
        $('.currentpage').text(window.currentpage);

        $('#pg-change').val(window.currentpage);

        // For storing current page no. in hidden state
        $('#current-pg-num').val(window.currentpage);
        $('#current-pg-num').change();

        $.each(data.pages, function (key, value) {
            if (key == window.currentpage) {
                $.each(value, function (count) {
                    // Create modal
                    $('#page-contents').empty();
                    $('#page-contents').append(`
                    <div id="page${key}" class = 'coursepages' role="dialog">

                    </div>`)
                    // -------------------------------

                    $.each(value[count], function (div, div_value) {
                        var now = Math.floor(Math.random() * 900000) + 100000;
                        if (div == 'textdiv') {
                            $.each(div_value, function (css, css_value) {
                                css_string = JSON.stringify(css_value)
                                content = css_value.content;

                                $('#page' + key).append(`
                                    <div class = "textdiv" style = "overflow:hidden; position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height:${css_value.height}; width:${css_value.width}; padding:10px; z-index:100">
                                        ${content}
                                    </div>
                                `);
                                // $('#page' + key).append(css_value.content);

                            });
                        }
                        if (div == 'pic') {
                            $.each(div_value, function (css, css_value) {
                                if (css_value.hasOwnProperty('background-image')) {
                                    src = css_value['background-image']
                                    // imgsrc = src.match(/(["'])(?:(?=(\\?))\2.)*?\1/);
                                    $('#page' + key).append(`
                                        <div class = "pic" style = 'position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height:${parseFloat(css_value.height)}%; width:${parseFloat(css_value.width)}%'>
                                        <a href = ${src} data-lightbox="roadtrip"> <img src = ${src} style = "height:100%; width:100%;" class="image-fitting"></img>  </a>
                                        </div>
                                    `);
                                } else if (css_value.hasOwnProperty('link')) {
                                    $('#page' + key).append(`
                                        <div class = "pic" style = 'position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height:${parseFloat(css_value.height)}%; width:${parseFloat(css_value.width)}%'>
                                        <div class = "spinnner" style = 'position:relative'> 
                                            <div class="loadspin loadspin-pic " style="position:absolute; top:44%; left:47%">
                                                
                                            </div>
                                        <iframe onload="onPicFrameLoad(this)" class="pic-iframe" style="width:100%;height:100%;" src="${css_value.link}"
                                            frameborder="0" allowfullscreen scrolling="no" allow="autoplay; fullscreen"></iframe>
                                        </div>
                                       </div>
                                    `);
                                }

                                // $('#page' + key).append(css_value.div);
                            });
                        }

                        if (div == 'btn-div') {
                            $.each(div_value, function (css, css_value) {
                                link = "";
                                if (css_value.hasOwnProperty('link')) {
                                    link = "href = " + css_value.link;
                                }
                                font_size = convertFont(css_value.font_size)
                                $('#page' + key).append(`
                                <div class = "chapterbuttons btn-div" style = "z-index: 1;position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height: ${css_value.height}; width: ${css_value.width};">
                                    <a ${link} target="_blank">
                                        <button class="custom-btn-only" style="height:100% ; width:100%" >
                                            <div class="row text-center" width=100%>
                                                <span class="resizable-text-only" style = "font-size: ${font_size}">${css_value.btn_name} </span>
                                            </div>
                                        </button>
                                    </a>
                                </div>
                            `)
                            });
                        }

                        if (div == 'quizdiv') {
                            let quizpk;
                            $.each(div_value, function (css, css_value) {
                                link = "";
                                if (css_value.hasOwnProperty('link')) {
                                    quizpk = (css_value.link.split('/')[2]).match(/\d+/)[0];
                                    {% if '/teachers' in request.path %}
                                        link = "href = /quiz/markingfilter/" + quizpk + '?iframe=1'
                                    {% elif '/students' not in request.path and '/teachers' not in request.path %}
                                        link = "href = /quiz/detail/" + quizpk + '?iframe=1'
                                    {% else %}
                                        link = "href = " + css_value.link + '?iframe=1';
                                    {% endif %}
                                }
                                font_size = convertFont(css_value.font_size)
                                $('#page' + key).append(`
                                <div class = "chapterbuttons quiz-div" style = "z-index: 1;position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height: ${css_value.height}; width: ${css_value.width};">
                                    {% if not connection_offline %}
                                        <a ${link}>
                                            <button class="custom-btn-only"style="width:100%; height:100%">
                                                <div class="row text-center" width=100%>
                                                    <span class="resizable-text-only" style = "font-size: ${font_size}">
                                    ${css_value.quiz_btn_name} </span>
                                                </div>
                                                <div class="row text-center">
                                                    <span style = "font-size: 1em;">${css_value.quiz_name}</span>
                                                </div>
                                            </button>
                                        </a>
                                    {% else %}
                                        <button class="custom-btn-only"style="width:100%; height:100%" disabled>
                                            <div class="row text-center" width=100%>
                                                <span class="resizable-text-only" style = "font-size: ${font_size}">Quiz</span>
                                            </div>
                                            <div class="row text-center">
                                                <span style = "font-size: 1em; color: red">Please use online viewer to play quiz</span>
                                            </div>
                                        </button>
                                    {% endif %}
                                </div>
                            `)
                            });
                        }

                        if (div == 'surveydiv') {
                            let surveypk;
                            $.each(div_value, function (css, css_value) {
                                link = "";
                                if (css_value.hasOwnProperty('link')) {
                                    surveypk = (css_value.link.split('/')[4]).match(/\d+/)[0];
                                    {% if '/teachers' in request.path %}
                                        link = "href = /teachers/surveyinfodetail/detail/" + surveypk + '?iframe=1'
                                    {% elif '/students' not in request.path and '/teachers' not in request.path %}
                                        link = "href = /survey/surveyinfo/detail/" + surveypk + '?iframe=1'
                                    {% else %}
                                        link = "href = " + css_value.link + '?iframe=1';
                                    {% endif %}
                                }
                                font_size = convertFont(css_value.font_size)
                                $('#page' + key).append(`
                                <div class = "chapterbuttons survey-div" style = "position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height: ${css_value.height}; width: ${css_value.width}; background-color:#DDDDDD">
                                    {% if not connection_offline %}
                                        <a ${link} target="_blank">
                                            <button class="custom-btn-only"style="width:100%; height:100%">
                                                <div class="row text-center" width=100%>
                                                <span class="resizable-text-only" style = "font-size: ${font_size}">
                                    ${css_value.survey_btn_name} </span>
                                                </div>
                                                <div class="row text-center">
                                                        <span class = "survey-name " style = "font-size:1em">
                                                ${css_value.survey_name}
                                                </div>
                                            </button>
                                        </a>
                                    {% else %}
                                        <button class="custom-btn-only"style="width:100%; height:100%" disabled>
                                            <div class="row text-center" width=100%>
                                             <span class="resizable-text-only" style = "font-size: ${font_size}">Survey </span>
                                            </div>
                                            <div class="row text-center">
                                                    <span class = "survey-name " style = "font-size:1em; color: red">Please use online viewer to take survey.</span>
                                            </div>
                                        </button>
                                    {% endif %}
                                </div>
                            `)
                            });
                        }

                        if (div == 'pdf') {
                            $.each(div_value, function (css, css_value) {
                                $('#page' + key).append(`
                                <div class="iframefullscreen pdf-div" style = "position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height: ${css_value.height}; width: ${css_value.width};">
                                    <div class = "spinnner" style = 'position:relative'> 
                                        <div class="loadspin" style="position:absolute; top:44%; left:47%">
                                            
                                        </div>
                                    <div class = "iframefullscreenbtn"><i class="fa fa-credit-card"></i></div>
                                        <iframe onload="onPdfFrameLoad(this)"  class="pdf-iframe" src="/static/pdfjs/web/viewer.html?file=../../..${encodeURIComponent(css_value.link)}" type="application/pdf" width="100%" height="100%">
                                        alt : PDF File
                                    </iframe>
                                  </div>
                                </div>
                            `)
                            });
                        }

                        if (div == 'video') {
                            $.each(div_value, function (css, css_value) {
                                if (css_value.hasOwnProperty('online_link')) {
                                    var embed = `<div class="video-div" id = '${now}' style = "position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height: ${css_value.height}; width: ${css_value.width};">
                                        <div class = "spinnner" style = 'position:relative'> 
                                            <div class="loadspin" style="position:absolute; top:44%; left:47%">
                                                
                                            </div>
                                        <iframe onload="onVidFrameLoad(this)" class="video-iframe" width="100%" height="94%" src="${css_value.online_link}" frameborder="0" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                          </div>
                                        </div>`
                                } else {
                                    if (css_value.hasOwnProperty('local_link')) {
                                        if (css_value.local_link.includes('/media/chapterBuilder/')) {
                                            var embed = `
                                        <div class="video-div" style = "position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height: ${css_value.height}; width: ${css_value.width};">
                                            <video controls muted"
                                                class="videodim">
                                                <source src="${css_value.local_link}"  type="video/mp4">
                                            </video>
                                        </div>
                                        `
                                        } else {
                                            var embed = `
                                        <div class="video-div" style = "position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height: ${css_value.height}; width: ${css_value.width};">
                                            <video controls muted id="video${now}"
                                                class="videodim cld-video-player cld-video-player-skin-dark example-player"
                                                data-cld-public-id="${css_value.local_link}" data-public_id="${css_value.local_link}" data-cld-source-types='["mp4", "ogg", "webm"]'>
                                                <source src="${css_value.local_link}"  type="video/mp4">
                                            </video>
                                        </div>
                                        `
                                        }
                                    } else {
                                        var embed = ""
                                    }

                                }
                                $('#page' + key).append(embed)
                                if (!css_value.hasOwnProperty('online_link') && css_value.hasOwnProperty('local_link')) {
                                    if (!css_value.local_link.includes('/media/chapterBuilder')) {
                                        play("#video" + now)
                                    }
                                }
                            });
                        }

                        if (div == 'audio') {
                            $.each(div_value, function (css, css_value) {
                                if (css_value.hasOwnProperty('online_link')) {
                                    var embed = `<div class="audio-div" id = '${now}' style = "position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height: ${css_value.height}; width: ${css_value.width};">
                                        <div class = "spinnner" style = 'position:relative'> 
                                            <div class="loadspin" style="position:absolute; top:44%; left:47%">
                                                
                                            </div>
                                        <iframe onload="onAudioFrameLoad(this)" width="100%" height="94%" src="${css_value.online_link}" frameborder="0" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                        </div>
                                        </div>`
                                } /*else {
                                    if (css_value.local_link.includes('/media/chapterBuilder/')) {
                                        var embed = `
                                    <div style = "position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height: ${css_value.height}; width: ${css_value.width};">
                                        <audio controls muted"
                                            class="videodim">
                                            <source src="${css_value.local_link}"  type="video/mp4">
                                        </audio>
                                    </div>
                                    `
                                    } else {
                                        var embed = `
                                    <div style = "position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height: ${css_value.height}; width: ${css_value.width};">
                                        <video controls muted id="audio${now}"
                                            class="audiodim cld-video-player cld-video-player-skin-dark example-player"
                                            data-cld-public-id="${css_value.local_link}" data-public_id="${css_value.local_link}" data-cld-source-types='["mp4", "ogg", "webm"]'>
                                            <source src="${css_value.local_link}"  type="audio/mp4">
                                        </video>
                                    </div>
                                    `
                                    }
                                }*/
                                $('#page' + key).append(embed)
                                if (!css_value.hasOwnProperty('online_link') && css_value.hasOwnProperty('local_link')) {
                                    if (!css_value.local_link.includes('/media/chapterBuilder')) {
                                        play("#audio" + now)
                                    }
                                }
                            });
                        }

                        if (div == '_3d') {
                            $.each(div_value, function (css, css_value) {
                                $('#page' + key).append(`
        <div class="_3d-div"  style = "position:absolute; top: ${css_value.tops}; left: ${css_value.left}; height: ${css_value.height}; width: ${css_value.width};">

                                  <div>  <model-viewer class="D3onViewer" ondblclick="requestFullscreen()"
                                        src="${css_value.link}"
                                        alt="Here is a 3D Object."
                                        auto-rotate
                                        camera-controls
                                        style = "height: 100%;width: 100%;">
                                                <div class="custom-poster" slot="poster"></div>

                                    </model-viewer></div>

                                </div>
                            `)
                            });
                        }

                        if (div == 'backgroundcolor') {
                            $('.page-contents').css('background-color', div_value)
                        }
                    });
                });
                $('.textdiv span').each(function () {
                    let fontsize = $(this)[0].style.fontSize
                    if (fontsize) {
                        convertedFont = convertFont(fontsize)
                        $(this)[0].style.fontSize = convertedFont;
                    }
                })
            }
        });
    }

    function convertFont(font) {
        let unit = font.slice(-2)
        if (unit == 'px') {
            return parseFloat(font) / 16 + 'em'
        } else if (unit == 'em') {
            return parseFloat(font) + 'em'
        } else if (unit == 'rem') {
            return font
        } else if (unit == 'pt') {
            return parseFloat(font) / 12 + 'em'
        } else {
            return font
        }

    }

    function toggleFullScreen() {
        if ((document.fullScreenElement && document.fullScreenElement !== null) ||
            (!document.mozFullScreen && !document.webkitIsFullScreen)) {
            if (document.documentElement.requestFullScreen) {
                document.documentElement.requestFullScreen();
            } else if (document.documentElement.mozRequestFullScreen) {
                document.documentElement.mozRequestFullScreen();
            } else if (document.documentElement.webkitRequestFullScreen) {
                document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
            }
        } else {
            if (document.cancelFullScreen) {
                document.cancelFullScreen();
            } else if (document.mozCancelFullScreen) {
                document.mozCancelFullScreen();
            } else if (document.webkitCancelFullScreen) {
                document.webkitCancelFullScreen();
            }
        }
    }


    function setThumbnails() {
        $.each(data.pages, function (key, value) {
            if (value[0]['thumbnail'] == "") {
                $('.thumbnail-container').append(`
                <div class="thumbnails item"  value = ${key}>
                    <div class="image-holder">
                        <div class="key-holder" style="position:absolute; top:0px ; left:3px;font-size: large;font-weight:700;text-shadow: 2px 2px 6px #ffffff;"> ${key} </div>
                        <img  class="thumb-img" src = "{% static 'images/blankpage.jpg' %}" height=100% width=100%></img>
                    </div>
                 

                </div>
            `);
            } else {
                $('.thumbnail-container').append(`
                <div class="thumbnails item"  value = ${key}>
                    <div class="image-holder">
                        <div class="key-holder" style="position:absolute;top:0px;left:3px;font-size: large;font-weight:700;text-shadow: 2px 2px 6px #ffffff;"> ${key} </div>
                        <img  class="thumb-img" src = "${value[0]['thumbnail']}"
                            onError="this.onerror=null;this.src='{% static 'images/blankpage.jpg' %}';"
                            height=100% width=100%>
                        </img>
                    </div>
                </div>
                `);
            }
        });
    }

    var x = window.matchMedia("(max-width: 567px)")

    function Layout(x) {
        if (x.matches) {
            $('.navigation-owl').css('display', 'none')
            $('#main-bottom-slider').css('width', '100%')
            $('.owl-prev').css('left', '0')
            $('#page-contents').empty();
            loaddata(data, window.currentpage);
            $('#page-contents div').each(function () {
                $(this).removeAttr('style')
                $(this).css('padding', '10px')
            })
        } else {
            $('.navigation-owl').css('display', 'block')
            $('#main-bottom-slider').css('width', '74%')
            $('.owl-prev').css('left', '27.5%')
            $('#page-contents').empty();
            loaddata(data, window.currentpage)
        }
        $('.thumbnails').removeAttr('style').removeClass('active');
        $('.thumbnails[value=' + window.currentpage + ']').css({
            'border': '2px solid #79a6fb'
        }).addClass('active');
    }

    $(document).ready(function () {
        setThumbnails();

        Layout(x)
        x.addListener(Layout) // Attach listener function on state changes
        getProgressWidth();

        $('#next-btn').off().click(function () {
            pauseAllVideos();
            if (currentpage < data.numberofpages) {
                currentpage = parseInt(currentpage) + 1;
                changePage(currentpage)

            }
        });

        $('#prev-btn').off().click(function () {
            pauseAllVideos();
            if (currentpage != 1) {
                currentpage = parseInt(currentpage) - 1;
                changePage(currentpage)
            }
        });

        $('.thumbnails').on('click', function () {
            pauseAllVideos();
            currentpage = parseInt($(this).attr('value'));
            changePage(currentpage)


        });

        {% if not connection_offline %}
            $('#chatmessageinput').summernote({
                toolbar: []
            });
            $('#chatmessageinput').parent().find('.note-statusbar').remove();
        {% endif %}
    });


    function changePage(page_number) {        
        if (!x.matches) {
            if (page_number >= parseInt($('#totalpages').text())) {
                $('#next-btn').css('visibility', 'hidden')
            } else {
                $('#next-btn').css('visibility', 'visible')
            }
            if (page_number <= 1) {
                $('#prev-btn').css('visibility', 'hidden')
            } else {
                $('#prev-btn').css('visibility', 'visible')
            }

        }

        Layout(x)
        $('#currentpage').text(parseInt(page_number));
        getProgressWidth();
        document.querySelector("#thumbnail-slider > div.owl-stage-outer > div > div:nth-child(" + page_number + ") > div").scrollIntoView();          

        localStorage.setItem("ChapterPageNumber_{{chapter.id}}", page_number); //save page number

        try {
            speechSynthesis.cancel();
        } catch (e) {
        }

    }


    function getProgressWidth() {
        let w = (window.currentpage / parseFloat('{{data.numberofpages}}')) * 100;
        $('.progress-bar').css('width', w + '%')
    }

</script>

<script>
    $(document).ready(function () {

        $(".close-icon-sidebar").click(function () {
            if (!x.matches) {
                $(".custom-owl-slider").css("right", '1%');
                $(".custom-owl-slider").css("width", '74%');

                $(".owl-prev").css("left", '27.5%');
                $(".owl-next").css("right", '4.75%');
            }
            $(".chat-dialogbox").css("left", '1%');

            $("#sidebar-id").addClass("slideOutLeft");
            $("#sidebar-id").removeClass("slideInLeft");
            $(".chat-sidenav-close").css("display", "none");
            $(".navigation-owl").css("left", '1%');
            $(".page-link-view").css("left", '1%');
            $(".link-view-box").css("left", '26.9%');

            $("#main-bottom-slider").addClass("slideInLeft");
            $("#main-bottom-slider").removeClass("slideOutLeft");
            $(".link-view-box").css("left", '18.9%');
        });
        $(".container12").click(function (e) {
            var target = $(e.target);
            if (!target.hasClass('page-link-view') && target.parents('.page-link-view').length == 0 && !target.hasClass('view-icon') && target.parents('.view-icon').length == 0) {
                $(".page-link-view").hide();
            }
        });


    });

</script>
<script>
    $(document).on('click', '#hamburg-nav', function () {
        if (!x.matches) {
            $(".owl-prev").css("left", '39%');
            $(".owl-next").css("right", '5.75%');
            $(".custom-owl-slider").css("right", '2%');
            $(".custom-owl-slider").css("width", '60%');
        }


        $("#sidebar-id").addClass("slideInLeft");
        $("#sidebar-id").removeClass("slideOutLeft");
        $(".chat-sidenav-close").css("display", "block");
        $(".navigation-owl").css("left", '16%');
        $(".page-link-view").css("left", '16%');
        $(".link-view-box").css("left", '31.9%');
        $(".chat-dialogbox").css("left", '17%');

        $("#main-bottom-slider").addClass("slideInLeft");
        $("#main-bottom-slider").removeClass("slideOutLeft");


        $(".sidenavbar-part").fadeIn(2000);
    });
    $(document).on('click', '.view-icon', function () {
        $(".page-link-view").toggle()
    });
    $(document).on('click', '.ham-icon', function () {
        {#$(".left-chat").css("display", "block");#}
        {#$(".chat-canvas").css("width", "78%");#}
        if ($(".left-chat").css('display') == "none") {
            $(".left-chat").css('display', 'block');
            $(".chat-canvas").css("width", "78%");
        } else {
            $(".left-chat").css('display', 'none')
            $(".chat-canvas").css("width", "100%");
        }

    });
    //for chat close button
    $(document).on('click', '.close-chat', function () {

        $(".chat-dialogbox").css("display", "none");
        $(".closechatopen").removeClass("color-chat");


    });
    $(document).on('click', '.close-call', function () {

        $(".video-box").css("display", "none");
        $(".closechatopen1").removeClass("color-chat");


    });
    //for main chhat icon
    $(document).on('click', '.icon-for-chat', function () {
        $(".chat-dialogbox").fadeToggle();
        // if ($(".chat-dialogbox").css('display') == "none") {
        //     $(".chat-dialogbox").css('display', 'block');
        //     $( "#main-chat-box" ).addClass( "fadeIn" );
        //     $( "#main-bottom-slider" ).removeClass( "fadeOut" );


        // } else {
        //     $( "#main-chat-box" ).addClass( "fadeOut" );
        //     $( "#main-bottom-slider" ).removeClass( "fadeIn" );
        // }

    });
    $(document).on('click', '.icon-for-chat2', function () {
        $(".chat-dialogbox").fadeToggle();


    });
    $(document).on('click', '.icon-for-video', function () {
        $(".video-box").fadeToggle();


    });
    $(document).on('click', '.icon-for-video2', function () {
        $(".video-box").fadeToggle();


    });


</script>

<script>
    $(document).ready(function () {
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    });

</script>
<!-- iframe on load -->

<script>
    function onPicFrameLoad() {
        $(".pic .loadspin").remove();
    };

    function onVidFrameLoad() {
        $(".video-div .loadspin").remove();
    };

    function onPdfFrameLoad() {
        $(".pdf-div .loadspin").remove();
    };

    function onAudioFrameLoad() {
        $(".audio-div .loadspin").remove();
    };
</script>


<!-- ends -->
<script>
    $(document).ready(function () {

        $('.owl-carousel').owlCarousel({
            nav: true,
            // slideBy: 5,
            rewind: true,
            margin: 5,
            dots: false,
            items: 5,
            stagePadding: 5,
            navText: ["<i class=' fa fa-chevron-circle-left'></i>",
                "<i class='fa  fa-chevron-circle-right'></i>"],
            responsive: {
                0: {
                    items: 1
                },
                300: {
                    items: 2

                },
                400: {
                    items: 3
                },
                600: {
                    items: 5
                },
                1000: {
                    items: 8
                }
            }
        })

    });
</script>

<!-- Chapter Progress save feature -->
{% if not connection_offline %}
    {% if '/students' in request.path %}
        <script>
            var chapterProgress;
            var currentPageUpdateOnServer = 0;

            function chapterProgressFunction() {
                var timewhensendingprogress = Date.now() / 1000 | 0; // floors the value
                //if (currentPageUpdateOnServer) {
                chapterProgress = setInterval(function () {
                    $.ajax({
                        url: "{% url 'pageupdateajax' course.pk chapter.pk %}",
                        type: "post",
                        data: {
                            'csrfmiddlewaretoken': '{{ csrf_token }}',
                            'currentpage': window.currentpage,
                            'totalpages': data.numberofpages,
                            'studytimeinseconds': 5,    // because in every 5 seconds the function will be called, therefore studytime is 5 seconds.
                            'last_study_time': timewhensendingprogress,
                        },
                        success: function (data) {
                            window.currentPageUpdateOnServer = parseInt(data.contents.currentpagenumber)
                        },
                    })
                }, 5000);
                //}
            }

            function chapterProgressStopFunction() {
                clearInterval(chapterProgress);
            }

            chapterProgressFunction()
            StudentChapterLogUpdateAjax(1)

            function StudentChapterLogUpdateAjax(type = 1) {
                $.ajax({
                    url: "{% url 'studentChapterLogUpdateAjax' chapter.pk %}",
                    type: "post",
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'type': type,
                    },
                    success: function (data) {
                        console.log(data)
                    },
                })
            }

            /*
                            $(window).on("blur focus", async function (e) {
                                var prevType = $(this).data("prevType");

                                if (prevType != e.type) {   //  reduce double fire issues
                                    switch (e.type) {
                                        case "blur":
                                            StudentChapterLogUpdateAjax(0);
                                            chapterProgressStopFunction();
                                            break;
                                        case "focus":
                                            StudentChapterLogUpdateAjax(1);
                                            chapterProgressFunction();
                                            break;
                                    }
                                }

                                $(this).data("prevType", e.type);
                            })

            */
            window.addEventListener('beforeunload', function (event) {
                StudentChapterLogUpdateAjax(0)
            }, false);
        </script>
    {% endif %}

    <script>
        var teacherchapterProgress;

        // var currentPageUpdateOnServer = 0;

        function teacherchapterProgressFunction() {
            //if (currentPageUpdateOnServer === 0) {
            teacherchapterProgress = setTimeout(function () {
                $.ajax({
                    url: "{% url 'taketeacherAttendance' course.pk %}",
                    type: "get",
                    data: {
                        'chapterid': '{{chapter.pk }}',
                        'pagenumber': window.currentpage,
                    },
                    success: function (data) {
                        // window.currentPageUpdateOnServer = parseInt(data)
                    },
                })
            }, 100);
            //}
        }

        function teacherchapterProgressStopFunction() {
            clearTimeout(teacherchapterProgress);
        }

    </script>
{% endif %}

<script>
    function play(id) {
        var cld = cloudinary.Cloudinary.new({cloud_name: 'nsdevil-com'});
        var vidElem = $(id)[0]
        var player = cld.videoPlayer(vidElem, {
            showJumpControls: true,
            showLogo: false,
            playbackRates: ['0.25', '0.5', '1', '1.25', '1.5', '2'],
        });
    }

    $('.page-view input[type=checkbox]').change(function () {
        if ($(this).is(':checked')) {
            $('#main-bottom-slider').css('visibility', 'visible')
        } else {
            $('#main-bottom-slider').css('visibility', 'hidden')
        }
    });
    $('.link-view input[type=checkbox]').change(function () {
        if ($(this).is(':checked')) {
            $('.link-view-box').css('visibility', 'visible')
        } else {
            $('.link-view-box').css('visibility', 'hidden')
        }
    });
</script>
{# Video Call Scripts #}
<script>
    $('.video-box').draggable({
        containment: "#container",
        scroll: false,
        cursor: "move",
        snap: ".gridlines",
        snapMode: 'inner',
    }).resizable({
        containment: "#container",
        grid: [20, 20],
        autoHide: true,
        minWidth: 75,
        minHeight: 25,
    });
</script>
{# End of Video Call Scripts #}
</body>
