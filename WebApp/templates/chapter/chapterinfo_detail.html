{% load static %}
{% load i18n %}
{% load model_template_relation %}

{% load comment_tags %}  {# Loading the template tag #}

<style>
    .d-none {
        display: none !important;
    }

    .custom-table-width {
        max-width: 40%;

    }

    .date-width {
        max-width: 25%
    }

    @media (min-width: 768px ) and (max-width: 991px) {
        .custom-table-width {
            max-width: 38%;
        }

        .date-width {
            max-width: 30%
        }

    }
</style>
{# <script src="https://player.vimeo.com/api/player.js"></script> #}
{% now "Y-m-d" as todays_date %}
<div class="modal fade" id="exampleModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true" id="create_assignment_modal">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="height: 80vh;   ">
            <div class="modal-header text-center">
                <h4 class="modal-title" id="exampleModalLabel"><b>{% trans 'Create New Assignment' %}</b>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </h4>
            </div>
            <input type="hidden" name="today_date" id="id_today_date" value="{{ datetime|date:"Y-m-d" }}"
                   class="select form-control">
            <div class="modal-body " id="create_assignment_modal_body">

            </div>
        </div>
    </div>
</div>


<div class="outerDiv">
    {% include 'WebApp/theme/alerts.html' %}
    <div class="row">
        <div class="col-md-6 col-sm-12 col xs-12">

            <div class="col-md-12 col-sm-12 col-xs-12 text-center">
                <h2 class="detailListHeader">{% trans 'Chapter' %} {{ object.Chapter_No }}
                    : {{ object.Chapter_Name }} </h2>
            </div>
            <div class="col-md-12 col-sm-12 col-xs-12 text-center" id="buttons">
                {% if '/students' not in request.path %}
                    <a class="btn-sm btn-info" href="
                        {% if '/teachers' in request.path %}
                            {% url 'teacher_NewContentViewer' object.Course_Code.pk object.pk %}
                        {% else %}
                            {% url 'NewContentViewer' object.Course_Code.pk object.pk %}
                        {% endif %}" id="course-viewer" target="_self"
                    >
                        <i class="fa fa-laptop"></i> {% trans 'Content Viewer' %} &nbsp;
                    </a>
                {% else %}
                    {% isChapterActive request.user object as chapteractive %}
                    {% if chapteractive %}
                        <a class="btn-sm btn-info"
                           href="{% url 'student_NewContentViewer' object.Course_Code.pk object.pk %}" id="course-viewer"
                           target="_self"
                        >
                            <i class="fa fa-laptop"></i> {% trans 'Content Viewer' %} &nbsp;
                        </a>
                    {% endif %}
                {% endif %}

                {% if '/students' not in request.path %}
                    {% if '/teachers' in request.path %}
                        <a class="btn-sm btn-success"
                           href="{% url 'teachers_newChapterBuilder' object.Course_Code.id object.id %}"> <i
                                class="fa fa-pencil"></i> {% trans 'Content Builder' %}
                            &nbsp;</a>
                    {% else %}
                        <a class="btn-sm btn-success"
                           href="{% url 'newChapterBuilder' object.Course_Code.id object.id %}"> <i
                                class="fa fa-pencil"></i> {% trans 'Content Builder' %} &nbsp;</a>
                    {% endif %}
                {% endif %}

            </div>

            {% if '/students' not in request.path %}

                <div id="edit-delete" class="col-md-12 col-sm-12 col-xs-12">
                    <br>
                    <a style="margin-top:5px;margin-right: 15px;" href="{% if '/teachers' in request.path %}
        /teachers{{ object.get_update_url }}
    {% else %}
        {{ object.get_update_url }}
    {% endif %}"><b><u>{% trans 'Edit Chapter' %}</u></b></a>
                    <span>
                    <a id="{{ object.pk }}" class="chapter-confirm-delete"
                       style="color: rgb(255, 0, 0);cursor:pointer;float: right;margin-right: 60px;">{% trans 'Delete' %} </a>
                </span>
                    <form method="post" action="{% url 'chapterinfo_delete' pk=object.pk %}"
                          id="deleteChapter{{ object.pk }}">
                        {% csrf_token %}
                        {#                        <!-- <input type="hidden" value="{{questions.pk}}" name="question_id"> -->#}
                        <input type="hidden" value="{{ object.pk }}" name="chapter_id">
                        <input type="hidden" value="{{ object.Course_Code.id }}" name="course_id">
                    </form>
                </div>
            {% endif %}
            <div class="col-md-12 col-sm-12 col-xs-12" style="margin-top: 10px;">

                <table class="table" style="margin-left: 0 ; margin-bottom:0px ">
                    <tr>
                        <td>{% trans 'Summary' %}</td>
                        <td>{{ object.Summary }}</td>
                    </tr>

                    <tr>
                        <td>{% trans 'Status' %}</td>
                        <td>
                            {% if object.Use_Flag is True %}
                                <span class="badge badge-success">{% trans 'Published' %}</span>
                            {% elif object.Use_Flag is False %}
                                <span class="badge badge-danger">{% trans 'Not Published' %}</span>
                            {% endif %}

                        </td>
                    </tr>


                    <!-- Start/End Date from different session -->
                    <!-- {% if assigned_session %}
                        <tr>

                            <th class="custom-table-width">Session</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            {% if '/students' not in request.path %}
                                <th>Chapter Status</th>
                                <th>Action</th>
                            {% endif %}
                        </tr>
                    {% endif %}
                    {% for sessions in assigned_session %}
                        <tr>
                            <td class="custom-table-width">
                                {{ sessions }}
                                {% if '/students' not in request.path and '/teachers' not in request.path %}
                                    {% if sessions.is_active %}
                                        <span class=" text-success"> <b style="text-transform: uppercase; font-size:14px">
                        [Active]</b>  </span>
                                    {% else %}
                                        <span class=" text-danger"><b style="text-transform: uppercase; font-size:14px">
                        [Inactive]</b></span>
                                    {% endif %}
                                {% endif %}
                            </td>
                            {% for sessionmap in object.chapter_sessionmaps.all %}
                                {% if sessionmap.Session_Code == sessions %}
                                    <td class="start-date dateconFullMonth">
                        {{ sessionmap.Start_Date|date:"d M, Y h:i A" }}</td>
                                    <td class="end-date dateconFullMonth">{{ sessionmap.End_Date|date:"d M, Y h:i A" }}</td>
                                    {% if '/students' not in request.path %}
                                        <td>
                                            {% now "Y-m-d H:i" as todays_datewithtime %}

                        {% if sessionmap.Start_Date and todays_datewithtime < sessionmap.Start_Date|date:"Y-m-d H:i" %}
                                                <span class="badge badge-info">Upcoming</span>

                        {% elif sessionmap.End_Date and todays_datewithtime > sessionmap.End_Date|date:"Y-m-d H:i" %}
                                                <span class="badge badge-danger">Expired</span>
                                            {% else %}
                                                <span class="badge badge-success">Active</span>
                                            {% endif %}
                                        </td>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                            {% if '/students' not in request.path %}
                                <td>
                                    <button type="button" class="btn btn-sm btn-primary inningmap-btn" data-toggle="modal"
                                            data-target="#inningmap_form_modal" data-sessionid="{{ sessions.id }}"
                                            data-objectid="{{ object.id }}">
                                        Change
                                    </button>
                                </td>
                            {% endif %}
                        </tr>
                    {% endfor %} -->
                    <!-- End Of start/end date -->


                    <tr>
                        <td>{% trans 'Register By' %}</td>
                        {% if 'students' in request.path %}
                            <td>{% getUserFullName object.Register_Agent as register_agent %}{{ register_agent }}</td>
                        {% else %}
                            <td>{% getUser object.Register_Agent as register_agent %}{{ register_agent }}</td>
                        {% endif %}
                    </tr>

                    <tr>
                        <td>{% trans 'Course Code' %}</td>
                        <td>{{ object.Course_Code }}</td>
                    </tr>

                    <!-- Pre Quiz Start -->
                    <tr>
                        <td>{% trans 'Pre Test Quiz' %}</td>
                        {% if 'students' in request.path %}
                            <td>
                                {% for pre_quiz in pre_quizes %}
                                    <div class="col-md-9">
                                        <span> {{ pre_quiz.title }} </span>
                                    </div>
                                    <div class="col-md-3">
                                        {% getUserQuizStatus pre_quiz.sitting_set.all user as student_quiz_status %}

                                        {% if student_quiz_status.isExist and student_quiz_status.isComplete %}
                                            {% if pre_quiz.single_attempt %}
                                                <span style="color: limegreen; font-weight: bold">{% trans 'Completed' %}</span>
                                            {% else %}
                                                <a href="{% url 'quiz_question' quiz_name=pre_quiz.url %}">
                                                    <button id="feedbackbtn-quiz{{ pre_quiz.id }}" type="button"
                                                            class=" qts-button " data-toggle="modal"
                                                            data-target="#quizmodal" style="background-color: #65f665">
                                                        {% trans 'Play Again' %}
                                                    </button>
                                                </a>
                                            {% endif %}
                                        {% else %}
                                            <a href="{% url 'quiz_question' quiz_name=pre_quiz.url %}">
                                                <button id="feedbackbtn-quiz{{ pre_quiz.id }}" type="button"
                                                        class=" qts-button " data-toggle="modal"
                                                        data-target="#quizmodal">
                                                    {% trans 'Play Quiz' %}
                                                </button>
                                            </a>
                                        {% endif %}

                                    </div>
                                {% empty %}
                                    <p>{% trans 'No Pre Quiz' %}</p>
                                {% endfor %}
                            </td>
                        {% else %}
                            <td width="60%">
                                {% for pre_quiz in pre_quizes %}
                                    <form method="post" action="{% url 'change_quiz_test' %}" class="pre_test_change"
                                          id="radiobtn{{ pre_quiz.id }}">
                                        {% csrf_token %}
                                        <a target="_blank" href="
                          {% if 'teachers' in request.path %}
                            {% url 'teacher_quiz_detail' pre_quiz.id %}
                          {% else %}
                            {% url 'quiz_detail' pre_quiz.id %}
                          {% endif %}
                        ">{{ pre_quiz.title }} </a><br>
                                        <div class="btn-group" id="status" data-toggle="buttons">
                                            <label class="btn btn-default btn-on-3 btn-sm {% if pre_quiz.draft == False %}active{% endif %}"
                                                   id="ActiveButton" style="text-transform: uppercase;">
                                                <input type="radio" value="1" name="pre-test-radio"
                                                       id="id_pre-test-radio"
                                                       {% if pre_quiz.draft == False %}checked{% endif %}>{% trans 'On' %}
                                            </label>
                                            <label class="btn btn-default btn-off-3 btn-sm {% if pre_quiz.draft == True %}active{% endif %}"
                                                   id="ExpireButton" style="text-transform: uppercase;">
                                                <input type="radio" value="0" name="pre-test-radio"
                                                       {% if pre_quiz.draft == True %}checked{% endif %}>{% trans 'Off' %}
                                            </label>
                                        </div>
                                        <input type="hidden" name="quiz_id" value="{{ pre_quiz.id }}">
                                    </form>
                                {% empty %}
                                    {% trans 'No pre quiz, Add new by clicking ' %}+
                                {% endfor %}
                            </td>
                            <td width="20%">
                                <button type="button" class="btn qts-button" id="pre_test_popup" data-toggle="modal"
                                        data-target="#quiz_create_popup">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </td>
                        {% endif %}

                    </tr>
                    <!--Pre Quiz End  -->

                    <!-- Post Quiz Start -->
                    <tr>
                        <td> {% trans 'Post Test Quiz' %}</td>
                        {% if 'students' in request.path %}
                            <td>
                                {% for post_quiz in post_quizes %}
                                    <div class="col-md-6">
                                        <span> {{ post_quiz.title }} </span>
                                    </div>
                                    <div class="col-md-6">
                                        {% getUserQuizStatus post_quiz.sitting_set.all user as student_quiz_status %}

                                        {% if student_quiz_status.isExist and student_quiz_status.isComplete %}
                                            {% if post_quiz.single_attempt %}
                                                <span style="color: limegreen; font-weight: bold">{% trans 'Completed' %}</span>
                                            {% else %}
                                                <a href="{% url 'quiz_question' quiz_name=post_quiz.url %}">
                                                    <button id="feedbackbtn-quiz{{ post_quiz.id }}" type="button"
                                                            class=" qts-button " data-toggle="modal"
                                                            data-target="#quizmodal" style="background-color: #65f665">
                                                        {% trans 'Play Again' %}
                                                    </button>
                                                </a>
                                            {% endif %}
                                        {% else %}
                                            <a href="{% url 'quiz_question' quiz_name=post_quiz.url %}">
                                                <button id="feedbackbtn-quiz{{ post_quiz.id }}" type="button"
                                                        class=" qts-button " data-toggle="modal"
                                                        data-target="#quizmodal">
                                                    {% trans 'Play Quiz' %}
                                                </button>
                                            </a>
                                        {% endif %}

                                    </div>
                                {% empty %}
                                    <p>{% trans 'No Post Quiz' %}</p>
                                {% endfor %}
                            </td>
                        {% else %}
                            <td width="60%">
                                {% for post_quiz in post_quizes %}
                                    <form method="post" action="{% url 'change_quiz_test' %}" class="post_test_change"
                                          id="radiobtn{{ post_quiz.id }}">
                                        {% csrf_token %}
                                        <a href="/quiz/detail/{{ post_quiz.id }}">{{ post_quiz.title }} </a><br>
                                        <div class="btn-group" id="status2" data-toggle="buttons">
                                            <label class="btn btn-default btn-on-3 btn-sm {% if post_quiz.draft == False %}active{% endif %}"
                                                   id="ActiveButton" style="text-transform: uppercase;">
                                                <input type="radio" value="1" name="post-test-radio"
                                                       id="id_post-test-radio"
                                                       {% if post_quiz.draft == False %}checked{% endif %}>{% trans 'On' %}
                                            </label>
                                            <label class="btn btn-default btn-off-3 btn-sm {% if post_quiz.draft == True %}active{% endif %}"
                                                   id="ExpireButton" style="text-transform: uppercase;">
                                                <input type="radio" value="0" name="post-test-radio"
                                                       {% if post_quiz.draft == True %}checked{% endif %}>{% trans 'Off' %}
                                            </label>
                                        </div>
                                        <input type="hidden" name="quiz_id" value="{{ post_quiz.id }}">
                                    </form>
                                {% empty %}
                                    {% trans 'No post quiz, Add new by clicking ' %} +
                                {% endfor %}
                            </td>
                            <td width="20%">
                                <button type="button" class="btn qts-button" id="post_test_popup" data-toggle="modal"
                                        data-target="#quiz_create_popup">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </td>
                        {% endif %}


                    </tr>
                    <!-- Post Quiz End -->
                    <!-- <tr>
                        <td>
                            Discussion
                        </td>
                        <td>
                            {% if object.is_commentable %}
                                <span class="badge badge-success">Active</span>
                            {% else %}
                                <span class="badge badge-danger">Inactive</span>
                            {% endif %}
                        </td>
                    </tr> -->


                </table>

                <table class="table" style="margin-left: 0;">
                    {% if assigned_session %}
                        <tr>

                            <th class="custom-table-width">{% trans 'Session' %}</th>
                            <th class="date-width">{% trans 'Start Date' %}</th>
                            <th class="date-width">{% trans 'End Date' %}</th>
                            {% if '/students' not in request.path %}
                                <th>{% trans 'Chapter Status' %}</th>
                                <th>{% trans 'Action' %}</th>
                            {% endif %}
                        </tr>
                    {% endif %}
                    {% for sessions in assigned_session %}
                        <tr>
                            <td class="custom-table-width">
                                {{ sessions }}
                                {% if '/students' not in request.path and '/teachers' not in request.path %}
                                    {% if sessions.is_active %}
                                        <span class=" text-success"> <b
                                                style="text-transform: uppercase; font-size:14px">[{% trans 'Active' %}]</b>  </span>
                                    {% else %}
                                        <span class=" text-danger"><b style="text-transform: uppercase; font-size:14px">[{% trans 'Inactive' %}]</b></span>
                                    {% endif %}
                                {% endif %}
                            </td>
                            {% getSessionMap object 'chapterinfo' sessions as sessionmap %}
                            {#                        {% for sessionmap in object.chapter_sessionmaps.all %}#}
                            {#                            {% if sessionmap.Session_Code == sessions %}#}
                            <td class="start-date dateconFullMonth date-width">{{ sessionmap.0.Start_Date|date:"d M, Y h:i A" }}</td>
                            <td class="end-date dateconFullMonth date-width">{{ sessionmap.0.End_Date|date:"d M, Y h:i A" }}</td>
                            {% if '/students' not in request.path %}
                                <td>
                                    {% now "Y-m-d H:i" as todays_datewithtime %}
                                    {% if sessionmap.0.Start_Date and todays_datewithtime < sessionmap.0.Start_Date|date:"Y-m-d H:i" %}
                                        <span class="badge badge-info">{% trans 'Upcoming' %}</span>
                                    {% elif sessionmap.0.End_Date and todays_datewithtime > sessionmap.0.End_Date|date:"Y-m-d H:i" %}
                                        <span class="badge badge-danger">{% trans 'Expired' %}</span>
                                    {% else %}
                                        <span class="badge badge-success">{% trans 'Active' %}</span>
                                    {% endif %}
                                </td>
                            {% endif %}
                            {#                            {% endif %}#}
                            {#                        {% endfor %}#}
                            {% if '/students' not in request.path %}
                                <td>
                                    <button type="button" class="btn btn-sm btn-primary inningmap-btn"
                                            data-toggle="modal"
                                            data-target="#inningmap_form_modal" data-sessionid="{{ sessions.id }}"
                                            data-objectid="{{ object.id }}">
                                        {% trans 'Change' %}
                                    </button>
                                </td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                    <!-- End Of start/end date -->
                    <tr>
                        <td>
                            {% trans 'Discussion' %}
                        </td>
                        <td>
                            {% if object.is_commentable %}
                                <span class="badge badge-success">{% trans 'Active' %}</span>
                            {% else %}
                                <span class="badge badge-danger">{% trans 'Inactive' %}</span>
                            {% endif %}
                        </td>
                    </tr>

                </table>


            </div>
        </div>

        <div class="col-md-6 col-sm-12 xol-xs-12">

            <div class="col-md-12 col-sm-12 col-xs-12 ">
                <div class="col-md-12 col-sm-12 col-xs-12 text-center">
                    <h2 class="detailListHeader">{% trans 'Assignments' %}</h2>
                </div>

                {% if '/students' not in request.path %}
                    <div class="col-md-12 col-sm-12 col-xs-12 text-center">
                        <button type="button" class="btn-sm btn-success" data-toggle="modal"
                                data-target="#exampleModal1"
                                id="add-newassignment-btn">
                            {% trans 'Create New Assignment' %}
                        </button>
                    </div>
                {% endif %}
            </div>
            <div class="col-md-12">
                <hr class="header_hr">
                {% if object.Use_Flag is False %}
                    <p style="color:red">{% trans 'Note: Chapter is inactive, therefore assignments are not assigned to students.' %}</p>
                {% endif %}
                {% for o in assignments %}
                    <div class="col-md-12 col-sm-12 col-xs-12 leftborder" style="margin-bottom: 5px;">
                        <div class="col-md-8 col-sm-8 col-xs-8">
                            {#                            {% isAssignmentActive o as isanswerable %}#}
                            <h5 style="padding-top: 3px; color: #000000"> {% trans 'Assignment No' %}: {{ forloop.counter }}
                                {% if o.Use_Flag == False %}
                                    <span class="badge badge-danger"><b>{% trans 'Inactive' %}</b></span>
                                {% endif %}

                                {% if 'students' in request.path and not o.active %}
                                    <span class="badge badge-danger">{% trans 'Expired' %}</span>
                                {% endif %}
                            </h5>
                            <h5>
                                <b style="color: #000000">{{ o.Assignment_Topic }}</b>
                            </h5>

                            {% for chaptersession in object.chapter_sessionmaps.all %}
                                {% for assgsession in o.assignment_sessionmaps.all %}
                                    {% if assgsession.Session_Code == chaptersession.Session_Code %}
                                        {% if assgsession.End_Date > chaptersession.End_Date  and sessionmap.0.End_Date and chaptersession.End_Date %}
                                            <h6 class="text-danger">{% trans 'Assignment End Date is greater than Chapter' %}
                                                in {{ assgsession.Session_Code }}.</h6>
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                            {% endfor %}

                        </div>
                        <div class="col-md-4 col-sm-4 col-xs-4">
                            <a href="{% if '/students' in request.path %}
                                {{ o.student_get_absolute_url }}
                            {% elif '/teachers' in request.path %}
                                {{ o.teacher_get_absolute_url }}
                            {% else %}
                               {{ o.get_absolute_url }}
                            {% endif %}">
                                <button type="button" style="float: right;width:100px;height:25px;border: 1px solid #017a9b;color:#017a9b;background-color: white;border-radius: 4px;
                                margin-top: 20px;margin-bottom: 10px; text-transform: uppercase;">{% trans 'Continue' %}
                                    <i class="fa fa-arrow-right"></i>
                                </button>
                            </a>
                        </div>

                        <div class="col-md-12 col-sm-12 col-xs-12">
                            <hr style="margin-top: 1px; margin-bottom: 10px;">
                            {#                            <p>Start Date - <span#}
                            {#                                    class="dateconFullMonth">{{ o.Assignment_Start|date:"d M, Y h:i A" }}</span></p>#}
                            {#                            <p>Submission Deadline - <span#}
                            {#                                    class="dateconFullMonth">{{ o.Assignment_Deadline|date:"d M, Y h:i A" }}</span></p>#}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
    <div class="row">
        {% render_comments object request comments_per_page=10 %}
        {# Render all the comments belonging to a passed object #}
    </div>
</div>


<!-- Modal -->
<div class="modal fade custom-modal" id="quizmodal" role="dialog">
    <div class="modal-dialog"
         style="margin:0px!important; width:100%!important; padding:0px!important;height:100%!important">


        <!-- Modal content-->
        <div class="modal-content" style="height:100%">ur
            <div class="modal-header">
                <div class="col-md-12">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <a data-toggle="tooltip" data-placement="right" title="" onclick="toggleFullScreen()"
                       data-original-title="FullScreen" style="float:right ; padding-right:20px">
                        <span class="glyphicon glyphicon-fullscreen" aria-hidden="true"></span>
                    </a>

                </div>

                <h4 class="modal-title ">{% trans 'Quiz' %} </h4>

            </div>
            <div class="modal-body" id="quizmodalbody">
                <p>{% trans 'Some text in the modal' %}.</p>
            </div>
            <div class="modal-footer">

            </div>


        </div>
    </div>

</div>

<div id="quiz_create_popup" class="modal fade">
    <div class="modal-dialog" style="width: 80%;">
        <div class="modal-content" style="height: 80vh;overflow: auto;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">{% trans 'Create Quiz' %}</h4>
            </div>
            <div class="modal-body modal-auto" id="quiz_form_ajax" style="padding: 10%;">
                <img src="/static/images/uLMS2019_Loading_SVG.svg" alt="">

            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

<div id="question_form_popup" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content" style="height: 80vh;overflow: auto;">
            <div class="modal-header">
                <button type="button" class="close" id="qn_close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" id="question_model_title">{% trans 'Add Question' %}</h4>
            </div>
            <div class="modal-body" id="question_form_ajax">
                <img src="/static/images/uLMS2019_Loading_SVG.svg" alt="">

            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

{% block customjss %}

    <script src="{% static 'vendorsx/jquery/dist/jquery.min.js' %}"></script>
    <script>

        $(document).ready(function () {
            {% if not object.is_commentable %}
                $('.js-comment-input').attr('disabled', true);
            {% endif %}
        });
    </script>

    <script>
        $(document).on('click', '.chapter-confirm-delete', function () {
            ans = confirm('Are you sure you want to delete this Chapter?');
            if (ans == true) {
                $(`#deleteChapter${this.id}`).submit();
            } else {
                return false;
            }
        });
    </script>
    <script>
        let params = new URLSearchParams(location.search);
        $(document).ready(function () {


            if (params.get('ifquiz')) {
                $('.left_col, .top_nav , .breadcrumb  , .detailListHeader , #buttons , #add-newassignment-btn , .header_hr , #edit-delete , #footerText').remove();
                $('#pre_test_popup').click();

            }
            params.get('ifquiz')
        });


    </script>

    <script>
        {% for quiz in pre_quizes %}
            $('#feedbackbtn-quiz{{ quiz.id }}').click(function () {
                $('#quizmodalbody').html(`<iframe style="height: 90vh; width: 100%"
        src="/quiz/{{ quiz.url }}/take/"
        frameborder="0px"></iframe>`);
            })

        {% endfor %}
    </script>

    <script>
        $(document).ready(function () {
            $('.pre_test_change').change(function () {
                // console.log(this.id);
                // console.log($('#radio-buttons input[name=pre-test-radio]:checked').val());
                $.ajax({
                    url: "{% url 'change_quiz_test' %}", // URL to your view that serves new info
                    data: $(this).serialize(), // get the form data
                    type: $(this).attr('method'), // GET or POST
                    success: function (response) {
                        console.log('posted form');
                    },
                    error: function () {
                        console.log('Error in posting form');
                    }
                });

            });
            $('.post_test_change').change(function () {
                // console.log($('#radio-buttons1 input[name=post-test-radio]:checked').val());
                $.ajax({
                    url: "{% url 'change_quiz_test' %}", // URL to your view that serves new info
                    data: $(this).serialize(), // get the form data
                    type: $(this).attr('method'), // GET or POST
                    success: function (response) {
                        console.log('posted form');
                    },
                    error: function () {
                        console.log('Error in posting form');
                    }
                });
            });
        });
        $('#course-viewer').click(function (e) {
            e.preventDefault();
            $.ajax({
                type: "GET",
                url: "{% url 'chapterviewer' %}",  // URL to your view that serves new info
                data: {
                    'chapterID': '{{ object.id }}'
                },
                success: function (response) {
                    if (response.data == "0") {
                        alert("There are no contents available in this chapter.");
                        return
                    }
                    window.open($('#course-viewer').attr('href'), '_self');
                },
                error: function () {
                    console.log('Error in getting chapters')
                }
            });
        });
    </script>


    <script src=" {% static 'vendorsx/jQuery-Smart-Wizard/js/jquery.smartWizard.js' %}"></script>
    <script>
        $('#myModal').on('shown.bs.modal', function () {
            $('#myInput').trigger('focus')
        });

        $('#add-newassignment-btn').on('click', function () {
            $('#create_assignment_modal_body').empty();
            $('#create_assignment_modal_body').append(
                `<input type="hidden" name="Course_Code" id="id_Course_Code" value="{{ object.Course_Code.id }}"
               class="select form-control">
            <input type="hidden" name="Chapter_Code" id="id_Chapter_Code" value="{{ object.id }}"
               class="select form-control">`
            )

            $.ajax({
                type: "GET",
                url: "{% url 'assignmentinfo_create_ajax_chapter_id' object.id %}",  // URL to your view that serves new info
                success: function (response) {
                    let url = "{% url 'assignmentinfo_create_ajax' %}";  // URL to your view that serves new info
                    $('#create_assignment_modal_body').append(response);
                    $('#ajaxassignmentinfoform').attr('action', url);

                    $('#id_Assignment_Deadline').attr('min', '{{datetime|date:"Y-m-d"}}');
                    Switchery(document.querySelector('.js-switch'));
                },
                error: function () {
                    console.log('Error in generating assignment create form')
                },
                complete: function () {
                    $(".se-pre-con-ajax").fadeOut("fast");
                }
            });
        });
    </script>

    <script>
        $('#pre_test_popup').on('click', function () {
            $.ajax({
                type: "GET",
                data: {
                    'course_id': '{{ object.Course_Code.id }}',
                    'chapter_id': {{ object.id }},
                    'test_type': 'pre_test',
                },
                url: "{% url 'quiz_create_ajax'%}",  // URL to your view that serves new info
                success: function (data) {
                    $("#quiz_form_ajax").html(data);
                }
            });
        });
        $('#post_test_popup').on('click', function () {
            $.ajax({
                type: "GET",
                data: {
                    'course_id': '{{ object.Course_Code.id }}',
                    'chapter_id': {{ object.id }},
                    'test_type': 'post_test',
                },
                url: "{% url 'quiz_create_ajax'%}",  // URL to your view that serves new info
                success: function (data) {
                    $("#quiz_form_ajax").html(data);
                }
            });
        });
        $('#qn_close').on("click", function () {
            $("#quiz_create_popup").modal("show");
        });

        function quiz_create_content(response) {
            console.log(response['url']);
            console.log(response['teacher_url']);
            console.log(response['student_url']);
            location.reload();
        }
    </script>

    <script>
        $(document).ready(function () {
            var url = window.location.href;
            if ((url.indexOf('?idle=true') != -1) && (url.indexOf('&redirected=true') != -1)) {
                $('#message-modal').modal('show');
                $('#message-modal').find('.modal-body').html(`You have been idle for a while. Therefore, you are redirected.`);
                // window.history.replaceState(null, null, window.location.pathname); // removes all query string i.e after '?'
                let newurl = removeURLParameter(url, 'redirected');
                newurl = removeURLParameter(newurl, 'idle');
                window.history.replaceState(null, null, newurl); // removes query string i.e after '?'
            } else if ((url.indexOf('?multitab=true') != -1) && (url.indexOf('&redirected=true') != -1)) {
                $('#message-modal').modal('show');
                $('#message-modal').find('.modal-body').html(`You are restricted to open multiple viewer tab please close previous one`);
                // window.history.replaceState(null, null, window.location.pathname); // removes all query string i.e after '?'
                let newurl = removeURLParameter(url, 'redirected');
                newurl = removeURLParameter(newurl, 'multitab');
                window.history.replaceState(null, null, newurl); // removes query string i.e after '?'
            }
            return false
        });

        // removes query parameter containing string parameter from URL
        function removeURLParameter(url, parameter) {
            //prefer to use l.search if you have a location/link object
            var urlparts = url.split('?');
            if (urlparts.length >= 2) {

                var prefix = encodeURIComponent(parameter) + '=';
                var pars = urlparts[1].split(/[&;]/g);

                //reverse iteration as may be destructive
                for (var i = pars.length; i-- > 0;) {
                    //idiom for string.startsWith
                    if (pars[i].lastIndexOf(prefix, 0) !== -1) {
                        pars.splice(i, 1);
                    }
                }

                url = urlparts[0] + '?' + pars.join('&');
                return url;
            } else {
                return url;
            }
        }

        $('.inningmap-btn').on('click', function () {
            inningMapDataLoad($(this), $(this).attr('data-sessionid'), $(this).attr('data-objectid'), '{% url 'chapterinninginfomap' %}')
        })
    </script>
{% endblock %}

{% include 'inning/inningmapFormModal.html' %}
{% include_static %}
{#{% include_bootstrap %}#}