{% load static %}
{% load crispy_forms_tags %}
<!-- Bootstrap -->
{{ form.media }}
<script type="text/javascript" src="{% static 'build/js/SelectFilter2.js' %}"></script>
<link rel="stylesheet" type="text/css" href="{% static 'admin/css/widgets.css' %}"/>
<form method="post" id="quiz_form_post"
      action="{% url 'quiz_create_from_chapter' chapter_pk=chapter_pk test_type=test_type %}">{% csrf_token %}
  {{ form|crispy }}
  <button id="quiz_submit_button" class="btn btn-success " type="submit">Submit</button>
</form>

<script>
    $("#quiz_form_post").submit(function () {
        $('#id_mcquestion_to option').prop('selected', true);
        $('#id_saquestion_to option').prop('selected', true);
        $('#id_tfquestion_to option').prop('selected', true);
    });

    $("label[for='id_mcquestion']").after(`<button type="button" class="btn qts-button " id="mcq_create_button" data-toggle="modal"
                    data-target="#question_form_popup" style='float:right'>Add Multiple Choice Question
            </button>`);
    $("#mcq_create_button, label[for='id_mcquestion']").wrapAll("<div class = 'col-md-12 col-sm-12 col-xs-12'></div>");
    $("label[for='id_mcquestion']").wrap("<div class='col-md-6 col-sm-6 col-xs-6'></div>");
    $("#mcq_create_button").wrap("<div class='col-md-6 col-sm-6 col-xs-6'></div>");

    $("label[for='id_tfquestion']").after(`<button type="button" class="btn qts-button " id="tfq_create_button" data-toggle="modal"
                    data-target="#question_form_popup" style='float:right'>Add True/False question
            </button>`);
    $("#tfq_create_button, label[for='id_tfquestion']").wrapAll("<div class = 'col-md-12 col-sm-12 col-xs-12'></div>");
    $("label[for='id_tfquestion']").wrap("<div class='col-md-6 col-sm-6 col-xs-6'></div>");
    $("#tfq_create_button").wrap("<div class='col-md-6 col-sm-6 col-xs-6'></div>");

    $("label[for='id_saquestion']").after(`<button type="button" class="btn qts-button " id="saq_create_button" data-toggle="modal"
                    data-target="#question_form_popup" style='float:right'>Add Short Answer question
            </button>`);
    $("#saq_create_button, label[for='id_saquestion']").wrapAll("<div class = 'col-md-12 col-sm-12 col-xs-12'></div>");
    $("label[for='id_saquestion']").wrap("<div class='col-md-6 col-sm-6 col-xs-6'></div>");
    $("#saq_create_button").wrap("<div class='col-md-6 col-sm-6 col-xs-6'></div>");

    $('#mcq_create_button').on('click', function () {
        $.ajax({
            type: "GET",
            data: {'course_from_quiz': '{{ course_id }}'},
            url: "{% url 'mcquestion_create' %}",  // URL to your view that serves new info
            success: function (data) {
                $("#quiz_create_popup").modal('hide');
                $("#question_model_title").html("Create Multiple Choice Question");
                $("#question_form_ajax").html(data);

            }
        });
    });
    $('#tfq_create_button').on('click', function () {
        $.ajax({
            type: "GET",
            data: {'course_from_quiz': '{{ course_id }}'},
            url: "{% url 'tfquestion_create' %}",  // URL to your view that serves new info
            success: function (data) {
                $("#quiz_create_popup").modal('hide');
                $("#question_model_title").html("Create True/False Question");
                $("#question_form_ajax").html(data);

            }
        });
    });
    $('#saq_create_button').on('click', function () {
        $.ajax({
            type: "GET",
            data: {'course_from_quiz': '{{ course_id }}'},
            url: "{% url 'saquestion_create' %}",  // URL to your view that serves new info
            success: function (data) {
                $("#quiz_create_popup").modal('hide');
                $("#question_model_title").html("Create Short Answer Question");
                $("#question_form_ajax").html(data);

            }
        });
    });

    function mcq_success(response) {
        $("#quiz_create_popup").modal('show');
        $('#id_mcquestion_to').prepend(
            `<option value="${response['new_mcq_id']}" selected>${response['new_mcq_content']}</option>`);
        $('#id_mcquestion_to').change();
        SelectBox.add_to_cache("id_mcquestion_to", {value: String(response['new_mcq_id']), text: response['new_mcq_content'], displayed: 1});
        $('#question_form_popup').modal('toggle');
    }

    function tfq_success(response) {
        $("#quiz_create_popup").modal('show');
        $('#id_tfquestion_to').prepend(
            `<option value="${response['new_tfq_id']}" selected>${response['new_tfq_content']}</option>`);
        $('#id_tfquestion_to').change();
        SelectBox.add_to_cache("id_tfquestion_to", {value: String(response['new_tfq_id']), text: response['new_tfq_content'], displayed: 1});
        $('#question_form_popup').modal('toggle');
    }

    function saq_success(response) {
        $("#quiz_create_popup").modal('show');
        $('#id_saquestion_to').prepend(
            `<option value="${response['new_saq_id']}" selected>${response['new_saq_content']}</option>`);
        $('#id_saquestion_to').change();
        SelectBox.add_to_cache("id_saquestion_to", {value: String(response['new_saq_id']), text: response['new_saq_content'], displayed: 1});
        $('#question_form_popup').modal('toggle');
    }

    console.log($(".selector").html());

</script>
<style>
  @media (min-width: 350px) and (max-width: 825px) {
    .selector-available {
      width: 100% !important;
    }

    .selector-chosen {
      width: 100% !important;
    }

    .filtered {
      width: 100% !important;
    }

    .selector ul.selector-chooser {
      float: left;
      width: 22px;
      background-color: #eee;
      border-radius: 10px;
      margin: 5px auto 0 45% !important;
      padding: 0;
      transform: rotate(90deg);
      transition: all 0.3s ease;
    }
  }
</style>