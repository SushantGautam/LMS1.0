{% load static %}
{% load crispy_forms_tags %}
<script src="{% static 'vendorsx/jquery/dist/jquery.min.js' %}"></script>

{{ form.media }}

<link rel="stylesheet" type="text/css" href="{% static 'admin/css/widgets.css' %}"/>
<form method="post" id="tfq_select_form_post" action="">
    {% csrf_token %}
    <div class="alert alert-danger form-errors" style="display: none"></div>

    {{ form|crispy }}
    <div class="col-md-12">
        <p class="quiz-counter" id="selected_tfq_num">0</p>
    </div>
    <button class="btn btn-primary" type="submit">Submit</button>
</form>
{% block customjss %}

    <script type="text/javascript" src="{% static 'build/js/SelectFilter2.js' %}"></script>

    <script>
        $("#tfq_select_form_post").submit(function (e) {
            e.preventDefault(); // avoid to execute the actual submit of the form.
            $('#id_tfquestion_to option').prop('selected', true);
            var new_question_order = [];
            $.each($('#id_tfquestion_to option'), function() {new_question_order.push(this.value)});
            $("#id_tfquestion_order").val(new_question_order.toString());
            $.ajax({
                url: "{% url 'choose_tfq' pk=object.pk %}", // URL to your view that serves new info
                data: $(this).serialize(), // get the form data
                type: "POST", // GET or POST
                success: function (response) {
                    location.reload();
                },
                error: function (err) {
                    $('.form-errors').empty()
                    if (err.hasOwnProperty('responseJSON')) {
                        console.log('Error in posting form', err.responseJSON.__all__[0])
                        $('.form-errors').append(err.responseJSON.__all__[0]).css('display', 'block')
                        $('.form-errors').fadeOut(2000)
                    } else {
                        console.log('Error in posting form')
                    }
                }
            });
        });

        $('#id_tfquestion').change(function () {
            $('#selected_tfq_num').text($('#id_tfquestion option:selected').length);
        });
        {#$('#id_tfquestion').css("height", "50vh");#}
        $('.modal-dialog').css("width", "fit-content");
    </script>
{% endblock customjss %}